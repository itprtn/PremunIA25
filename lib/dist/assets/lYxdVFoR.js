const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/BQSgjyKB-chunk.js","assets/Dc2Emx3F-chunk.js","assets/B6lia_0w-campaigns.js","assets/dfWdBlna-chunk.js","assets/Z_xDiygn-chunk.js","assets/7YIM3tny-chunk.js","assets/DHnlrK-p-chunk.js","assets/BpqZfnrR-chunk.js","assets/Bo41tin1-chunk.js","assets/C3MfnUwI-analytics.js","assets/CtVW0-ZH-emailtemplates.js","assets/Dt90ku4i-settings.js","assets/C0Z_Xc0O-signup.js","assets/B11uBJdN-projectdetails.js","assets/-42c7cZK-leadgeneration.js","assets/DZfoNYzg-commissions.js"])))=>i.map(i=>d[i]);
import{j as e,P as t,c as r,a as s,u as n,B as a,b as i,d as o,e as l,f as c,R as d,g as u,h,i as m,S as f,k as p,A as v,l as g,m as x,n as y,F as b,D as w,C as j,o as _,p as N,q as k,r as S,L as C,T as E,s as T,t as P,v as O,O as D,w as R,x as M,y as A,z as I,E as $,G as L,H as F}from"./dfWdBlna-chunk.js";import{a as B,d as q,e as U,r as W,R as z}from"./Dc2Emx3F-chunk.js";import{u as H,a as K,L as V,B as J,R as Y,b as G,N as X}from"./DHnlrK-p-chunk.js";import{c as Q,t as Z}from"./BpqZfnrR-chunk.js";import{X as ee,C as te,S as re,a as se,G as ne,b as ae,L as ie,M as oe,c as le,d as ce,F as de,T as ue,e as he,f as me,g as fe,h as pe,i as ve,j as ge,k as xe,l as ye,m as be,n as we,o as je,p as _e,R as Ne,q as ke,r as Se,B as Ce,U as Ee,E as Te,s as Pe,t as Oe,H as De}from"./7YIM3tny-chunk.js";import{R as Re,L as Me,C as Ae,X as Ie,Y as $e,T as Le,a as Fe,B as Be,b as qe,P as Ue,c as We,d as ze,F as He,e as Ke,f as Ve}from"./Bo41tin1-chunk.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const r of e)if("childList"===r.type)for(const e of r.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();var Je={},Ye=B;function Ge(){{document.addEventListener("keydown",e=>{if("F12"===e.key)return e.preventDefault(),!1;if(e.ctrlKey&&e.shiftKey)switch(e.key){case"I":case"J":case"C":return e.preventDefault(),!1}return e.ctrlKey&&"u"===e.key?(e.preventDefault(),!1):void 0});let e=!1;const t=160,r=()=>window.outerHeight-window.innerHeight>t||window.outerWidth-window.innerWidth>t;setInterval(()=>{r()&&!e?(e=!0,document.body.style.filter="blur(10px)",document.body.style.pointerEvents="none",document.body.innerHTML='<div style="position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); font-family: Arial; text-align: center; color: red; font-size: 24px;">Unauthorized access detected</div>'):!r()&&e&&(e=!1,document.body.style.filter="",document.body.style.pointerEvents="")},500),document.addEventListener("contextmenu",e=>(e.preventDefault(),!1)),document.addEventListener("keydown",e=>{if("F12"===e.key)return e.preventDefault(),!1});const s=console.log,n=console.warn,a=console.error;console.log=(...e)=>{e.includes("authorized_debug")&&s.apply(console,e)},console.warn=(...e)=>{e.includes("authorized_debug")&&n.apply(console,e)},console.error=(...e)=>{var t;((null==(t=e[0])?void 0:t.toString())||"").includes("authorized_error")&&a.apply(console,e)},document.addEventListener("selectstart",e=>(e.preventDefault(),!1)),document.addEventListener("copy",e=>(e.preventDefault(),!1))}}function Xe(){window.onerror=()=>!1,window.onunhandledrejection=()=>!1,delete window.debug,delete window.devtools,delete window.console}Je.createRoot=Ye.createRoot,Je.hydrateRoot=Ye.hydrateRoot,Ge(),Xe();const Qe={},Ze=function(e,t,r){let s=Promise.resolve();if(t&&t.length>0){document.getElementsByTagName("link");const e=document.querySelector("meta[property=csp-nonce]"),r=(null==e?void 0:e.nonce)||(null==e?void 0:e.getAttribute("nonce"));s=Promise.allSettled(t.map(e=>{if((e=function(e){return"/"+e}(e))in Qe)return;Qe[e]=!0;const t=e.endsWith(".css"),s=t?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${e}"]${s}`))return;const n=document.createElement("link");return n.rel=t?"stylesheet":"modulepreload",t||(n.as="script"),n.crossOrigin="",n.href=e,r&&n.setAttribute("nonce",r),document.head.appendChild(n),t?new Promise((t,r)=>{n.addEventListener("load",t),n.addEventListener("error",()=>r(new Error(`Unable to preload CSS for ${e}`)))}):void 0}))}function n(e){const t=new Event("vite:preloadError",{cancelable:!0});if(t.payload=e,window.dispatchEvent(t),!t.defaultPrevented)throw e}return s.then(t=>{for(const e of t||[])"rejected"===e.status&&n(e.reason);return e().catch(n)})};class et extends Error{constructor(e,t="FunctionsError",r){super(e),this.name=t,this.context=r}}class tt extends et{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class rt extends et{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class st extends et{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var nt,at;(at=nt||(nt={})).Any="any",at.ApNortheast1="ap-northeast-1",at.ApNortheast2="ap-northeast-2",at.ApSouth1="ap-south-1",at.ApSoutheast1="ap-southeast-1",at.ApSoutheast2="ap-southeast-2",at.CaCentral1="ca-central-1",at.EuCentral1="eu-central-1",at.EuWest1="eu-west-1",at.EuWest2="eu-west-2",at.EuWest3="eu-west-3",at.SaEast1="sa-east-1",at.UsEast1="us-east-1",at.UsWest1="us-west-1",at.UsWest2="us-west-2";var it=function(e,t,r,s){return new(r||(r=Promise))(function(n,a){function i(e){try{l(s.next(e))}catch(t){a(t)}}function o(e){try{l(s.throw(e))}catch(t){a(t)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(i,o)}l((s=s.apply(e,t||[])).next())})};class ot{constructor(e,{headers:t={},customFetch:r,region:s=nt.Any}={}){this.url=e,this.headers=t,this.region=s,this.fetch=(e=>{let t;return t=e||("undefined"==typeof fetch?(...e)=>Ze(async()=>{const{default:e}=await Promise.resolve().then(()=>bt);return{default:e}},void 0).then(({default:t})=>t(...e)):fetch),(...e)=>t(...e)})(r)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e,t={}){var r;return it(this,void 0,void 0,function*(){try{const{headers:s,method:n,body:a}=t;let i,o={},{region:l}=t;l||(l=this.region),l&&"any"!==l&&(o["x-region"]=l),a&&(s&&!Object.prototype.hasOwnProperty.call(s,"Content-Type")||!s)&&("undefined"!=typeof Blob&&a instanceof Blob||a instanceof ArrayBuffer?(o["Content-Type"]="application/octet-stream",i=a):"string"==typeof a?(o["Content-Type"]="text/plain",i=a):"undefined"!=typeof FormData&&a instanceof FormData?i=a:(o["Content-Type"]="application/json",i=JSON.stringify(a)));const c=yield this.fetch(`${this.url}/${e}`,{method:n||"POST",headers:Object.assign(Object.assign(Object.assign({},o),this.headers),s),body:i}).catch(e=>{throw new tt(e)}),d=c.headers.get("x-relay-error");if(d&&"true"===d)throw new rt(c);if(!c.ok)throw new st(c);let u,h=(null!==(r=c.headers.get("Content-Type"))&&void 0!==r?r:"text/plain").split(";")[0].trim();return u="application/json"===h?yield c.json():"application/octet-stream"===h?yield c.blob():"text/event-stream"===h?c:"multipart/form-data"===h?yield c.formData():yield c.text(),{data:u,error:null}}catch(s){return{data:null,error:s}}})}}var lt={},ct={},dt={},ut={},ht={},mt={},ft=function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if("undefined"!=typeof globalThis)return globalThis;throw new Error("unable to locate global object")}();const pt=ft.fetch,vt=ft.fetch.bind(ft),gt=ft.Headers,xt=ft.Request,yt=ft.Response,bt=Object.freeze(Object.defineProperty({__proto__:null,Headers:gt,Request:xt,Response:yt,default:vt,fetch:pt},Symbol.toStringTag,{value:"Module"})),wt=q(bt);var jt={};Object.defineProperty(jt,"__esModule",{value:!0});class _t extends Error{constructor(e){super(e.message),this.name="PostgrestError",this.details=e.details,this.hint=e.hint,this.code=e.code}}jt.default=_t;var Nt=U&&U.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(mt,"__esModule",{value:!0});const kt=Nt(wt),St=Nt(jt);mt.default=class{constructor(e){this.shouldThrowOnError=!1,this.method=e.method,this.url=e.url,this.headers=e.headers,this.schema=e.schema,this.body=e.body,this.shouldThrowOnError=e.shouldThrowOnError,this.signal=e.signal,this.isMaybeSingle=e.isMaybeSingle,e.fetch?this.fetch=e.fetch:"undefined"==typeof fetch?this.fetch=kt.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(e,t){return this.headers=Object.assign({},this.headers),this.headers[e]=t,this}then(e,t){void 0===this.schema||(["GET","HEAD"].includes(this.method)?this.headers["Accept-Profile"]=this.schema:this.headers["Content-Profile"]=this.schema),"GET"!==this.method&&"HEAD"!==this.method&&(this.headers["Content-Type"]="application/json");let r=(0,this.fetch)(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async e=>{var t,r,s;let n=null,a=null,i=null,o=e.status,l=e.statusText;if(e.ok){if("HEAD"!==this.method){const t=await e.text();""===t||(a="text/csv"===this.headers.Accept||this.headers.Accept&&this.headers.Accept.includes("application/vnd.pgrst.plan+text")?t:JSON.parse(t))}const s=null===(t=this.headers.Prefer)||void 0===t?void 0:t.match(/count=(exact|planned|estimated)/),c=null===(r=e.headers.get("content-range"))||void 0===r?void 0:r.split("/");s&&c&&c.length>1&&(i=parseInt(c[1])),this.isMaybeSingle&&"GET"===this.method&&Array.isArray(a)&&(a.length>1?(n={code:"PGRST116",details:`Results contain ${a.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},a=null,i=null,o=406,l="Not Acceptable"):a=1===a.length?a[0]:null)}else{const t=await e.text();try{n=JSON.parse(t),Array.isArray(n)&&404===e.status&&(a=[],n=null,o=200,l="OK")}catch(c){404===e.status&&""===t?(o=204,l="No Content"):n={message:t}}if(n&&this.isMaybeSingle&&(null===(s=null==n?void 0:n.details)||void 0===s?void 0:s.includes("0 rows"))&&(n=null,o=200,l="OK"),n&&this.shouldThrowOnError)throw new St.default(n)}return{error:n,data:a,count:i,status:o,statusText:l}});return this.shouldThrowOnError||(r=r.catch(e=>{var t,r,s;return{error:{message:`${null!==(t=null==e?void 0:e.name)&&void 0!==t?t:"FetchError"}: ${null==e?void 0:e.message}`,details:`${null!==(r=null==e?void 0:e.stack)&&void 0!==r?r:""}`,hint:"",code:`${null!==(s=null==e?void 0:e.code)&&void 0!==s?s:""}`},data:null,count:null,status:0,statusText:""}})),r.then(e,t)}};var Ct=U&&U.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(ht,"__esModule",{value:!0});const Et=Ct(mt);let Tt=class extends Et.default{select(e){let t=!1;const r=(null!=e?e:"*").split("").map(e=>/\s/.test(e)&&!t?"":('"'===e&&(t=!t),e)).join("");return this.url.searchParams.set("select",r),this.headers.Prefer&&(this.headers.Prefer+=","),this.headers.Prefer+="return=representation",this}order(e,{ascending:t=!0,nullsFirst:r,foreignTable:s,referencedTable:n=s}={}){const a=n?`${n}.order`:"order",i=this.url.searchParams.get(a);return this.url.searchParams.set(a,`${i?`${i},`:""}${e}.${t?"asc":"desc"}${void 0===r?"":r?".nullsfirst":".nullslast"}`),this}limit(e,{foreignTable:t,referencedTable:r=t}={}){const s=void 0===r?"limit":`${r}.limit`;return this.url.searchParams.set(s,`${e}`),this}range(e,t,{foreignTable:r,referencedTable:s=r}={}){const n=void 0===s?"offset":`${s}.offset`,a=void 0===s?"limit":`${s}.limit`;return this.url.searchParams.set(n,`${e}`),this.url.searchParams.set(a,""+(t-e+1)),this}abortSignal(e){return this.signal=e,this}single(){return this.headers.Accept="application/vnd.pgrst.object+json",this}maybeSingle(){return"GET"===this.method?this.headers.Accept="application/json":this.headers.Accept="application/vnd.pgrst.object+json",this.isMaybeSingle=!0,this}csv(){return this.headers.Accept="text/csv",this}geojson(){return this.headers.Accept="application/geo+json",this}explain({analyze:e=!1,verbose:t=!1,settings:r=!1,buffers:s=!1,wal:n=!1,format:a="text"}={}){var i;const o=[e?"analyze":null,t?"verbose":null,r?"settings":null,s?"buffers":null,n?"wal":null].filter(Boolean).join("|"),l=null!==(i=this.headers.Accept)&&void 0!==i?i:"application/json";return this.headers.Accept=`application/vnd.pgrst.plan+${a}; for="${l}"; options=${o};`,this}rollback(){var e;return(null!==(e=this.headers.Prefer)&&void 0!==e?e:"").trim().length>0?this.headers.Prefer+=",tx=rollback":this.headers.Prefer="tx=rollback",this}returns(){return this}};ht.default=Tt;var Pt=U&&U.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(ut,"__esModule",{value:!0});const Ot=Pt(ht);let Dt=class extends Ot.default{eq(e,t){return this.url.searchParams.append(e,`eq.${t}`),this}neq(e,t){return this.url.searchParams.append(e,`neq.${t}`),this}gt(e,t){return this.url.searchParams.append(e,`gt.${t}`),this}gte(e,t){return this.url.searchParams.append(e,`gte.${t}`),this}lt(e,t){return this.url.searchParams.append(e,`lt.${t}`),this}lte(e,t){return this.url.searchParams.append(e,`lte.${t}`),this}like(e,t){return this.url.searchParams.append(e,`like.${t}`),this}likeAllOf(e,t){return this.url.searchParams.append(e,`like(all).{${t.join(",")}}`),this}likeAnyOf(e,t){return this.url.searchParams.append(e,`like(any).{${t.join(",")}}`),this}ilike(e,t){return this.url.searchParams.append(e,`ilike.${t}`),this}ilikeAllOf(e,t){return this.url.searchParams.append(e,`ilike(all).{${t.join(",")}}`),this}ilikeAnyOf(e,t){return this.url.searchParams.append(e,`ilike(any).{${t.join(",")}}`),this}is(e,t){return this.url.searchParams.append(e,`is.${t}`),this}in(e,t){const r=Array.from(new Set(t)).map(e=>"string"==typeof e&&new RegExp("[,()]").test(e)?`"${e}"`:`${e}`).join(",");return this.url.searchParams.append(e,`in.(${r})`),this}contains(e,t){return"string"==typeof t?this.url.searchParams.append(e,`cs.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cs.{${t.join(",")}}`):this.url.searchParams.append(e,`cs.${JSON.stringify(t)}`),this}containedBy(e,t){return"string"==typeof t?this.url.searchParams.append(e,`cd.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cd.{${t.join(",")}}`):this.url.searchParams.append(e,`cd.${JSON.stringify(t)}`),this}rangeGt(e,t){return this.url.searchParams.append(e,`sr.${t}`),this}rangeGte(e,t){return this.url.searchParams.append(e,`nxl.${t}`),this}rangeLt(e,t){return this.url.searchParams.append(e,`sl.${t}`),this}rangeLte(e,t){return this.url.searchParams.append(e,`nxr.${t}`),this}rangeAdjacent(e,t){return this.url.searchParams.append(e,`adj.${t}`),this}overlaps(e,t){return"string"==typeof t?this.url.searchParams.append(e,`ov.${t}`):this.url.searchParams.append(e,`ov.{${t.join(",")}}`),this}textSearch(e,t,{config:r,type:s}={}){let n="";"plain"===s?n="pl":"phrase"===s?n="ph":"websearch"===s&&(n="w");const a=void 0===r?"":`(${r})`;return this.url.searchParams.append(e,`${n}fts${a}.${t}`),this}match(e){return Object.entries(e).forEach(([e,t])=>{this.url.searchParams.append(e,`eq.${t}`)}),this}not(e,t,r){return this.url.searchParams.append(e,`not.${t}.${r}`),this}or(e,{foreignTable:t,referencedTable:r=t}={}){const s=r?`${r}.or`:"or";return this.url.searchParams.append(s,`(${e})`),this}filter(e,t,r){return this.url.searchParams.append(e,`${t}.${r}`),this}};ut.default=Dt;var Rt=U&&U.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(dt,"__esModule",{value:!0});const Mt=Rt(ut);dt.default=class{constructor(e,{headers:t={},schema:r,fetch:s}){this.url=e,this.headers=t,this.schema=r,this.fetch=s}select(e,{head:t=!1,count:r}={}){const s=t?"HEAD":"GET";let n=!1;const a=(null!=e?e:"*").split("").map(e=>/\s/.test(e)&&!n?"":('"'===e&&(n=!n),e)).join("");return this.url.searchParams.set("select",a),r&&(this.headers.Prefer=`count=${r}`),new Mt.default({method:s,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}insert(e,{count:t,defaultToNull:r=!0}={}){const s=[];if(this.headers.Prefer&&s.push(this.headers.Prefer),t&&s.push(`count=${t}`),r||s.push("missing=default"),this.headers.Prefer=s.join(","),Array.isArray(e)){const t=e.reduce((e,t)=>e.concat(Object.keys(t)),[]);if(t.length>0){const e=[...new Set(t)].map(e=>`"${e}"`);this.url.searchParams.set("columns",e.join(","))}}return new Mt.default({method:"POST",url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}upsert(e,{onConflict:t,ignoreDuplicates:r=!1,count:s,defaultToNull:n=!0}={}){const a=[`resolution=${r?"ignore":"merge"}-duplicates`];if(void 0!==t&&this.url.searchParams.set("on_conflict",t),this.headers.Prefer&&a.push(this.headers.Prefer),s&&a.push(`count=${s}`),n||a.push("missing=default"),this.headers.Prefer=a.join(","),Array.isArray(e)){const t=e.reduce((e,t)=>e.concat(Object.keys(t)),[]);if(t.length>0){const e=[...new Set(t)].map(e=>`"${e}"`);this.url.searchParams.set("columns",e.join(","))}}return new Mt.default({method:"POST",url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}update(e,{count:t}={}){const r=[];return this.headers.Prefer&&r.push(this.headers.Prefer),t&&r.push(`count=${t}`),this.headers.Prefer=r.join(","),new Mt.default({method:"PATCH",url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}delete({count:e}={}){const t=[];return e&&t.push(`count=${e}`),this.headers.Prefer&&t.unshift(this.headers.Prefer),this.headers.Prefer=t.join(","),new Mt.default({method:"DELETE",url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}};var At={},It={};Object.defineProperty(It,"__esModule",{value:!0}),It.version=void 0,It.version="0.0.0-automated",Object.defineProperty(At,"__esModule",{value:!0}),At.DEFAULT_HEADERS=void 0;const $t=It;At.DEFAULT_HEADERS={"X-Client-Info":`postgrest-js/${$t.version}`};var Lt=U&&U.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(ct,"__esModule",{value:!0});const Ft=Lt(dt),Bt=Lt(ut),qt=At;ct.default=class e{constructor(e,{headers:t={},schema:r,fetch:s}={}){this.url=e,this.headers=Object.assign(Object.assign({},qt.DEFAULT_HEADERS),t),this.schemaName=r,this.fetch=s}from(e){const t=new URL(`${this.url}/${e}`);return new Ft.default(t,{headers:Object.assign({},this.headers),schema:this.schemaName,fetch:this.fetch})}schema(t){return new e(this.url,{headers:this.headers,schema:t,fetch:this.fetch})}rpc(e,t={},{head:r=!1,get:s=!1,count:n}={}){let a;const i=new URL(`${this.url}/rpc/${e}`);let o;r||s?(a=r?"HEAD":"GET",Object.entries(t).filter(([e,t])=>void 0!==t).map(([e,t])=>[e,Array.isArray(t)?`{${t.join(",")}}`:`${t}`]).forEach(([e,t])=>{i.searchParams.append(e,t)})):(a="POST",o=t);const l=Object.assign({},this.headers);return n&&(l.Prefer=`count=${n}`),new Bt.default({method:a,url:i,headers:l,schema:this.schemaName,body:o,fetch:this.fetch,allowEmpty:!1})}};var Ut=U&&U.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(lt,"__esModule",{value:!0}),lt.PostgrestBuilder=lt.PostgrestTransformBuilder=lt.PostgrestFilterBuilder=lt.PostgrestQueryBuilder=lt.PostgrestClient=void 0;const Wt=Ut(ct);lt.PostgrestClient=Wt.default;const zt=Ut(dt);lt.PostgrestQueryBuilder=zt.default;const Ht=Ut(ut);lt.PostgrestFilterBuilder=Ht.default;const Kt=Ut(ht);lt.PostgrestTransformBuilder=Kt.default;const Vt=Ut(mt);lt.PostgrestBuilder=Vt.default;var Jt=lt.default={PostgrestClient:Wt.default,PostgrestQueryBuilder:zt.default,PostgrestFilterBuilder:Ht.default,PostgrestTransformBuilder:Kt.default,PostgrestBuilder:Vt.default};const{PostgrestClient:Yt,PostgrestQueryBuilder:Gt,PostgrestFilterBuilder:Xt,PostgrestTransformBuilder:Qt,PostgrestBuilder:Zt}=Jt,er={"X-Client-Info":"realtime-js/2.10.2"};var tr,rr,sr,nr,ar,ir,or,lr,cr,dr,ur;(rr=tr||(tr={}))[rr.connecting=0]="connecting",rr[rr.open=1]="open",rr[rr.closing=2]="closing",rr[rr.closed=3]="closed",(nr=sr||(sr={})).closed="closed",nr.errored="errored",nr.joined="joined",nr.joining="joining",nr.leaving="leaving",(ir=ar||(ar={})).close="phx_close",ir.error="phx_error",ir.join="phx_join",ir.reply="phx_reply",ir.leave="phx_leave",ir.access_token="access_token",(or||(or={})).websocket="websocket",(cr=lr||(lr={})).Connecting="connecting",cr.Open="open",cr.Closing="closing",cr.Closed="closed";class hr{constructor(){this.HEADER_LENGTH=1}decode(e,t){return e.constructor===ArrayBuffer?t(this._binaryDecode(e)):t("string"==typeof e?JSON.parse(e):{})}_binaryDecode(e){const t=new DataView(e),r=new TextDecoder;return this._decodeBroadcast(e,t,r)}_decodeBroadcast(e,t,r){const s=t.getUint8(1),n=t.getUint8(2);let a=this.HEADER_LENGTH+2;const i=r.decode(e.slice(a,a+s));a+=s;const o=r.decode(e.slice(a,a+n));a+=n;return{ref:null,topic:i,event:o,payload:JSON.parse(r.decode(e.slice(a,e.byteLength)))}}}class mr{constructor(e,t){this.callback=e,this.timerCalc=t,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=t}reset(){this.tries=0,clearTimeout(this.timer)}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}(ur=dr||(dr={})).abstime="abstime",ur.bool="bool",ur.date="date",ur.daterange="daterange",ur.float4="float4",ur.float8="float8",ur.int2="int2",ur.int4="int4",ur.int4range="int4range",ur.int8="int8",ur.int8range="int8range",ur.json="json",ur.jsonb="jsonb",ur.money="money",ur.numeric="numeric",ur.oid="oid",ur.reltime="reltime",ur.text="text",ur.time="time",ur.timestamp="timestamp",ur.timestamptz="timestamptz",ur.timetz="timetz",ur.tsrange="tsrange",ur.tstzrange="tstzrange";const fr=(e,t,r={})=>{var s;const n=null!==(s=r.skipTypes)&&void 0!==s?s:[];return Object.keys(t).reduce((r,s)=>(r[s]=pr(s,e,t,n),r),{})},pr=(e,t,r,s)=>{const n=t.find(t=>t.name===e),a=null==n?void 0:n.type,i=r[e];return a&&!s.includes(a)?vr(a,i):gr(i)},vr=(e,t)=>{if("_"===e.charAt(0)){const r=e.slice(1,e.length);return wr(t,r)}switch(e){case dr.bool:return xr(t);case dr.float4:case dr.float8:case dr.int2:case dr.int4:case dr.int8:case dr.numeric:case dr.oid:return yr(t);case dr.json:case dr.jsonb:return br(t);case dr.timestamp:return jr(t);case dr.abstime:case dr.date:case dr.daterange:case dr.int4range:case dr.int8range:case dr.money:case dr.reltime:case dr.text:case dr.time:case dr.timestamptz:case dr.timetz:case dr.tsrange:case dr.tstzrange:default:return gr(t)}},gr=e=>e,xr=e=>{switch(e){case"t":return!0;case"f":return!1;default:return e}},yr=e=>{if("string"==typeof e){const t=parseFloat(e);if(!Number.isNaN(t))return t}return e},br=e=>{if("string"==typeof e)try{return JSON.parse(e)}catch(t){return e}return e},wr=(e,t)=>{if("string"!=typeof e)return e;const r=e.length-1,s=e[r];if("{"===e[0]&&"}"===s){let s;const a=e.slice(1,r);try{s=JSON.parse("["+a+"]")}catch(n){s=a?a.split(","):[]}return s.map(e=>vr(t,e))}return e},jr=e=>"string"==typeof e?e.replace(" ","T"):e,_r=e=>{let t=e;return t=t.replace(/^ws/i,"http"),t=t.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),t.replace(/\/+$/,"")};class Nr{constructor(e,t,r={},s=1e4){this.channel=e,this.event=t,this.payload=r,this.timeout=s,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,t){var r;return this._hasReceived(e)&&t(null===(r=this.receivedResp)||void 0===r?void 0:r.response),this.recHooks.push({status:e,callback:t}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);this.channel._on(this.refEvent,{},e=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=e,this._matchReceive(e)}),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,t){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:t})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:t}){this.recHooks.filter(t=>t.status===e).forEach(e=>e.callback(t))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var kr,Sr,Cr,Er,Tr,Pr,Or,Dr;(Sr=kr||(kr={})).SYNC="sync",Sr.JOIN="join",Sr.LEAVE="leave";class Rr{constructor(e,t){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const r=(null==t?void 0:t.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(r.state,{},e=>{const{onJoin:t,onLeave:r,onSync:s}=this.caller;this.joinRef=this.channel._joinRef(),this.state=Rr.syncState(this.state,e,t,r),this.pendingDiffs.forEach(e=>{this.state=Rr.syncDiff(this.state,e,t,r)}),this.pendingDiffs=[],s()}),this.channel._on(r.diff,{},e=>{const{onJoin:t,onLeave:r,onSync:s}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(e):(this.state=Rr.syncDiff(this.state,e,t,r),s())}),this.onJoin((e,t,r)=>{this.channel._trigger("presence",{event:"join",key:e,currentPresences:t,newPresences:r})}),this.onLeave((e,t,r)=>{this.channel._trigger("presence",{event:"leave",key:e,currentPresences:t,leftPresences:r})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,t,r,s){const n=this.cloneDeep(e),a=this.transformState(t),i={},o={};return this.map(n,(e,t)=>{a[e]||(o[e]=t)}),this.map(a,(e,t)=>{const r=n[e];if(r){const s=t.map(e=>e.presence_ref),n=r.map(e=>e.presence_ref),a=t.filter(e=>n.indexOf(e.presence_ref)<0),l=r.filter(e=>s.indexOf(e.presence_ref)<0);a.length>0&&(i[e]=a),l.length>0&&(o[e]=l)}else i[e]=t}),this.syncDiff(n,{joins:i,leaves:o},r,s)}static syncDiff(e,t,r,s){const{joins:n,leaves:a}={joins:this.transformState(t.joins),leaves:this.transformState(t.leaves)};return r||(r=()=>{}),s||(s=()=>{}),this.map(n,(t,s)=>{var n;const a=null!==(n=e[t])&&void 0!==n?n:[];if(e[t]=this.cloneDeep(s),a.length>0){const r=e[t].map(e=>e.presence_ref),s=a.filter(e=>r.indexOf(e.presence_ref)<0);e[t].unshift(...s)}r(t,a,s)}),this.map(a,(t,r)=>{let n=e[t];if(!n)return;const a=r.map(e=>e.presence_ref);n=n.filter(e=>a.indexOf(e.presence_ref)<0),e[t]=n,s(t,n,r),0===n.length&&delete e[t]}),e}static map(e,t){return Object.getOwnPropertyNames(e).map(r=>t(r,e[r]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((t,r)=>{const s=e[r];return t[r]="metas"in s?s.metas.map(e=>(e.presence_ref=e.phx_ref,delete e.phx_ref,delete e.phx_ref_prev,e)):s,t},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}(Er=Cr||(Cr={})).ALL="*",Er.INSERT="INSERT",Er.UPDATE="UPDATE",Er.DELETE="DELETE",(Pr=Tr||(Tr={})).BROADCAST="broadcast",Pr.PRESENCE="presence",Pr.POSTGRES_CHANGES="postgres_changes",(Dr=Or||(Or={})).SUBSCRIBED="SUBSCRIBED",Dr.TIMED_OUT="TIMED_OUT",Dr.CLOSED="CLOSED",Dr.CHANNEL_ERROR="CHANNEL_ERROR";class Mr{constructor(e,t={config:{}},r){this.topic=e,this.params=t,this.socket=r,this.bindings={},this.state=sr.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:""},private:!1},t.config),this.timeout=this.socket.timeout,this.joinPush=new Nr(this,ar.join,this.params,this.timeout),this.rejoinTimer=new mr(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=sr.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(e=>e.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=sr.closed,this.socket._remove(this)}),this._onError(e=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,e),this.state=sr.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=sr.errored,this.rejoinTimer.scheduleTimeout())}),this._on(ar.reply,{},(e,t)=>{this._trigger(this._replyEventName(t),e)}),this.presence=new Rr(this),this.broadcastEndpointURL=_r(this.socket.endPoint)+"/api/broadcast"}subscribe(e,t=this.timeout){var r,s;if(this.socket.isConnected()||this.socket.connect(),this.joinedOnce)throw"tried to subscribe multiple times. 'subscribe' can only be called a single time per channel instance";{const{config:{broadcast:n,presence:a,private:i}}=this.params;this._onError(t=>e&&e("CHANNEL_ERROR",t)),this._onClose(()=>e&&e("CLOSED"));const o={},l={broadcast:n,presence:a,postgres_changes:null!==(s=null===(r=this.bindings.postgres_changes)||void 0===r?void 0:r.map(e=>e.filter))&&void 0!==s?s:[],private:i};this.socket.accessToken&&(o.access_token=this.socket.accessToken),this.updateJoinPayload(Object.assign({config:l},o)),this.joinedOnce=!0,this._rejoin(t),this.joinPush.receive("ok",({postgres_changes:t})=>{var r;if(this.socket.accessToken&&this.socket.setAuth(this.socket.accessToken),void 0!==t){const s=this.bindings.postgres_changes,n=null!==(r=null==s?void 0:s.length)&&void 0!==r?r:0,a=[];for(let r=0;r<n;r++){const n=s[r],{filter:{event:i,schema:o,table:l,filter:c}}=n,d=t&&t[r];if(!d||d.event!==i||d.schema!==o||d.table!==l||d.filter!==c)return this.unsubscribe(),void(e&&e("CHANNEL_ERROR",new Error("mismatch between server and client bindings for postgres changes")));a.push(Object.assign(Object.assign({},n),{id:d.id}))}return this.bindings.postgres_changes=a,void(e&&e("SUBSCRIBED"))}e&&e("SUBSCRIBED")}).receive("error",t=>{e&&e("CHANNEL_ERROR",new Error(JSON.stringify(Object.values(t).join(", ")||"error")))}).receive("timeout",()=>{e&&e("TIMED_OUT")})}return this}presenceState(){return this.presence.state}async track(e,t={}){return await this.send({type:"presence",event:"track",payload:e},t.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,t,r){return this._on(e,t,r)}async send(e,t={}){var r,s;if(this._canPush()||"broadcast"!==e.type)return new Promise(r=>{var s,n,a;const i=this._push(e.type,e,t.timeout||this.timeout);"broadcast"!==e.type||(null===(a=null===(n=null===(s=this.params)||void 0===s?void 0:s.config)||void 0===n?void 0:n.broadcast)||void 0===a?void 0:a.ack)||r("ok"),i.receive("ok",()=>r("ok")),i.receive("error",()=>r("error")),i.receive("timeout",()=>r("timed out"))});{const{event:a,payload:i}=e,o={method:"POST",headers:{Authorization:this.socket.accessToken?`Bearer ${this.socket.accessToken}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:a,payload:i}]})};try{const e=await this._fetchWithTimeout(this.broadcastEndpointURL,o,null!==(r=t.timeout)&&void 0!==r?r:this.timeout);return await(null===(s=e.body)||void 0===s?void 0:s.cancel()),e.ok?"ok":"error"}catch(n){return"AbortError"===n.name?"timed out":"error"}}}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=sr.leaving;const t=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(ar.close,"leave",this._joinRef())};return this.rejoinTimer.reset(),this.joinPush.destroy(),new Promise(r=>{const s=new Nr(this,ar.leave,{},e);s.receive("ok",()=>{t(),r("ok")}).receive("timeout",()=>{t(),r("timed out")}).receive("error",()=>{r("error")}),s.send(),this._canPush()||s.trigger("ok",{})})}async _fetchWithTimeout(e,t,r){const s=new AbortController,n=setTimeout(()=>s.abort(),r),a=await this.socket.fetch(e,Object.assign(Object.assign({},t),{signal:s.signal}));return clearTimeout(n),a}_push(e,t,r=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let s=new Nr(this,e,t,r);return this._canPush()?s.send():(s.startTimeout(),this.pushBuffer.push(s)),s}_onMessage(e,t,r){return t}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,t,r){var s,n;const a=e.toLocaleLowerCase(),{close:i,error:o,leave:l,join:c}=ar;if(r&&[i,o,l,c].indexOf(a)>=0&&r!==this._joinRef())return;let d=this._onMessage(a,t,r);if(t&&!d)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(a)?null===(s=this.bindings.postgres_changes)||void 0===s||s.filter(e=>{var t,r,s;return"*"===(null===(t=e.filter)||void 0===t?void 0:t.event)||(null===(s=null===(r=e.filter)||void 0===r?void 0:r.event)||void 0===s?void 0:s.toLocaleLowerCase())===a}).map(e=>e.callback(d,r)):null===(n=this.bindings[a])||void 0===n||n.filter(e=>{var r,s,n,i,o,l;if(["broadcast","presence","postgres_changes"].includes(a)){if("id"in e){const a=e.id,i=null===(r=e.filter)||void 0===r?void 0:r.event;return a&&(null===(s=t.ids)||void 0===s?void 0:s.includes(a))&&("*"===i||(null==i?void 0:i.toLocaleLowerCase())===(null===(n=t.data)||void 0===n?void 0:n.type.toLocaleLowerCase()))}{const r=null===(o=null===(i=null==e?void 0:e.filter)||void 0===i?void 0:i.event)||void 0===o?void 0:o.toLocaleLowerCase();return"*"===r||r===(null===(l=null==t?void 0:t.event)||void 0===l?void 0:l.toLocaleLowerCase())}}return e.type.toLocaleLowerCase()===a}).map(e=>{if("object"==typeof d&&"ids"in d){const e=d.data,{schema:t,table:r,commit_timestamp:s,type:n,errors:a}=e,i={schema:t,table:r,commit_timestamp:s,eventType:n,new:{},old:{},errors:a};d=Object.assign(Object.assign({},i),this._getPayloadRecords(e))}e.callback(d,r)})}_isClosed(){return this.state===sr.closed}_isJoined(){return this.state===sr.joined}_isJoining(){return this.state===sr.joining}_isLeaving(){return this.state===sr.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,t,r){const s=e.toLocaleLowerCase(),n={type:s,filter:t,callback:r};return this.bindings[s]?this.bindings[s].push(n):this.bindings[s]=[n],this}_off(e,t){const r=e.toLocaleLowerCase();return this.bindings[r]=this.bindings[r].filter(e=>{var s;return!((null===(s=e.type)||void 0===s?void 0:s.toLocaleLowerCase())===r&&Mr.isEqual(e.filter,t))}),this}static isEqual(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const r in e)if(e[r]!==t[r])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(ar.close,{},e)}_onError(e){this._on(ar.error,{},t=>e(t))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=sr.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const t={new:{},old:{}};return"INSERT"!==e.type&&"UPDATE"!==e.type||(t.new=fr(e.columns,e.record)),"UPDATE"!==e.type&&"DELETE"!==e.type||(t.old=fr(e.columns,e.old_record)),t}}const Ar=()=>{},Ir="undefined"!=typeof WebSocket;class $r{constructor(e,t){var r;this.accessToken=null,this.apiKey=null,this.channels=[],this.endPoint="",this.httpEndpoint="",this.headers=er,this.params={},this.timeout=1e4,this.heartbeatIntervalMs=3e4,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.ref=0,this.logger=Ar,this.conn=null,this.sendBuffer=[],this.serializer=new hr,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this._resolveFetch=e=>{let t;return t=e||("undefined"==typeof fetch?(...e)=>Ze(async()=>{const{default:e}=await Promise.resolve().then(()=>bt);return{default:e}},void 0).then(({default:t})=>t(...e)):fetch),(...e)=>t(...e)},this.endPoint=`${e}/${or.websocket}`,this.httpEndpoint=_r(e),(null==t?void 0:t.transport)?this.transport=t.transport:this.transport=null,(null==t?void 0:t.params)&&(this.params=t.params),(null==t?void 0:t.headers)&&(this.headers=Object.assign(Object.assign({},this.headers),t.headers)),(null==t?void 0:t.timeout)&&(this.timeout=t.timeout),(null==t?void 0:t.logger)&&(this.logger=t.logger),(null==t?void 0:t.heartbeatIntervalMs)&&(this.heartbeatIntervalMs=t.heartbeatIntervalMs);const s=null===(r=null==t?void 0:t.params)||void 0===r?void 0:r.apikey;s&&(this.accessToken=s,this.apiKey=s),this.reconnectAfterMs=(null==t?void 0:t.reconnectAfterMs)?t.reconnectAfterMs:e=>[1e3,2e3,5e3,1e4][e-1]||1e4,this.encode=(null==t?void 0:t.encode)?t.encode:(e,t)=>t(JSON.stringify(e)),this.decode=(null==t?void 0:t.decode)?t.decode:this.serializer.decode.bind(this.serializer),this.reconnectTimer=new mr(async()=>{this.disconnect(),this.connect()},this.reconnectAfterMs),this.fetch=this._resolveFetch(null==t?void 0:t.fetch)}connect(){if(!this.conn)if(this.transport)this.conn=new this.transport(this._endPointURL(),void 0,{headers:this.headers});else{if(Ir)return this.conn=new WebSocket(this._endPointURL()),void this.setupConnection();this.conn=new Lr(this._endPointURL(),void 0,{close:()=>{this.conn=null}}),Ze(async()=>{const{default:e}=await import("./BQSgjyKB-chunk.js").then(e=>e.b);return{default:e}},__vite__mapDeps([0,1])).then(({default:e})=>{this.conn=new e(this._endPointURL(),void 0,{headers:this.headers}),this.setupConnection()})}}disconnect(e,t){this.conn&&(this.conn.onclose=function(){},e?this.conn.close(e,null!=t?t:""):this.conn.close(),this.conn=null,this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.reset())}getChannels(){return this.channels}async removeChannel(e){const t=await e.unsubscribe();return 0===this.channels.length&&this.disconnect(),t}async removeAllChannels(){const e=await Promise.all(this.channels.map(e=>e.unsubscribe()));return this.disconnect(),e}log(e,t,r){this.logger(e,t,r)}connectionState(){switch(this.conn&&this.conn.readyState){case tr.connecting:return lr.Connecting;case tr.open:return lr.Open;case tr.closing:return lr.Closing;default:return lr.Closed}}isConnected(){return this.connectionState()===lr.Open}channel(e,t={config:{}}){const r=new Mr(`realtime:${e}`,t,this);return this.channels.push(r),r}push(e){const{topic:t,event:r,payload:s,ref:n}=e,a=()=>{this.encode(e,e=>{var t;null===(t=this.conn)||void 0===t||t.send(e)})};this.log("push",`${t} ${r} (${n})`,s),this.isConnected()?a():this.sendBuffer.push(a)}setAuth(e){this.accessToken=e,this.channels.forEach(t=>{e&&t.updateJoinPayload({access_token:e}),t.joinedOnce&&t._isJoined()&&t._push(ar.access_token,{access_token:e})})}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let t=this.channels.find(t=>t.topic===e&&(t._isJoined()||t._isJoining()));t&&(this.log("transport",`leaving duplicate topic "${e}"`),t.unsubscribe())}_remove(e){this.channels=this.channels.filter(t=>t._joinRef()!==e._joinRef())}setupConnection(){this.conn&&(this.conn.binaryType="arraybuffer",this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e))}_endPointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:"1.0.0"}))}_onConnMessage(e){this.decode(e.data,e=>{let{topic:t,event:r,payload:s,ref:n}=e;(n&&n===this.pendingHeartbeatRef||r===(null==s?void 0:s.type))&&(this.pendingHeartbeatRef=null),this.log("receive",`${s.status||""} ${t} ${r} ${n&&"("+n+")"||""}`,s),this.channels.filter(e=>e._isMember(t)).forEach(e=>e._trigger(r,s,n)),this.stateChangeCallbacks.message.forEach(t=>t(e))})}_onConnOpen(){this.log("transport",`connected to ${this._endPointURL()}`),this._flushSendBuffer(),this.reconnectTimer.reset(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this._sendHeartbeat(),this.heartbeatIntervalMs),this.stateChangeCallbacks.open.forEach(e=>e())}_onConnClose(e){this.log("transport","close",e),this._triggerChanError(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.scheduleTimeout(),this.stateChangeCallbacks.close.forEach(t=>t(e))}_onConnError(e){this.log("transport",e.message),this._triggerChanError(),this.stateChangeCallbacks.error.forEach(t=>t(e))}_triggerChanError(){this.channels.forEach(e=>e._trigger(ar.error))}_appendParams(e,t){if(0===Object.keys(t).length)return e;const r=e.match(/\?/)?"&":"?";return`${e}${r}${new URLSearchParams(t)}`}_flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_sendHeartbeat(){var e;if(this.isConnected()){if(this.pendingHeartbeatRef)return this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection"),void(null===(e=this.conn)||void 0===e||e.close(1e3,"hearbeat timeout"));this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef}),this.setAuth(this.accessToken)}}}class Lr{constructor(e,t,r){this.binaryType="arraybuffer",this.onclose=()=>{},this.onerror=()=>{},this.onmessage=()=>{},this.onopen=()=>{},this.readyState=tr.connecting,this.send=()=>{},this.url=null,this.url=e,this.close=r.close}}class Fr extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}}function Br(e){return"object"==typeof e&&null!==e&&"__isStorageError"in e}class qr extends Fr{constructor(e,t){super(e),this.name="StorageApiError",this.status=t}toJSON(){return{name:this.name,message:this.message,status:this.status}}}class Ur extends Fr{constructor(e,t){super(e),this.name="StorageUnknownError",this.originalError=t}}var Wr=function(e,t,r,s){return new(r||(r=Promise))(function(n,a){function i(e){try{l(s.next(e))}catch(t){a(t)}}function o(e){try{l(s.throw(e))}catch(t){a(t)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(i,o)}l((s=s.apply(e,t||[])).next())})};const zr=e=>{let t;return t=e||("undefined"==typeof fetch?(...e)=>Ze(async()=>{const{default:e}=await Promise.resolve().then(()=>bt);return{default:e}},void 0).then(({default:t})=>t(...e)):fetch),(...e)=>t(...e)},Hr=e=>{if(Array.isArray(e))return e.map(e=>Hr(e));if("function"==typeof e||e!==Object(e))return e;const t={};return Object.entries(e).forEach(([e,r])=>{const s=e.replace(/([-_][a-z])/gi,e=>e.toUpperCase().replace(/[-_]/g,""));t[s]=Hr(r)}),t};var Kr=function(e,t,r,s){return new(r||(r=Promise))(function(n,a){function i(e){try{l(s.next(e))}catch(t){a(t)}}function o(e){try{l(s.throw(e))}catch(t){a(t)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(i,o)}l((s=s.apply(e,t||[])).next())})};const Vr=e=>e.msg||e.message||e.error_description||e.error||JSON.stringify(e),Jr=(e,t,r)=>Kr(void 0,void 0,void 0,function*(){const s=yield Wr(void 0,void 0,void 0,function*(){return"undefined"==typeof Response?(yield Ze(()=>Promise.resolve().then(()=>bt),void 0)).Response:Response});e instanceof s&&!(null==r?void 0:r.noResolveJson)?e.json().then(r=>{t(new qr(Vr(r),e.status||500))}).catch(e=>{t(new Ur(Vr(e),e))}):t(new Ur(Vr(e),e))});function Yr(e,t,r,s,n,a){return Kr(this,void 0,void 0,function*(){return new Promise((i,o)=>{e(r,((e,t,r,s)=>{const n={method:e,headers:(null==t?void 0:t.headers)||{}};return"GET"===e?n:(n.headers=Object.assign({"Content-Type":"application/json"},null==t?void 0:t.headers),s&&(n.body=JSON.stringify(s)),Object.assign(Object.assign({},n),r))})(t,s,n,a)).then(e=>{if(!e.ok)throw e;return(null==s?void 0:s.noResolveJson)?e:e.json()}).then(e=>i(e)).catch(e=>Jr(e,o,s))})})}function Gr(e,t,r,s){return Kr(this,void 0,void 0,function*(){return Yr(e,"GET",t,r,s)})}function Xr(e,t,r,s,n){return Kr(this,void 0,void 0,function*(){return Yr(e,"POST",t,s,n,r)})}function Qr(e,t,r,s,n){return Kr(this,void 0,void 0,function*(){return Yr(e,"DELETE",t,s,n,r)})}var Zr=function(e,t,r,s){return new(r||(r=Promise))(function(n,a){function i(e){try{l(s.next(e))}catch(t){a(t)}}function o(e){try{l(s.throw(e))}catch(t){a(t)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(i,o)}l((s=s.apply(e,t||[])).next())})};const es={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},ts={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class rs{constructor(e,t={},r,s){this.url=e,this.headers=t,this.bucketId=r,this.fetch=zr(s)}uploadOrUpdate(e,t,r,s){return Zr(this,void 0,void 0,function*(){try{let n;const a=Object.assign(Object.assign({},ts),s);let i=Object.assign(Object.assign({},this.headers),"POST"===e&&{"x-upsert":String(a.upsert)});const o=a.metadata;"undefined"!=typeof Blob&&r instanceof Blob?(n=new FormData,n.append("cacheControl",a.cacheControl),n.append("",r),o&&n.append("metadata",this.encodeMetadata(o))):"undefined"!=typeof FormData&&r instanceof FormData?(n=r,n.append("cacheControl",a.cacheControl),o&&n.append("metadata",this.encodeMetadata(o))):(n=r,i["cache-control"]=`max-age=${a.cacheControl}`,i["content-type"]=a.contentType,o&&(i["x-metadata"]=this.toBase64(this.encodeMetadata(o)))),(null==s?void 0:s.headers)&&(i=Object.assign(Object.assign({},i),s.headers));const l=this._removeEmptyFolders(t),c=this._getFinalPath(l),d=yield this.fetch(`${this.url}/object/${c}`,Object.assign({method:e,body:n,headers:i},(null==a?void 0:a.duplex)?{duplex:a.duplex}:{})),u=yield d.json();if(d.ok)return{data:{path:l,id:u.Id,fullPath:u.Key},error:null};return{data:null,error:u}}catch(n){if(Br(n))return{data:null,error:n};throw n}})}upload(e,t,r){return Zr(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",e,t,r)})}uploadToSignedUrl(e,t,r,s){return Zr(this,void 0,void 0,function*(){const n=this._removeEmptyFolders(e),a=this._getFinalPath(n),i=new URL(this.url+`/object/upload/sign/${a}`);i.searchParams.set("token",t);try{let e;const t=Object.assign({upsert:ts.upsert},s),a=Object.assign(Object.assign({},this.headers),{"x-upsert":String(t.upsert)});"undefined"!=typeof Blob&&r instanceof Blob?(e=new FormData,e.append("cacheControl",t.cacheControl),e.append("",r)):"undefined"!=typeof FormData&&r instanceof FormData?(e=r,e.append("cacheControl",t.cacheControl)):(e=r,a["cache-control"]=`max-age=${t.cacheControl}`,a["content-type"]=t.contentType);const o=yield this.fetch(i.toString(),{method:"PUT",body:e,headers:a}),l=yield o.json();if(o.ok)return{data:{path:n,fullPath:l.Key},error:null};return{data:null,error:l}}catch(o){if(Br(o))return{data:null,error:o};throw o}})}createSignedUploadUrl(e,t){return Zr(this,void 0,void 0,function*(){try{let r=this._getFinalPath(e);const s=Object.assign({},this.headers);(null==t?void 0:t.upsert)&&(s["x-upsert"]="true");const n=yield Xr(this.fetch,`${this.url}/object/upload/sign/${r}`,{},{headers:s}),a=new URL(this.url+n.url),i=a.searchParams.get("token");if(!i)throw new Fr("No token returned by API");return{data:{signedUrl:a.toString(),path:e,token:i},error:null}}catch(r){if(Br(r))return{data:null,error:r};throw r}})}update(e,t,r){return Zr(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",e,t,r)})}move(e,t,r){return Zr(this,void 0,void 0,function*(){try{return{data:yield Xr(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:null==r?void 0:r.destinationBucket},{headers:this.headers}),error:null}}catch(s){if(Br(s))return{data:null,error:s};throw s}})}copy(e,t,r){return Zr(this,void 0,void 0,function*(){try{return{data:{path:(yield Xr(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:null==r?void 0:r.destinationBucket},{headers:this.headers})).Key},error:null}}catch(s){if(Br(s))return{data:null,error:s};throw s}})}createSignedUrl(e,t,r){return Zr(this,void 0,void 0,function*(){try{let s=this._getFinalPath(e),n=yield Xr(this.fetch,`${this.url}/object/sign/${s}`,Object.assign({expiresIn:t},(null==r?void 0:r.transform)?{transform:r.transform}:{}),{headers:this.headers});const a=(null==r?void 0:r.download)?`&download=${!0===r.download?"":r.download}`:"";return n={signedUrl:encodeURI(`${this.url}${n.signedURL}${a}`)},{data:n,error:null}}catch(s){if(Br(s))return{data:null,error:s};throw s}})}createSignedUrls(e,t,r){return Zr(this,void 0,void 0,function*(){try{const s=yield Xr(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:t,paths:e},{headers:this.headers}),n=(null==r?void 0:r.download)?`&download=${!0===r.download?"":r.download}`:"";return{data:s.map(e=>Object.assign(Object.assign({},e),{signedUrl:e.signedURL?encodeURI(`${this.url}${e.signedURL}${n}`):null})),error:null}}catch(s){if(Br(s))return{data:null,error:s};throw s}})}download(e,t){return Zr(this,void 0,void 0,function*(){const r=void 0!==(null==t?void 0:t.transform)?"render/image/authenticated":"object",s=this.transformOptsToQueryString((null==t?void 0:t.transform)||{}),n=s?`?${s}`:"";try{const t=this._getFinalPath(e),s=yield Gr(this.fetch,`${this.url}/${r}/${t}${n}`,{headers:this.headers,noResolveJson:!0});return{data:yield s.blob(),error:null}}catch(a){if(Br(a))return{data:null,error:a};throw a}})}info(e){return Zr(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{const e=yield Gr(this.fetch,`${this.url}/object/info/${t}`,{headers:this.headers});return{data:Hr(e),error:null}}catch(r){if(Br(r))return{data:null,error:r};throw r}})}exists(e){return Zr(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{return yield function(e,t,r,s){return Kr(this,void 0,void 0,function*(){return Yr(e,"HEAD",t,Object.assign(Object.assign({},r),{noResolveJson:!0}),s)})}(this.fetch,`${this.url}/object/${t}`,{headers:this.headers}),{data:!0,error:null}}catch(r){if(Br(r)&&r instanceof Ur){const e=r.originalError;if([400,404].includes(null==e?void 0:e.status))return{data:!1,error:r}}throw r}})}getPublicUrl(e,t){const r=this._getFinalPath(e),s=[],n=(null==t?void 0:t.download)?`download=${!0===t.download?"":t.download}`:"";""!==n&&s.push(n);const a=void 0!==(null==t?void 0:t.transform)?"render/image":"object",i=this.transformOptsToQueryString((null==t?void 0:t.transform)||{});""!==i&&s.push(i);let o=s.join("&");return""!==o&&(o=`?${o}`),{data:{publicUrl:encodeURI(`${this.url}/${a}/public/${r}${o}`)}}}remove(e){return Zr(this,void 0,void 0,function*(){try{return{data:yield Qr(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(t){if(Br(t))return{data:null,error:t};throw t}})}list(e,t,r){return Zr(this,void 0,void 0,function*(){try{const s=Object.assign(Object.assign(Object.assign({},es),t),{prefix:e||""});return{data:yield Xr(this.fetch,`${this.url}/object/list/${this.bucketId}`,s,{headers:this.headers},r),error:null}}catch(s){if(Br(s))return{data:null,error:s};throw s}})}encodeMetadata(e){return JSON.stringify(e)}toBase64(e){return"undefined"!=typeof Buffer?Buffer.from(e).toString("base64"):btoa(e)}_getFinalPath(e){return`${this.bucketId}/${e}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const t=[];return e.width&&t.push(`width=${e.width}`),e.height&&t.push(`height=${e.height}`),e.resize&&t.push(`resize=${e.resize}`),e.format&&t.push(`format=${e.format}`),e.quality&&t.push(`quality=${e.quality}`),t.join("&")}}const ss={"X-Client-Info":"storage-js/2.7.0"};var ns=function(e,t,r,s){return new(r||(r=Promise))(function(t,n){function a(e){try{o(s.next(e))}catch(t){n(t)}}function i(e){try{o(s.throw(e))}catch(t){n(t)}}function o(e){var s;e.done?t(e.value):(s=e.value,s instanceof r?s:new r(function(e){e(s)})).then(a,i)}o((s=s.apply(e,[])).next())})};class as{constructor(e,t={},r){this.url=e,this.headers=Object.assign(Object.assign({},ss),t),this.fetch=zr(r)}listBuckets(){return ns(this,0,void 0,function*(){try{return{data:yield Gr(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(e){if(Br(e))return{data:null,error:e};throw e}})}getBucket(e){return ns(this,0,void 0,function*(){try{return{data:yield Gr(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(t){if(Br(t))return{data:null,error:t};throw t}})}createBucket(e,t={public:!1}){return ns(this,0,void 0,function*(){try{return{data:yield Xr(this.fetch,`${this.url}/bucket`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(r){if(Br(r))return{data:null,error:r};throw r}})}updateBucket(e,t){return ns(this,0,void 0,function*(){try{const r=yield function(e,t,r,s,n){return Kr(this,void 0,void 0,function*(){return Yr(e,"PUT",t,s,n,r)})}(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers});return{data:r,error:null}}catch(r){if(Br(r))return{data:null,error:r};throw r}})}emptyBucket(e){return ns(this,0,void 0,function*(){try{return{data:yield Xr(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(t){if(Br(t))return{data:null,error:t};throw t}})}deleteBucket(e){return ns(this,0,void 0,function*(){try{return{data:yield Qr(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(t){if(Br(t))return{data:null,error:t};throw t}})}}class is extends as{constructor(e,t={},r){super(e,t,r)}from(e){return new rs(this.url,this.headers,e,this.fetch)}}let os="";os="undefined"!=typeof Deno?"deno":"undefined"!=typeof document?"web":"undefined"!=typeof navigator&&"ReactNative"===navigator.product?"react-native":"node";const ls={headers:{"X-Client-Info":`supabase-js-${os}/2.45.4`}},cs={schema:"public"},ds={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},us={};var hs=function(e,t,r,s){return new(r||(r=Promise))(function(n,a){function i(e){try{l(s.next(e))}catch(t){a(t)}}function o(e){try{l(s.throw(e))}catch(t){a(t)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(i,o)}l((s=s.apply(e,t||[])).next())})};const ms=(e,t,r)=>{const s=(e=>{let t;return t=e||("undefined"==typeof fetch?vt:fetch),(...e)=>t(...e)})(r),n="undefined"==typeof Headers?gt:Headers;return(r,a)=>hs(void 0,void 0,void 0,function*(){var i;const o=null!==(i=yield t())&&void 0!==i?i:e;let l=new n(null==a?void 0:a.headers);return l.has("apikey")||l.set("apikey",e),l.has("Authorization")||l.set("Authorization",`Bearer ${o}`),s(r,Object.assign(Object.assign({},a),{headers:l}))})};var fs=function(e,t,r,s){return new(r||(r=Promise))(function(t,n){function a(e){try{o(s.next(e))}catch(t){n(t)}}function i(e){try{o(s.throw(e))}catch(t){n(t)}}function o(e){var s;e.done?t(e.value):(s=e.value,s instanceof r?s:new r(function(e){e(s)})).then(a,i)}o((s=s.apply(e,[])).next())})};const ps="2.65.0",vs={"X-Client-Info":`gotrue-js/${ps}`},gs="X-Supabase-Api-Version",xs={timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"};const ys=()=>"undefined"!=typeof document,bs={tested:!1,writable:!1},ws=()=>{if(!ys())return!1;try{if("object"!=typeof globalThis.localStorage)return!1}catch(t){return!1}if(bs.tested)return bs.writable;const e=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(e,e),globalThis.localStorage.removeItem(e),bs.tested=!0,bs.writable=!0}catch(t){bs.tested=!0,bs.writable=!1}return bs.writable};function js(e){const t={},r=new URL(e);if(r.hash&&"#"===r.hash[0])try{new URLSearchParams(r.hash.substring(1)).forEach((e,r)=>{t[r]=e})}catch(s){}return r.searchParams.forEach((e,r)=>{t[r]=e}),t}const _s=e=>{let t;return t=e||("undefined"==typeof fetch?(...e)=>Ze(async()=>{const{default:e}=await Promise.resolve().then(()=>bt);return{default:e}},void 0).then(({default:t})=>t(...e)):fetch),(...e)=>t(...e)},Ns=async(e,t,r)=>{await e.setItem(t,JSON.stringify(r))},ks=async(e,t)=>{const r=await e.getItem(t);if(!r)return null;try{return JSON.parse(r)}catch(s){return r}},Ss=async(e,t)=>{await e.removeItem(t)};class Cs{constructor(){this.promise=new Cs.promiseConstructor((e,t)=>{this.resolve=e,this.reject=t})}}function Es(e){const t=e.split(".");if(3!==t.length)throw new Error("JWT is not valid: not a JWT structure");if(!/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}=?$|[a-z0-9_-]{2}(==)?$)$/i.test(t[1]))throw new Error("JWT is not valid: payload is not in base64url format");const r=t[1];return JSON.parse(function(e){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";let r,s,n,a,i,o,l,c="",d=0;for(e=e.replace("-","+").replace("_","/");d<e.length;)a=t.indexOf(e.charAt(d++)),i=t.indexOf(e.charAt(d++)),o=t.indexOf(e.charAt(d++)),l=t.indexOf(e.charAt(d++)),r=a<<2|i>>4,s=(15&i)<<4|o>>2,n=(3&o)<<6|l,c+=String.fromCharCode(r),64!=o&&0!=s&&(c+=String.fromCharCode(s)),64!=l&&0!=n&&(c+=String.fromCharCode(n));return c}(r))}function Ts(e){return("0"+e.toString(16)).substr(-2)}async function Ps(e){if(!("undefined"!=typeof crypto&&void 0!==crypto.subtle&&"undefined"!=typeof TextEncoder))return e;const t=await async function(e){const t=(new TextEncoder).encode(e),r=await crypto.subtle.digest("SHA-256",t),s=new Uint8Array(r);return Array.from(s).map(e=>String.fromCharCode(e)).join("")}(e);return btoa(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function Os(e,t,r=!1){const s=function(){const e=new Uint32Array(56);if("undefined"==typeof crypto){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",t=e.length;let r="";for(let s=0;s<56;s++)r+=e.charAt(Math.floor(Math.random()*t));return r}return crypto.getRandomValues(e),Array.from(e,Ts).join("")}();let n=s;r&&(n+="/PASSWORD_RECOVERY"),await Ns(e,`${t}-code-verifier`,n);const a=await Ps(s);return[a,s===a?"plain":"s256"]}Cs.promiseConstructor=Promise;const Ds=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;class Rs extends Error{constructor(e,t,r){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=t,this.code=r}}function Ms(e){return"object"==typeof e&&null!==e&&"__isAuthError"in e}class As extends Rs{constructor(e,t,r){super(e,t,r),this.name="AuthApiError",this.status=t,this.code=r}}class Is extends Rs{constructor(e,t){super(e),this.name="AuthUnknownError",this.originalError=t}}class $s extends Rs{constructor(e,t,r,s){super(e,r,s),this.name=t,this.status=r}}class Ls extends $s{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}class Fs extends $s{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class Bs extends $s{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class qs extends $s{constructor(e,t=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class Us extends $s{constructor(e,t=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class Ws extends $s{constructor(e,t){super(e,"AuthRetryableFetchError",t,void 0)}}function zs(e){return Ms(e)&&"AuthRetryableFetchError"===e.name}class Hs extends $s{constructor(e,t,r){super(e,"AuthWeakPasswordError",t,"weak_password"),this.reasons=r}}const Ks=e=>e.msg||e.message||e.error_description||e.error||JSON.stringify(e),Vs=[502,503,504];async function Js(e){var t,r;if(!("object"==typeof(r=e)&&null!==r&&"status"in r&&"ok"in r&&"json"in r&&"function"==typeof r.json))throw new Ws(Ks(e),0);if(Vs.includes(e.status))throw new Ws(Ks(e),e.status);let s,n;try{s=await e.json()}catch(i){throw new Is(Ks(i),i)}const a=function(e){const t=e.headers.get(gs);if(!t)return null;if(!t.match(Ds))return null;try{return new Date(`${t}T00:00:00.0Z`)}catch(i){return null}}(e);if(a&&a.getTime()>=xs.timestamp&&"object"==typeof s&&s&&"string"==typeof s.code?n=s.code:"object"==typeof s&&s&&"string"==typeof s.error_code&&(n=s.error_code),n){if("weak_password"===n)throw new Hs(Ks(s),e.status,(null===(t=s.weak_password)||void 0===t?void 0:t.reasons)||[]);if("session_not_found"===n)throw new Ls}else if("object"==typeof s&&s&&"object"==typeof s.weak_password&&s.weak_password&&Array.isArray(s.weak_password.reasons)&&s.weak_password.reasons.length&&s.weak_password.reasons.reduce((e,t)=>e&&"string"==typeof t,!0))throw new Hs(Ks(s),e.status,s.weak_password.reasons);throw new As(Ks(s),e.status||500,n)}async function Ys(e,t,r,s){var n;const a=Object.assign({},null==s?void 0:s.headers);a[gs]||(a[gs]=xs.name),(null==s?void 0:s.jwt)&&(a.Authorization=`Bearer ${s.jwt}`);const i=null!==(n=null==s?void 0:s.query)&&void 0!==n?n:{};(null==s?void 0:s.redirectTo)&&(i.redirect_to=s.redirectTo);const o=Object.keys(i).length?"?"+new URLSearchParams(i).toString():"",l=await async function(e,t,r,s,n,a){const i=((e,t,r,s)=>{const n={method:e,headers:(null==t?void 0:t.headers)||{}};return"GET"===e?n:(n.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},null==t?void 0:t.headers),n.body=JSON.stringify(s),Object.assign(Object.assign({},n),r))})(t,s,n,a);let o;try{o=await e(r,Object.assign({},i))}catch(l){throw console.error(l),new Ws(Ks(l),0)}o.ok||await Js(o);if(null==s?void 0:s.noResolveJson)return o;try{return await o.json()}catch(l){await Js(l)}}(e,t,r+o,{headers:a,noResolveJson:null==s?void 0:s.noResolveJson},{},null==s?void 0:s.body);return(null==s?void 0:s.xform)?null==s?void 0:s.xform(l):{data:Object.assign({},l),error:null}}function Gs(e){var t;let r=null;var s;(function(e){return e.access_token&&e.refresh_token&&e.expires_in})(e)&&(r=Object.assign({},e),e.expires_at||(r.expires_at=(s=e.expires_in,Math.round(Date.now()/1e3)+s)));return{data:{session:r,user:null!==(t=e.user)&&void 0!==t?t:e},error:null}}function Xs(e){const t=Gs(e);return!t.error&&e.weak_password&&"object"==typeof e.weak_password&&Array.isArray(e.weak_password.reasons)&&e.weak_password.reasons.length&&e.weak_password.message&&"string"==typeof e.weak_password.message&&e.weak_password.reasons.reduce((e,t)=>e&&"string"==typeof t,!0)&&(t.data.weak_password=e.weak_password),t}function Qs(e){var t;return{data:{user:null!==(t=e.user)&&void 0!==t?t:e},error:null}}function Zs(e){return{data:e,error:null}}function en(e){const{action_link:t,email_otp:r,hashed_token:s,redirect_to:n,verification_type:a}=e,i=function(e,t){var r={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(r[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(s=Object.getOwnPropertySymbols(e);n<s.length;n++)t.indexOf(s[n])<0&&Object.prototype.propertyIsEnumerable.call(e,s[n])&&(r[s[n]]=e[s[n]])}return r}(e,["action_link","email_otp","hashed_token","redirect_to","verification_type"]);return{data:{properties:{action_link:t,email_otp:r,hashed_token:s,redirect_to:n,verification_type:a},user:Object.assign({},i)},error:null}}function tn(e){return e}class rn{constructor({url:e="",headers:t={},fetch:r}){this.url=e,this.headers=t,this.fetch=_s(r),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}async signOut(e,t="global"){try{return await Ys(this.fetch,"POST",`${this.url}/logout?scope=${t}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(r){if(Ms(r))return{data:null,error:r};throw r}}async inviteUserByEmail(e,t={}){try{return await Ys(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:t.data},headers:this.headers,redirectTo:t.redirectTo,xform:Qs})}catch(r){if(Ms(r))return{data:{user:null},error:r};throw r}}async generateLink(e){try{const{options:t}=e,r=function(e,t){var r={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(r[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(s=Object.getOwnPropertySymbols(e);n<s.length;n++)t.indexOf(s[n])<0&&Object.prototype.propertyIsEnumerable.call(e,s[n])&&(r[s[n]]=e[s[n]])}return r}(e,["options"]),s=Object.assign(Object.assign({},r),t);return"newEmail"in r&&(s.new_email=null==r?void 0:r.newEmail,delete s.newEmail),await Ys(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:s,headers:this.headers,xform:en,redirectTo:null==t?void 0:t.redirectTo})}catch(t){if(Ms(t))return{data:{properties:null,user:null},error:t};throw t}}async createUser(e){try{return await Ys(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:Qs})}catch(t){if(Ms(t))return{data:{user:null},error:t};throw t}}async listUsers(e){var t,r,s,n,a,i,o;try{const l={nextPage:null,lastPage:0,total:0},c=await Ys(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:null!==(r=null===(t=null==e?void 0:e.page)||void 0===t?void 0:t.toString())&&void 0!==r?r:"",per_page:null!==(n=null===(s=null==e?void 0:e.perPage)||void 0===s?void 0:s.toString())&&void 0!==n?n:""},xform:tn});if(c.error)throw c.error;const d=await c.json(),u=null!==(a=c.headers.get("x-total-count"))&&void 0!==a?a:0,h=null!==(o=null===(i=c.headers.get("link"))||void 0===i?void 0:i.split(","))&&void 0!==o?o:[];return h.length>0&&(h.forEach(e=>{const t=parseInt(e.split(";")[0].split("=")[1].substring(0,1)),r=JSON.parse(e.split(";")[1].split("=")[1]);l[`${r}Page`]=t}),l.total=parseInt(u)),{data:Object.assign(Object.assign({},d),l),error:null}}catch(l){if(Ms(l))return{data:{users:[]},error:l};throw l}}async getUserById(e){try{return await Ys(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:Qs})}catch(t){if(Ms(t))return{data:{user:null},error:t};throw t}}async updateUserById(e,t){try{return await Ys(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:t,headers:this.headers,xform:Qs})}catch(r){if(Ms(r))return{data:{user:null},error:r};throw r}}async deleteUser(e,t=!1){try{return await Ys(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:t},xform:Qs})}catch(r){if(Ms(r))return{data:{user:null},error:r};throw r}}async _listFactors(e){try{const{data:t,error:r}=await Ys(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:e=>({data:{factors:e},error:null})});return{data:t,error:r}}catch(t){if(Ms(t))return{data:null,error:t};throw t}}async _deleteFactor(e){try{return{data:await Ys(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(t){if(Ms(t))return{data:null,error:t};throw t}}}const sn={getItem:e=>ws()?globalThis.localStorage.getItem(e):null,setItem:(e,t)=>{ws()&&globalThis.localStorage.setItem(e,t)},removeItem:e=>{ws()&&globalThis.localStorage.removeItem(e)}};function nn(e={}){return{getItem:t=>e[t]||null,setItem:(t,r)=>{e[t]=r},removeItem:t=>{delete e[t]}}}const an=!!(globalThis&&ws()&&globalThis.localStorage&&"true"===globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug"));class on extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class ln extends on{}async function cn(e,t,r){const s=new globalThis.AbortController;return t>0&&setTimeout(()=>{s.abort()},t),await globalThis.navigator.locks.request(e,0===t?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:s.signal},async s=>{if(!s){if(0===t)throw new ln(`Acquiring an exclusive Navigator LockManager lock "${e}" immediately failed`);if(an)try{const e=await globalThis.navigator.locks.query();JSON.stringify(e,null,"  ")}catch(n){}return await r()}an&&s.name;try{return await r()}finally{an&&s.name}})}!function(){if("object"!=typeof globalThis)try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch(e){"undefined"!=typeof self&&(self.globalThis=self)}}();const dn={url:"http://localhost:9999",storageKey:"supabase.auth.token",autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:vs,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1},un=3e4;async function hn(e,t,r){return await r()}class mn{constructor(e){var t,r;this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=mn.nextInstanceID,mn.nextInstanceID+=1,this.instanceID>0&&ys();const s=Object.assign(Object.assign({},dn),e);if(this.logDebugMessages=!!s.debug,"function"==typeof s.debug&&(this.logger=s.debug),this.persistSession=s.persistSession,this.storageKey=s.storageKey,this.autoRefreshToken=s.autoRefreshToken,this.admin=new rn({url:s.url,headers:s.headers,fetch:s.fetch}),this.url=s.url,this.headers=s.headers,this.fetch=_s(s.fetch),this.lock=s.lock||hn,this.detectSessionInUrl=s.detectSessionInUrl,this.flowType=s.flowType,this.hasCustomAuthorizationHeader=s.hasCustomAuthorizationHeader,s.lock?this.lock=s.lock:ys()&&(null===(t=null===globalThis||void 0===globalThis?void 0:globalThis.navigator)||void 0===t?void 0:t.locks)?this.lock=cn:this.lock=hn,this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession?s.storage?this.storage=s.storage:ws()?this.storage=sn:(this.memoryStorage={},this.storage=nn(this.memoryStorage)):(this.memoryStorage={},this.storage=nn(this.memoryStorage)),ys()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(n){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",n)}null===(r=this.broadcastChannel)||void 0===r||r.addEventListener("message",async e=>{this._debug("received broadcast notification from other tab or client",e),await this._notifyAllSubscribers(e.data.event,e.data.session,!1)})}this.initialize()}_debug(...e){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${ps}) ${(new Date).toISOString()}`,...e),this}async initialize(){return this.initializePromise||(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))()),await this.initializePromise}async _initialize(){try{const e=!!ys()&&await this._isPKCEFlow();if(this._debug("#_initialize()","begin","is PKCE flow",e),e||this.detectSessionInUrl&&this._isImplicitGrantFlow()){const{data:t,error:r}=await this._getSessionFromURL(e);if(r)return this._debug("#_initialize()","error detecting session from URL",r),"Identity is already linked"===(null==r?void 0:r.message)||"Identity is already linked to another user"===(null==r?void 0:r.message)||await this._removeSession(),{error:r};const{session:s,redirectType:n}=t;return this._debug("#_initialize()","detected session in URL",s,"redirect type",n),await this._saveSession(s),setTimeout(async()=>{"recovery"===n?await this._notifyAllSubscribers("PASSWORD_RECOVERY",s):await this._notifyAllSubscribers("SIGNED_IN",s)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(e){return Ms(e)?{error:e}:{error:new Is("Unexpected error during initialization",e)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var t,r,s;try{const n=await Ys(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:null!==(r=null===(t=null==e?void 0:e.options)||void 0===t?void 0:t.data)&&void 0!==r?r:{},gotrue_meta_security:{captcha_token:null===(s=null==e?void 0:e.options)||void 0===s?void 0:s.captchaToken}},xform:Gs}),{data:a,error:i}=n;if(i||!a)return{data:{user:null,session:null},error:i};const o=a.session,l=a.user;return a.session&&(await this._saveSession(a.session),await this._notifyAllSubscribers("SIGNED_IN",o)),{data:{user:l,session:o},error:null}}catch(n){if(Ms(n))return{data:{user:null,session:null},error:n};throw n}}async signUp(e){var t,r,s;try{let n;if("email"in e){const{email:r,password:s,options:a}=e;let i=null,o=null;"pkce"===this.flowType&&([i,o]=await Os(this.storage,this.storageKey)),n=await Ys(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:null==a?void 0:a.emailRedirectTo,body:{email:r,password:s,data:null!==(t=null==a?void 0:a.data)&&void 0!==t?t:{},gotrue_meta_security:{captcha_token:null==a?void 0:a.captchaToken},code_challenge:i,code_challenge_method:o},xform:Gs})}else{if(!("phone"in e))throw new Bs("You must provide either an email or phone number and a password");{const{phone:t,password:a,options:i}=e;n=await Ys(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:t,password:a,data:null!==(r=null==i?void 0:i.data)&&void 0!==r?r:{},channel:null!==(s=null==i?void 0:i.channel)&&void 0!==s?s:"sms",gotrue_meta_security:{captcha_token:null==i?void 0:i.captchaToken}},xform:Gs})}}const{data:a,error:i}=n;if(i||!a)return{data:{user:null,session:null},error:i};const o=a.session,l=a.user;return a.session&&(await this._saveSession(a.session),await this._notifyAllSubscribers("SIGNED_IN",o)),{data:{user:l,session:o},error:null}}catch(n){if(Ms(n))return{data:{user:null,session:null},error:n};throw n}}async signInWithPassword(e){try{let t;if("email"in e){const{email:r,password:s,options:n}=e;t=await Ys(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:r,password:s,gotrue_meta_security:{captcha_token:null==n?void 0:n.captchaToken}},xform:Xs})}else{if(!("phone"in e))throw new Bs("You must provide either an email or phone number and a password");{const{phone:r,password:s,options:n}=e;t=await Ys(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:r,password:s,gotrue_meta_security:{captcha_token:null==n?void 0:n.captchaToken}},xform:Xs})}}const{data:r,error:s}=t;return s?{data:{user:null,session:null},error:s}:r&&r.session&&r.user?(r.session&&(await this._saveSession(r.session),await this._notifyAllSubscribers("SIGNED_IN",r.session)),{data:Object.assign({user:r.user,session:r.session},r.weak_password?{weakPassword:r.weak_password}:null),error:s}):{data:{user:null,session:null},error:new Fs}}catch(t){if(Ms(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOAuth(e){var t,r,s,n;return await this._handleProviderSignIn(e.provider,{redirectTo:null===(t=e.options)||void 0===t?void 0:t.redirectTo,scopes:null===(r=e.options)||void 0===r?void 0:r.scopes,queryParams:null===(s=e.options)||void 0===s?void 0:s.queryParams,skipBrowserRedirect:null===(n=e.options)||void 0===n?void 0:n.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(e))}async _exchangeCodeForSession(e){const t=await ks(this.storage,`${this.storageKey}-code-verifier`),[r,s]=(null!=t?t:"").split("/");try{const{data:t,error:n}=await Ys(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:r},xform:Gs});if(await Ss(this.storage,`${this.storageKey}-code-verifier`),n)throw n;return t&&t.session&&t.user?(t.session&&(await this._saveSession(t.session),await this._notifyAllSubscribers("SIGNED_IN",t.session)),{data:Object.assign(Object.assign({},t),{redirectType:null!=s?s:null}),error:n}):{data:{user:null,session:null,redirectType:null},error:new Fs}}catch(n){if(Ms(n))return{data:{user:null,session:null,redirectType:null},error:n};throw n}}async signInWithIdToken(e){try{const{options:t,provider:r,token:s,access_token:n,nonce:a}=e,i=await Ys(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:r,id_token:s,access_token:n,nonce:a,gotrue_meta_security:{captcha_token:null==t?void 0:t.captchaToken}},xform:Gs}),{data:o,error:l}=i;return l?{data:{user:null,session:null},error:l}:o&&o.session&&o.user?(o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",o.session)),{data:o,error:l}):{data:{user:null,session:null},error:new Fs}}catch(t){if(Ms(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOtp(e){var t,r,s,n,a;try{if("email"in e){const{email:s,options:n}=e;let a=null,i=null;"pkce"===this.flowType&&([a,i]=await Os(this.storage,this.storageKey));const{error:o}=await Ys(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:s,data:null!==(t=null==n?void 0:n.data)&&void 0!==t?t:{},create_user:null===(r=null==n?void 0:n.shouldCreateUser)||void 0===r||r,gotrue_meta_security:{captcha_token:null==n?void 0:n.captchaToken},code_challenge:a,code_challenge_method:i},redirectTo:null==n?void 0:n.emailRedirectTo});return{data:{user:null,session:null},error:o}}if("phone"in e){const{phone:t,options:r}=e,{data:i,error:o}=await Ys(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:t,data:null!==(s=null==r?void 0:r.data)&&void 0!==s?s:{},create_user:null===(n=null==r?void 0:r.shouldCreateUser)||void 0===n||n,gotrue_meta_security:{captcha_token:null==r?void 0:r.captchaToken},channel:null!==(a=null==r?void 0:r.channel)&&void 0!==a?a:"sms"}});return{data:{user:null,session:null,messageId:null==i?void 0:i.message_id},error:o}}throw new Bs("You must provide either an email or phone number.")}catch(i){if(Ms(i))return{data:{user:null,session:null},error:i};throw i}}async verifyOtp(e){var t,r;try{let s,n;"options"in e&&(s=null===(t=e.options)||void 0===t?void 0:t.redirectTo,n=null===(r=e.options)||void 0===r?void 0:r.captchaToken);const{data:a,error:i}=await Ys(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:n}}),redirectTo:s,xform:Gs});if(i)throw i;if(!a)throw new Error("An error occurred on token verification.");const o=a.session,l=a.user;return(null==o?void 0:o.access_token)&&(await this._saveSession(o),await this._notifyAllSubscribers("recovery"==e.type?"PASSWORD_RECOVERY":"SIGNED_IN",o)),{data:{user:l,session:o},error:null}}catch(s){if(Ms(s))return{data:{user:null,session:null},error:s};throw s}}async signInWithSSO(e){var t,r,s;try{let n=null,a=null;return"pkce"===this.flowType&&([n,a]=await Os(this.storage,this.storageKey)),await Ys(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:null!==(r=null===(t=e.options)||void 0===t?void 0:t.redirectTo)&&void 0!==r?r:void 0}),(null===(s=null==e?void 0:e.options)||void 0===s?void 0:s.captchaToken)?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:n,code_challenge_method:a}),headers:this.headers,xform:Zs})}catch(n){if(Ms(n))return{data:null,error:n};throw n}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{const{data:{session:t},error:r}=e;if(r)throw r;if(!t)throw new Ls;const{error:s}=await Ys(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:t.access_token});return{data:{user:null,session:null},error:s}})}catch(e){if(Ms(e))return{data:{user:null,session:null},error:e};throw e}}async resend(e){try{const t=`${this.url}/resend`;if("email"in e){const{email:r,type:s,options:n}=e,{error:a}=await Ys(this.fetch,"POST",t,{headers:this.headers,body:{email:r,type:s,gotrue_meta_security:{captcha_token:null==n?void 0:n.captchaToken}},redirectTo:null==n?void 0:n.emailRedirectTo});return{data:{user:null,session:null},error:a}}if("phone"in e){const{phone:r,type:s,options:n}=e,{data:a,error:i}=await Ys(this.fetch,"POST",t,{headers:this.headers,body:{phone:r,type:s,gotrue_meta_security:{captcha_token:null==n?void 0:n.captchaToken}}});return{data:{user:null,session:null,messageId:null==a?void 0:a.message_id},error:i}}throw new Bs("You must provide either an email or phone number and a type")}catch(t){if(Ms(t))return{data:{user:null,session:null},error:t};throw t}}async getSession(){await this.initializePromise;return await this._acquireLock(-1,async()=>this._useSession(async e=>e))}async _acquireLock(e,t){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const e=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),r=(async()=>(await e,await t()))();return this.pendingInLock.push((async()=>{try{await r}catch(e){}})()),r}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const e=t();for(this.pendingInLock.push((async()=>{try{await e}catch(t){}})()),await e;this.pendingInLock.length;){const e=[...this.pendingInLock];await Promise.all(e),this.pendingInLock.splice(0,e.length)}return await e}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const t=await this.__loadSession();return await e(t)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",(new Error).stack);try{let e=null;const t=await ks(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",t),null!==t&&(this._isValidSession(t)?e=t:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const r=!!e.expires_at&&e.expires_at<=Date.now()/1e3;if(this._debug("#__loadSession()",`session has${r?"":" not"} expired`,"expires_at",e.expires_at),!r){if(this.storage.isServer){let t=this.suppressGetSessionWarning;e=new Proxy(e,{get:(e,r,s)=>(t||"user"!==r||(t=!0,this.suppressGetSessionWarning=!0),Reflect.get(e,r,s))})}return{data:{session:e},error:null}}const{session:s,error:n}=await this._callRefreshToken(e.refresh_token);return n?{data:{session:null},error:n}:{data:{session:s},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(e){if(e)return await this._getUser(e);await this.initializePromise;return await this._acquireLock(-1,async()=>await this._getUser())}async _getUser(e){try{return e?await Ys(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:Qs}):await this._useSession(async e=>{var t,r,s;const{data:n,error:a}=e;if(a)throw a;return(null===(t=n.session)||void 0===t?void 0:t.access_token)||this.hasCustomAuthorizationHeader?await Ys(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:null!==(s=null===(r=n.session)||void 0===r?void 0:r.access_token)&&void 0!==s?s:void 0,xform:Qs}):{data:{user:null},error:new Ls}})}catch(t){if(Ms(t))return function(e){return Ms(e)&&"AuthSessionMissingError"===e.name}(t)&&(await this._removeSession(),await Ss(this.storage,`${this.storageKey}-code-verifier`),await this._notifyAllSubscribers("SIGNED_OUT",null)),{data:{user:null},error:t};throw t}}async updateUser(e,t={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(e,t))}async _updateUser(e,t={}){try{return await this._useSession(async r=>{const{data:s,error:n}=r;if(n)throw n;if(!s.session)throw new Ls;const a=s.session;let i=null,o=null;"pkce"===this.flowType&&null!=e.email&&([i,o]=await Os(this.storage,this.storageKey));const{data:l,error:c}=await Ys(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:null==t?void 0:t.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:i,code_challenge_method:o}),jwt:a.access_token,xform:Qs});if(c)throw c;return a.user=l.user,await this._saveSession(a),await this._notifyAllSubscribers("USER_UPDATED",a),{data:{user:a.user},error:null}})}catch(r){if(Ms(r))return{data:{user:null},error:r};throw r}}_decodeJWT(e){return Es(e)}async setSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new Ls;const t=Date.now()/1e3;let r=t,s=!0,n=null;const a=Es(e.access_token);if(a.exp&&(r=a.exp,s=r<=t),s){const{session:t,error:r}=await this._callRefreshToken(e.refresh_token);if(r)return{data:{user:null,session:null},error:r};if(!t)return{data:{user:null,session:null},error:null};n=t}else{const{data:s,error:a}=await this._getUser(e.access_token);if(a)throw a;n={access_token:e.access_token,refresh_token:e.refresh_token,user:s.user,token_type:"bearer",expires_in:r-t,expires_at:r},await this._saveSession(n),await this._notifyAllSubscribers("SIGNED_IN",n)}return{data:{user:n.user,session:n},error:null}}catch(t){if(Ms(t))return{data:{session:null,user:null},error:t};throw t}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async t=>{var r;if(!e){const{data:s,error:n}=t;if(n)throw n;e=null!==(r=s.session)&&void 0!==r?r:void 0}if(!(null==e?void 0:e.refresh_token))throw new Ls;const{session:s,error:n}=await this._callRefreshToken(e.refresh_token);return n?{data:{user:null,session:null},error:n}:s?{data:{user:s.user,session:s},error:null}:{data:{user:null,session:null},error:null}})}catch(t){if(Ms(t))return{data:{user:null,session:null},error:t};throw t}}async _getSessionFromURL(e){try{if(!ys())throw new qs("No browser detected.");if("implicit"===this.flowType&&!this._isImplicitGrantFlow())throw new qs("Not a valid implicit grant flow url.");if("pkce"==this.flowType&&!e)throw new Us("Not a valid PKCE flow url.");const t=js(window.location.href);if(e){if(!t.code)throw new Us("No code detected.");const{data:e,error:r}=await this._exchangeCodeForSession(t.code);if(r)throw r;const s=new URL(window.location.href);return s.searchParams.delete("code"),window.history.replaceState(window.history.state,"",s.toString()),{data:{session:e.session,redirectType:null},error:null}}if(t.error||t.error_description||t.error_code)throw new qs(t.error_description||"Error in URL with unspecified error_description",{error:t.error||"unspecified_error",code:t.error_code||"unspecified_code"});const{provider_token:r,provider_refresh_token:s,access_token:n,refresh_token:a,expires_in:i,expires_at:o,token_type:l}=t;if(!(n&&i&&a&&l))throw new qs("No session defined in URL");const c=Math.round(Date.now()/1e3),d=parseInt(i);let u=c+d;o&&(u=parseInt(o));const{data:h,error:m}=await this._getUser(n);if(m)throw m;const f={provider_token:r,provider_refresh_token:s,access_token:n,expires_in:d,expires_at:u,refresh_token:a,token_type:l,user:h.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:f,redirectType:t.type},error:null}}catch(t){if(Ms(t))return{data:{session:null,redirectType:null},error:t};throw t}}_isImplicitGrantFlow(){const e=js(window.location.href);return!(!ys()||!e.access_token&&!e.error_description)}async _isPKCEFlow(){const e=js(window.location.href),t=await ks(this.storage,`${this.storageKey}-code-verifier`);return!(!e.code||!t)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async t=>{var r;const{data:s,error:n}=t;if(n)return{error:n};const a=null===(r=s.session)||void 0===r?void 0:r.access_token;if(a){const{error:t}=await this.admin.signOut(a,e);if(t&&(!function(e){return Ms(e)&&"AuthApiError"===e.name}(t)||404!==t.status&&401!==t.status&&403!==t.status))return{error:t}}return"others"!==e&&(await this._removeSession(),await Ss(this.storage,`${this.storageKey}-code-verifier`),await this._notifyAllSubscribers("SIGNED_OUT",null)),{error:null}})}onAuthStateChange(e){const t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){const t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)}),r={id:t,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",t),this.stateChangeEmitters.delete(t)}};return this._debug("#onAuthStateChange()","registered callback with id",t),this.stateChangeEmitters.set(t,r),(async()=>{await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(t)})})(),{data:{subscription:r}}}async _emitInitialSession(e){return await this._useSession(async t=>{var r,s;try{const{data:{session:s},error:n}=t;if(n)throw n;await(null===(r=this.stateChangeEmitters.get(e))||void 0===r?void 0:r.callback("INITIAL_SESSION",s)),this._debug("INITIAL_SESSION","callback id",e,"session",s)}catch(n){await(null===(s=this.stateChangeEmitters.get(e))||void 0===s?void 0:s.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",n),console.error(n)}})}async resetPasswordForEmail(e,t={}){let r=null,s=null;"pkce"===this.flowType&&([r,s]=await Os(this.storage,this.storageKey,!0));try{return await Ys(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:r,code_challenge_method:s,gotrue_meta_security:{captcha_token:t.captchaToken}},headers:this.headers,redirectTo:t.redirectTo})}catch(n){if(Ms(n))return{data:null,error:n};throw n}}async getUserIdentities(){var e;try{const{data:t,error:r}=await this.getUser();if(r)throw r;return{data:{identities:null!==(e=t.user.identities)&&void 0!==e?e:[]},error:null}}catch(t){if(Ms(t))return{data:null,error:t};throw t}}async linkIdentity(e){var t;try{const{data:r,error:s}=await this._useSession(async t=>{var r,s,n,a,i;const{data:o,error:l}=t;if(l)throw l;const c=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:null===(r=e.options)||void 0===r?void 0:r.redirectTo,scopes:null===(s=e.options)||void 0===s?void 0:s.scopes,queryParams:null===(n=e.options)||void 0===n?void 0:n.queryParams,skipBrowserRedirect:!0});return await Ys(this.fetch,"GET",c,{headers:this.headers,jwt:null!==(i=null===(a=o.session)||void 0===a?void 0:a.access_token)&&void 0!==i?i:void 0})});if(s)throw s;return ys()&&!(null===(t=e.options)||void 0===t?void 0:t.skipBrowserRedirect)&&window.location.assign(null==r?void 0:r.url),{data:{provider:e.provider,url:null==r?void 0:r.url},error:null}}catch(r){if(Ms(r))return{data:{provider:e.provider,url:null},error:r};throw r}}async unlinkIdentity(e){try{return await this._useSession(async t=>{var r,s;const{data:n,error:a}=t;if(a)throw a;return await Ys(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:null!==(s=null===(r=n.session)||void 0===r?void 0:r.access_token)&&void 0!==s?s:void 0})})}catch(t){if(Ms(t))return{data:null,error:t};throw t}}async _refreshAccessToken(e){const t=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(t,"begin");try{const n=Date.now();return await(r=async r=>(r>0&&await async function(e){return await new Promise(t=>{setTimeout(()=>t(null),e)})}(200*Math.pow(2,r-1)),this._debug(t,"refreshing attempt",r),await Ys(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:Gs})),s=(e,t)=>{const r=200*Math.pow(2,e);return t&&zs(t)&&Date.now()+r-n<un},new Promise((e,t)=>{(async()=>{for(let a=0;a<1/0;a++)try{const t=await r(a);if(!s(a,null,t))return void e(t)}catch(n){if(!s(a,n))return void t(n)}})()}))}catch(n){if(this._debug(t,"error",n),Ms(n))return{data:{session:null,user:null},error:n};throw n}finally{this._debug(t,"end")}var r,s}_isValidSession(e){return"object"==typeof e&&null!==e&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,t){const r=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:t.redirectTo,scopes:t.scopes,queryParams:t.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",t,"url",r),ys()&&!t.skipBrowserRedirect&&window.location.assign(r),{data:{provider:e,url:r},error:null}}async _recoverAndRefresh(){var e;const t="#_recoverAndRefresh()";this._debug(t,"begin");try{const r=await ks(this.storage,this.storageKey);if(this._debug(t,"session from storage",r),!this._isValidSession(r))return this._debug(t,"session is not valid"),void(null!==r&&await this._removeSession());const s=Math.round(Date.now()/1e3),n=(null!==(e=r.expires_at)&&void 0!==e?e:1/0)<s+10;if(this._debug(t,`session has${n?"":" not"} expired with margin of 10s`),n){if(this.autoRefreshToken&&r.refresh_token){const{error:e}=await this._callRefreshToken(r.refresh_token);e&&(console.error(e),zs(e)||(this._debug(t,"refresh failed with a non-retryable error, removing the session",e),await this._removeSession()))}}else await this._notifyAllSubscribers("SIGNED_IN",r)}catch(r){return this._debug(t,"error",r),void console.error(r)}finally{this._debug(t,"end")}}async _callRefreshToken(e){var t,r;if(!e)throw new Ls;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const s=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(s,"begin");try{this.refreshingDeferred=new Cs;const{data:t,error:r}=await this._refreshAccessToken(e);if(r)throw r;if(!t.session)throw new Ls;await this._saveSession(t.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",t.session);const s={session:t.session,error:null};return this.refreshingDeferred.resolve(s),s}catch(n){if(this._debug(s,"error",n),Ms(n)){const e={session:null,error:n};return zs(n)||(await this._removeSession(),await this._notifyAllSubscribers("SIGNED_OUT",null)),null===(t=this.refreshingDeferred)||void 0===t||t.resolve(e),e}throw null===(r=this.refreshingDeferred)||void 0===r||r.reject(n),n}finally{this.refreshingDeferred=null,this._debug(s,"end")}}async _notifyAllSubscribers(e,t,r=!0){const s=`#_notifyAllSubscribers(${e})`;this._debug(s,"begin",t,`broadcast = ${r}`);try{this.broadcastChannel&&r&&this.broadcastChannel.postMessage({event:e,session:t});const s=[],n=Array.from(this.stateChangeEmitters.values()).map(async r=>{try{await r.callback(e,t)}catch(n){s.push(n)}});if(await Promise.all(n),s.length>0){for(let e=0;e<s.length;e+=1)console.error(s[e]);throw s[0]}}finally{this._debug(s,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0,await Ns(this.storage,this.storageKey,e)}async _removeSession(){this._debug("#_removeSession()"),await Ss(this.storage,this.storageKey)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&ys()&&(null===window||void 0===window?void 0:window.removeEventListener)&&window.removeEventListener("visibilitychange",e)}catch(t){console.error("removing visibilitychange callback failed",t)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),un);this.autoRefreshTicker=e,e&&"object"==typeof e&&"function"==typeof e.unref?e.unref():"undefined"!=typeof Deno&&"function"==typeof Deno.unrefTimer&&Deno.unrefTimer(e),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const t=Date.now();try{return await this._useSession(async e=>{const{data:{session:r}}=e;if(!r||!r.refresh_token||!r.expires_at)return void this._debug("#_autoRefreshTokenTick()","no session");const s=Math.floor((1e3*r.expires_at-t)/un);this._debug("#_autoRefreshTokenTick()",`access token expires in ${s} ticks, a tick lasts 30000ms, refresh threshold is 3 ticks`),s<=3&&await this._callRefreshToken(r.refresh_token)})}catch(e){console.error("Auto refresh tick failed with error. This is likely a transient error.",e)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(!(e.isAcquireTimeout||e instanceof on))throw e;this._debug("auto refresh token tick lock not available")}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!ys()||!(null===window||void 0===window?void 0:window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),null===window||void 0===window||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){const t=`#_onVisibilityChanged(${e})`;this._debug(t,"visibilityState",document.visibilityState),"visible"===document.visibilityState?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(-1,async()=>{"visible"===document.visibilityState?await this._recoverAndRefresh():this._debug(t,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting")}))):"hidden"===document.visibilityState&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,t,r){const s=[`provider=${encodeURIComponent(t)}`];if((null==r?void 0:r.redirectTo)&&s.push(`redirect_to=${encodeURIComponent(r.redirectTo)}`),(null==r?void 0:r.scopes)&&s.push(`scopes=${encodeURIComponent(r.scopes)}`),"pkce"===this.flowType){const[e,t]=await Os(this.storage,this.storageKey),r=new URLSearchParams({code_challenge:`${encodeURIComponent(e)}`,code_challenge_method:`${encodeURIComponent(t)}`});s.push(r.toString())}if(null==r?void 0:r.queryParams){const e=new URLSearchParams(r.queryParams);s.push(e.toString())}return(null==r?void 0:r.skipBrowserRedirect)&&s.push(`skip_http_redirect=${r.skipBrowserRedirect}`),`${e}?${s.join("&")}`}async _unenroll(e){try{return await this._useSession(async t=>{var r;const{data:s,error:n}=t;return n?{data:null,error:n}:await Ys(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:null===(r=null==s?void 0:s.session)||void 0===r?void 0:r.access_token})})}catch(t){if(Ms(t))return{data:null,error:t};throw t}}async _enroll(e){try{return await this._useSession(async t=>{var r,s;const{data:n,error:a}=t;if(a)return{data:null,error:a};const i=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},"phone"===e.factorType?{phone:e.phone}:{issuer:e.issuer}),{data:o,error:l}=await Ys(this.fetch,"POST",`${this.url}/factors`,{body:i,headers:this.headers,jwt:null===(r=null==n?void 0:n.session)||void 0===r?void 0:r.access_token});return l?{data:null,error:l}:("phone"===e.factorType&&delete o.totp,"totp"===e.factorType&&(null===(s=null==o?void 0:o.totp)||void 0===s?void 0:s.qr_code)&&(o.totp.qr_code=`data:image/svg+xml;utf-8,${o.totp.qr_code}`),{data:o,error:null})})}catch(t){if(Ms(t))return{data:null,error:t};throw t}}async _verify(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var r;const{data:s,error:n}=t;if(n)return{data:null,error:n};const{data:a,error:i}=await Ys(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:{code:e.code,challenge_id:e.challengeId},headers:this.headers,jwt:null===(r=null==s?void 0:s.session)||void 0===r?void 0:r.access_token});return i?{data:null,error:i}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+a.expires_in},a)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",a),{data:a,error:i})})}catch(t){if(Ms(t))return{data:null,error:t};throw t}})}async _challenge(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var r;const{data:s,error:n}=t;return n?{data:null,error:n}:await Ys(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:{channel:e.channel},headers:this.headers,jwt:null===(r=null==s?void 0:s.session)||void 0===r?void 0:r.access_token})})}catch(t){if(Ms(t))return{data:null,error:t};throw t}})}async _challengeAndVerify(e){const{data:t,error:r}=await this._challenge({factorId:e.factorId});return r?{data:null,error:r}:await this._verify({factorId:e.factorId,challengeId:t.id,code:e.code})}async _listFactors(){const{data:{user:e},error:t}=await this.getUser();if(t)return{data:null,error:t};const r=(null==e?void 0:e.factors)||[],s=r.filter(e=>"totp"===e.factor_type&&"verified"===e.status),n=r.filter(e=>"phone"===e.factor_type&&"verified"===e.status);return{data:{all:r,totp:s,phone:n},error:null}}async _getAuthenticatorAssuranceLevel(){return this._acquireLock(-1,async()=>await this._useSession(async e=>{var t,r;const{data:{session:s},error:n}=e;if(n)return{data:null,error:n};if(!s)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const a=this._decodeJWT(s.access_token);let i=null;a.aal&&(i=a.aal);let o=i;(null!==(r=null===(t=s.user.factors)||void 0===t?void 0:t.filter(e=>"verified"===e.status))&&void 0!==r?r:[]).length>0&&(o="aal2");return{data:{currentLevel:i,nextLevel:o,currentAuthenticationMethods:a.amr||[]},error:null}}))}}mn.nextInstanceID=0;const fn=mn;class pn extends fn{constructor(e){super(e)}}var vn=function(e,t,r,s){return new(r||(r=Promise))(function(t,n){function a(e){try{o(s.next(e))}catch(t){n(t)}}function i(e){try{o(s.throw(e))}catch(t){n(t)}}function o(e){var s;e.done?t(e.value):(s=e.value,s instanceof r?s:new r(function(e){e(s)})).then(a,i)}o((s=s.apply(e,[])).next())})};class gn{constructor(e,t,r){var s,n,a;if(this.supabaseUrl=e,this.supabaseKey=t,!e)throw new Error("supabaseUrl is required.");if(!t)throw new Error("supabaseKey is required.");const i=e.replace(/\/$/,"");this.realtimeUrl=`${i}/realtime/v1`.replace(/^http/i,"ws"),this.authUrl=`${i}/auth/v1`,this.storageUrl=`${i}/storage/v1`,this.functionsUrl=`${i}/functions/v1`;const o=`sb-${new URL(this.authUrl).hostname.split(".")[0]}-auth-token`,l=function(e,t){const{db:r,auth:s,realtime:n,global:a}=e,{db:i,auth:o,realtime:l,global:c}=t,d={db:Object.assign(Object.assign({},i),r),auth:Object.assign(Object.assign({},o),s),realtime:Object.assign(Object.assign({},l),n),global:Object.assign(Object.assign({},c),a),accessToken:()=>fs(this,0,void 0,function*(){return""})};return e.accessToken?d.accessToken=e.accessToken:delete d.accessToken,d}(null!=r?r:{},{db:cs,realtime:us,auth:Object.assign(Object.assign({},ds),{storageKey:o}),global:ls});this.storageKey=null!==(s=l.auth.storageKey)&&void 0!==s?s:"",this.headers=null!==(n=l.global.headers)&&void 0!==n?n:{},l.accessToken?(this.accessToken=l.accessToken,this.auth=new Proxy({},{get:(e,t)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(t)} is not possible`)}})):this.auth=this._initSupabaseAuthClient(null!==(a=l.auth)&&void 0!==a?a:{},this.headers,l.global.fetch),this.fetch=ms(t,this._getAccessToken.bind(this),l.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers},l.realtime)),this.rest=new Yt(`${i}/rest/v1`,{headers:this.headers,schema:l.db.schema,fetch:this.fetch}),l.accessToken||this._listenForAuthEvents()}get functions(){return new ot(this.functionsUrl,{headers:this.headers,customFetch:this.fetch})}get storage(){return new is(this.storageUrl,this.headers,this.fetch)}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,t={},r={}){return this.rest.rpc(e,t,r)}channel(e,t={config:{}}){return this.realtime.channel(e,t)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var e,t;return vn(this,0,void 0,function*(){if(this.accessToken)return yield this.accessToken();const{data:r}=yield this.auth.getSession();return null!==(t=null===(e=r.session)||void 0===e?void 0:e.access_token)&&void 0!==t?t:null})}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:t,detectSessionInUrl:r,storage:s,storageKey:n,flowType:a,lock:i,debug:o},l,c){var d;const u={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new pn({url:this.authUrl,headers:Object.assign(Object.assign({},u),l),storageKey:n,autoRefreshToken:e,persistSession:t,detectSessionInUrl:r,storage:s,flowType:a,lock:i,debug:o,fetch:c,hasCustomAuthorizationHeader:null!==(d="Authorization"in this.headers)&&void 0!==d&&d})}_initRealtimeClient(e){return new $r(this.realtimeUrl,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},null==e?void 0:e.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((e,t)=>{this._handleTokenChanged(e,"CLIENT",null==t?void 0:t.access_token)})}_handleTokenChanged(e,t,r){"TOKEN_REFRESHED"!==e&&"SIGNED_IN"!==e||this.changedAccessToken===r?"SIGNED_OUT"===e&&(this.realtime.setAuth(this.supabaseKey),"STORAGE"==t&&this.auth.signOut(),this.changedAccessToken=void 0):(this.realtime.setAuth(null!=r?r:null),this.changedAccessToken=r)}}const xn="https://wybhtprxiwgzmpmnfceq.supabase.co",yn=new gn(xn,"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Ind5Ymh0cHJ4aXdnem1wbW5mY2VxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTEwMzIwODksImV4cCI6MjA2NjYwODA4OX0.ctFmwHC_iitVB16WB7lY616lIp0CAHBUGRaoi56ruqc",bn);var bn;const wn=W.createContext({user:null,loading:!0,signOut:async()=>{}}),jn=()=>{const e=W.useContext(wn);if(!e)throw new Error("useAuth must be used within an AuthProvider");return e};function _n({children:t}){const[r,s]=W.useState(null),n=H(),[a,i]=W.useState(!0),[o,l]=W.useState(!1);return W.useEffect(()=>{let e=!0;const{data:{subscription:t}}=yn.auth.onAuthStateChange(async(t,r)=>{e&&(s((null==r?void 0:r.user)??null),"SIGNED_IN"===t?setTimeout(()=>{"/login"!==window.location.pathname&&"/signup"!==window.location.pathname||n("/",{replace:!0})},100):"SIGNED_OUT"===t&&(s(null),n("/login",{replace:!0})),o||l(!0),i(!1))});return(async()=>{try{const{data:{session:t},error:r}=await yn.auth.getSession();r&&console.error("Error getting session:",r),e&&(s((null==t?void 0:t.user)??null),i(!1),l(!0),(null==t?void 0:t.user)&&"/login"===window.location.pathname?n("/",{replace:!0}):(null==t?void 0:t.user)||"/login"===window.location.pathname||"/signup"===window.location.pathname||n("/login",{replace:!0}))}catch(t){console.error("Error initializing auth:",t),e&&(i(!1),l(!0))}})(),()=>{e=!1,t.unsubscribe()}},[n,o]),e.jsx(wn.Provider,{value:{user:r,loading:a,signOut:async()=>{try{await yn.auth.signOut(),s(null),n("/login")}catch(e){console.error("Error signing out:",e)}}},children:t})}let Nn=0;const kn=new Map,Sn=e=>{if(kn.has(e))return;const t=setTimeout(()=>{kn.delete(e),Pn({type:"REMOVE_TOAST",toastId:e})},1e6);kn.set(e,t)},Cn=(e,t)=>{switch(t.type){case"ADD_TOAST":return{...e,toasts:[t.toast,...e.toasts].slice(0,1)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(e=>e.id===t.toast.id?{...e,...t.toast}:e)};case"DISMISS_TOAST":{const{toastId:r}=t;return r?Sn(r):e.toasts.forEach(e=>{Sn(e.id)}),{...e,toasts:e.toasts.map(e=>e.id===r||void 0===r?{...e,open:!1}:e)}}case"REMOVE_TOAST":return void 0===t.toastId?{...e,toasts:[]}:{...e,toasts:e.toasts.filter(e=>e.id!==t.toastId)}}},En=[];let Tn={toasts:[]};function Pn(e){Tn=Cn(Tn,e),En.forEach(e=>{e(Tn)})}function On({...e}){const t=(Nn=(Nn+1)%Number.MAX_SAFE_INTEGER,Nn.toString()),r=()=>Pn({type:"DISMISS_TOAST",toastId:t});return Pn({type:"ADD_TOAST",toast:{...e,id:t,open:!0,onOpenChange:e=>{e||r()}}}),{id:t,dismiss:r,update:e=>Pn({type:"UPDATE_TOAST",toast:{...e,id:t}})}}function Dn(){const[e,t]=W.useState(Tn);return W.useEffect(()=>(En.push(t),()=>{const e=En.indexOf(t);e>-1&&En.splice(e,1)}),[e]),{...e,toast:On,dismiss:e=>Pn({type:"DISMISS_TOAST",toastId:e})}}var Rn=Object.freeze({position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal"}),Mn=W.forwardRef((r,s)=>e.jsx(t.span,{...r,ref:s,style:{...Rn,...r.style}}));Mn.displayName="VisuallyHidden";var An="ToastProvider",[In,$n,Ln]=r("Toast"),[Fn,Bn]=s("Toast",[Ln]),[qn,Un]=Fn(An),Wn=t=>{const{__scopeToast:r,label:s="Notification",duration:n=5e3,swipeDirection:a="right",swipeThreshold:i=50,children:o}=t,[l,c]=W.useState(null),[d,u]=W.useState(0),h=W.useRef(!1),m=W.useRef(!1);return s.trim()||console.error(`Invalid prop \`label\` supplied to \`${An}\`. Expected non-empty \`string\`.`),e.jsx(In.Provider,{scope:r,children:e.jsx(qn,{scope:r,label:s,duration:n,swipeDirection:a,swipeThreshold:i,toastCount:d,viewport:l,onViewportChange:c,onToastAdd:W.useCallback(()=>u(e=>e+1),[]),onToastRemove:W.useCallback(()=>u(e=>e-1),[]),isFocusedToastEscapeKeyDownRef:h,isClosePausedRef:m,children:o})})};Wn.displayName=An;var zn="ToastViewport",Hn=["F8"],Kn="toast.viewportPause",Vn="toast.viewportResume",Jn=W.forwardRef((r,s)=>{const{__scopeToast:i,hotkey:o=Hn,label:l="Notifications ({hotkey})",...c}=r,d=Un(zn,i),u=$n(i),h=W.useRef(null),m=W.useRef(null),f=W.useRef(null),p=W.useRef(null),v=n(s,p,d.onViewportChange),g=o.join("+").replace(/Key/g,"").replace(/Digit/g,""),x=d.toastCount>0;W.useEffect(()=>{const e=e=>{var t;0!==o.length&&o.every(t=>e[t]||e.code===t)&&(null==(t=p.current)||t.focus())};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[o]),W.useEffect(()=>{const e=h.current,t=p.current;if(x&&e&&t){const r=()=>{if(!d.isClosePausedRef.current){const e=new CustomEvent(Kn);t.dispatchEvent(e),d.isClosePausedRef.current=!0}},s=()=>{if(d.isClosePausedRef.current){const e=new CustomEvent(Vn);t.dispatchEvent(e),d.isClosePausedRef.current=!1}},n=t=>{!e.contains(t.relatedTarget)&&s()},a=()=>{e.contains(document.activeElement)||s()};return e.addEventListener("focusin",r),e.addEventListener("focusout",n),e.addEventListener("pointermove",r),e.addEventListener("pointerleave",a),window.addEventListener("blur",r),window.addEventListener("focus",s),()=>{e.removeEventListener("focusin",r),e.removeEventListener("focusout",n),e.removeEventListener("pointermove",r),e.removeEventListener("pointerleave",a),window.removeEventListener("blur",r),window.removeEventListener("focus",s)}}},[x,d.isClosePausedRef]);const y=W.useCallback(({tabbingDirection:e})=>{const t=u().map(t=>{const r=t.ref.current,s=[r,...ma(r)];return"forwards"===e?s:s.reverse()});return("forwards"===e?t.reverse():t).flat()},[u]);return W.useEffect(()=>{const e=p.current;if(e){const t=t=>{var r,s,n;const a=t.altKey||t.ctrlKey||t.metaKey;if("Tab"===t.key&&!a){const a=document.activeElement,i=t.shiftKey;if(t.target===e&&i)return void(null==(r=m.current)||r.focus());const o=y({tabbingDirection:i?"backwards":"forwards"}),l=o.findIndex(e=>e===a);fa(o.slice(l+1))?t.preventDefault():i?null==(s=m.current)||s.focus():null==(n=f.current)||n.focus()}};return e.addEventListener("keydown",t),()=>e.removeEventListener("keydown",t)}},[u,y]),e.jsxs(a,{ref:h,role:"region","aria-label":l.replace("{hotkey}",g),tabIndex:-1,style:{pointerEvents:x?void 0:"none"},children:[x&&e.jsx(Gn,{ref:m,onFocusFromOutsideViewport:()=>{fa(y({tabbingDirection:"forwards"}))}}),e.jsx(In.Slot,{scope:i,children:e.jsx(t.ol,{tabIndex:-1,...c,ref:v})}),x&&e.jsx(Gn,{ref:f,onFocusFromOutsideViewport:()=>{fa(y({tabbingDirection:"backwards"}))}})]})});Jn.displayName=zn;var Yn="ToastFocusProxy",Gn=W.forwardRef((t,r)=>{const{__scopeToast:s,onFocusFromOutsideViewport:n,...a}=t,i=Un(Yn,s);return e.jsx(Mn,{"aria-hidden":!0,tabIndex:0,...a,ref:r,style:{position:"fixed"},onFocus:e=>{var t;const r=e.relatedTarget;!(null==(t=i.viewport)?void 0:t.contains(r))&&n()}})});Gn.displayName=Yn;var Xn="Toast",Qn=W.forwardRef((t,r)=>{const{forceMount:s,open:n,defaultOpen:a,onOpenChange:d,...u}=t,[h,m]=i({prop:n,defaultProp:a??!0,onChange:d,caller:Xn});return e.jsx(o,{present:s||h,children:e.jsx(ta,{open:h,...u,ref:r,onClose:()=>m(!1),onPause:l(t.onPause),onResume:l(t.onResume),onSwipeStart:c(t.onSwipeStart,e=>{e.currentTarget.setAttribute("data-swipe","start")}),onSwipeMove:c(t.onSwipeMove,e=>{const{x:t,y:r}=e.detail.delta;e.currentTarget.setAttribute("data-swipe","move"),e.currentTarget.style.setProperty("--radix-toast-swipe-move-x",`${t}px`),e.currentTarget.style.setProperty("--radix-toast-swipe-move-y",`${r}px`)}),onSwipeCancel:c(t.onSwipeCancel,e=>{e.currentTarget.setAttribute("data-swipe","cancel"),e.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),e.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),e.currentTarget.style.removeProperty("--radix-toast-swipe-end-x"),e.currentTarget.style.removeProperty("--radix-toast-swipe-end-y")}),onSwipeEnd:c(t.onSwipeEnd,e=>{const{x:t,y:r}=e.detail.delta;e.currentTarget.setAttribute("data-swipe","end"),e.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),e.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),e.currentTarget.style.setProperty("--radix-toast-swipe-end-x",`${t}px`),e.currentTarget.style.setProperty("--radix-toast-swipe-end-y",`${r}px`),m(!1)})})})});Qn.displayName=Xn;var[Zn,ea]=Fn(Xn,{onClose(){}}),ta=W.forwardRef((r,s)=>{const{__scopeToast:a,type:i="foreground",duration:o,open:u,onClose:h,onEscapeKeyDown:m,onPause:f,onResume:p,onSwipeStart:v,onSwipeMove:g,onSwipeCancel:x,onSwipeEnd:y,...b}=r,w=Un(Xn,a),[j,_]=W.useState(null),N=n(s,e=>_(e)),k=W.useRef(null),S=W.useRef(null),C=o||w.duration,E=W.useRef(0),T=W.useRef(C),P=W.useRef(0),{onToastAdd:O,onToastRemove:D}=w,R=l(()=>{var e;(null==j?void 0:j.contains(document.activeElement))&&(null==(e=w.viewport)||e.focus()),h()}),M=W.useCallback(e=>{e&&e!==1/0&&(window.clearTimeout(P.current),E.current=(new Date).getTime(),P.current=window.setTimeout(R,e))},[R]);W.useEffect(()=>{const e=w.viewport;if(e){const t=()=>{M(T.current),null==p||p()},r=()=>{const e=(new Date).getTime()-E.current;T.current=T.current-e,window.clearTimeout(P.current),null==f||f()};return e.addEventListener(Kn,r),e.addEventListener(Vn,t),()=>{e.removeEventListener(Kn,r),e.removeEventListener(Vn,t)}}},[w.viewport,C,f,p,M]),W.useEffect(()=>{u&&!w.isClosePausedRef.current&&M(C)},[u,C,w.isClosePausedRef,M]),W.useEffect(()=>(O(),()=>D()),[O,D]);const A=W.useMemo(()=>j?da(j):null,[j]);return w.viewport?e.jsxs(e.Fragment,{children:[A&&e.jsx(ra,{__scopeToast:a,role:"status","aria-live":"foreground"===i?"assertive":"polite","aria-atomic":!0,children:A}),e.jsx(Zn,{scope:a,onClose:R,children:B.createPortal(e.jsx(In.ItemSlot,{scope:a,children:e.jsx(d,{asChild:!0,onEscapeKeyDown:c(m,()=>{w.isFocusedToastEscapeKeyDownRef.current||R(),w.isFocusedToastEscapeKeyDownRef.current=!1}),children:e.jsx(t.li,{role:"status","aria-live":"off","aria-atomic":!0,tabIndex:0,"data-state":u?"open":"closed","data-swipe-direction":w.swipeDirection,...b,ref:N,style:{userSelect:"none",touchAction:"none",...r.style},onKeyDown:c(r.onKeyDown,e=>{"Escape"===e.key&&(null==m||m(e.nativeEvent),e.nativeEvent.defaultPrevented||(w.isFocusedToastEscapeKeyDownRef.current=!0,R()))}),onPointerDown:c(r.onPointerDown,e=>{0===e.button&&(k.current={x:e.clientX,y:e.clientY})}),onPointerMove:c(r.onPointerMove,e=>{if(!k.current)return;const t=e.clientX-k.current.x,r=e.clientY-k.current.y,s=Boolean(S.current),n=["left","right"].includes(w.swipeDirection),a=["left","up"].includes(w.swipeDirection)?Math.min:Math.max,i=n?a(0,t):0,o=n?0:a(0,r),l="touch"===e.pointerType?10:2,c={x:i,y:o},d={originalEvent:e,delta:c};s?(S.current=c,ua("toast.swipeMove",g,d,{discrete:!1})):ha(c,w.swipeDirection,l)?(S.current=c,ua("toast.swipeStart",v,d,{discrete:!1}),e.target.setPointerCapture(e.pointerId)):(Math.abs(t)>l||Math.abs(r)>l)&&(k.current=null)}),onPointerUp:c(r.onPointerUp,e=>{const t=S.current,r=e.target;if(r.hasPointerCapture(e.pointerId)&&r.releasePointerCapture(e.pointerId),S.current=null,k.current=null,t){const r=e.currentTarget,s={originalEvent:e,delta:t};ha(t,w.swipeDirection,w.swipeThreshold)?ua("toast.swipeEnd",y,s,{discrete:!0}):ua("toast.swipeCancel",x,s,{discrete:!0}),r.addEventListener("click",e=>e.preventDefault(),{once:!0})}})})})}),w.viewport)})]}):null}),ra=t=>{const{__scopeToast:r,children:s,...n}=t,a=Un(Xn,r),[i,o]=W.useState(!1),[c,d]=W.useState(!1);return function(e=()=>{}){const t=l(e);h(()=>{let e=0,r=0;return e=window.requestAnimationFrame(()=>r=window.requestAnimationFrame(t)),()=>{window.cancelAnimationFrame(e),window.cancelAnimationFrame(r)}},[t])}(()=>o(!0)),W.useEffect(()=>{const e=window.setTimeout(()=>d(!0),1e3);return()=>window.clearTimeout(e)},[]),c?null:e.jsx(u,{asChild:!0,children:e.jsx(Mn,{...n,children:i&&e.jsxs(e.Fragment,{children:[a.label," ",s]})})})},sa=W.forwardRef((r,s)=>{const{__scopeToast:n,...a}=r;return e.jsx(t.div,{...a,ref:s})});sa.displayName="ToastTitle";var na=W.forwardRef((r,s)=>{const{__scopeToast:n,...a}=r;return e.jsx(t.div,{...a,ref:s})});na.displayName="ToastDescription";var aa="ToastAction",ia=W.forwardRef((t,r)=>{const{altText:s,...n}=t;return s.trim()?e.jsx(ca,{altText:s,asChild:!0,children:e.jsx(la,{...n,ref:r})}):(console.error(`Invalid prop \`altText\` supplied to \`${aa}\`. Expected non-empty \`string\`.`),null)});ia.displayName=aa;var oa="ToastClose",la=W.forwardRef((r,s)=>{const{__scopeToast:n,...a}=r,i=ea(oa,n);return e.jsx(ca,{asChild:!0,children:e.jsx(t.button,{type:"button",...a,ref:s,onClick:c(r.onClick,i.onClose)})})});la.displayName=oa;var ca=W.forwardRef((r,s)=>{const{__scopeToast:n,altText:a,...i}=r;return e.jsx(t.div,{"data-radix-toast-announce-exclude":"","data-radix-toast-announce-alt":a||void 0,...i,ref:s})});function da(e){const t=[];return Array.from(e.childNodes).forEach(e=>{if(e.nodeType===e.TEXT_NODE&&e.textContent&&t.push(e.textContent),function(e){return e.nodeType===e.ELEMENT_NODE}(e)){const r=e.ariaHidden||e.hidden||"none"===e.style.display,s=""===e.dataset.radixToastAnnounceExclude;if(!r)if(s){const r=e.dataset.radixToastAnnounceAlt;r&&t.push(r)}else t.push(...da(e))}}),t}function ua(e,t,r,{discrete:s}){const n=r.originalEvent.currentTarget,a=new CustomEvent(e,{bubbles:!0,cancelable:!0,detail:r});t&&n.addEventListener(e,t,{once:!0}),s?m(n,a):n.dispatchEvent(a)}var ha=(e,t,r=0)=>{const s=Math.abs(e.x),n=Math.abs(e.y),a=s>n;return"left"===t||"right"===t?a&&s>r:!a&&n>r};function ma(e){const t=[],r=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:e=>{const t="INPUT"===e.tagName&&"hidden"===e.type;return e.disabled||e.hidden||t?NodeFilter.FILTER_SKIP:e.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;r.nextNode();)t.push(r.currentNode);return t}function fa(e){const t=document.activeElement;return e.some(e=>e===t||(e.focus(),document.activeElement!==t))}var pa=Jn,va=Qn,ga=sa,xa=na,ya=ia,ba=la;const wa=e=>"boolean"==typeof e?`${e}`:0===e?"0":e,ja=Q,_a=(e,t)=>r=>{var s;if(null==(null==t?void 0:t.variants))return ja(e,null==r?void 0:r.class,null==r?void 0:r.className);const{variants:n,defaultVariants:a}=t,i=Object.keys(n).map(e=>{const t=null==r?void 0:r[e],s=null==a?void 0:a[e];if(null===t)return null;const i=wa(t)||wa(s);return n[e][i]}),o=r&&Object.entries(r).reduce((e,t)=>{let[r,s]=t;return void 0===s||(e[r]=s),e},{}),l=null==t||null===(s=t.compoundVariants)||void 0===s?void 0:s.reduce((e,t)=>{let{class:r,className:s,...n}=t;return Object.entries(n).every(e=>{let[t,r]=e;return Array.isArray(r)?r.includes({...a,...o}[t]):{...a,...o}[t]===r})?[...e,r,s]:e},[]);return ja(e,i,l,null==r?void 0:r.class,null==r?void 0:r.className)};function Na(...e){return Z(Q(e))}const ka=Wn,Sa=W.forwardRef(({className:t,...r},s)=>e.jsx(pa,{ref:s,className:Na("fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]",t),...r}));Sa.displayName=pa.displayName;const Ca=_a("group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full",{variants:{variant:{default:"border bg-background text-foreground",destructive:"destructive group border-destructive bg-destructive text-destructive-foreground"}},defaultVariants:{variant:"default"}}),Ea=W.forwardRef(({className:t,variant:r,...s},n)=>e.jsx(va,{ref:n,className:Na(Ca({variant:r}),t),...s}));Ea.displayName=va.displayName;W.forwardRef(({className:t,...r},s)=>e.jsx(ya,{ref:s,className:Na("inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive",t),...r})).displayName=ya.displayName;const Ta=W.forwardRef(({className:t,...r},s)=>e.jsx(ba,{ref:s,className:Na("absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600",t),"toast-close":"",...r,children:e.jsx(ee,{className:"h-4 w-4"})}));Ta.displayName=ba.displayName;const Pa=W.forwardRef(({className:t,...r},s)=>e.jsx(ga,{ref:s,className:Na("text-sm font-semibold",t),...r}));Pa.displayName=ga.displayName;const Oa=W.forwardRef(({className:t,...r},s)=>e.jsx(xa,{ref:s,className:Na("text-sm opacity-90",t),...r}));function Da(){const{toasts:t}=Dn();return e.jsxs(ka,{children:[t.map(function({id:t,title:r,description:s,action:n,...a}){return e.jsxs(Ea,{...a,children:[e.jsxs("div",{className:"grid gap-1",children:[r&&e.jsx(Pa,{children:r}),s&&e.jsx(Oa,{children:s})]}),n,e.jsx(Ta,{})]},t)}),e.jsx(Sa,{})]})}Oa.displayName=xa.displayName;const Ra=_a("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),Ma=W.forwardRef(({className:t,variant:r,size:s,asChild:n=!1,...a},i)=>{const o=n?f:"button";return e.jsx(o,{className:Na(Ra({variant:r,size:s,className:t})),ref:i,...a})});Ma.displayName="Button";const Aa=[{name:"Dashboard",href:"/",icon:le,badge:null},{name:"Campagnes",href:"/campaigns",icon:ce,badge:null},{name:"Projets",href:"/projects",icon:de,badge:null},{name:"Analytics",href:"/analytics",icon:ue,badge:"Nouveau"},{name:"Email Templates",href:"/email-templates",icon:he,badge:null},{name:"Lead Generation",href:"/lead-generation",icon:me,badge:"IA"},{name:"Paramètres",href:"/settings",icon:fe,badge:null}];function Ia({children:t,title:r}){const s=H(),n=K(),{signOut:a}=jn(),[i,o]=W.useState(!1);return e.jsxs("div",{className:"flex min-h-screen w-full bg-gradient-to-br from-slate-50 via-blue-50/30 to-purple-50/20",children:[i&&e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm transition-all duration-300 lg:hidden z-40 premun-fade-in",onClick:()=>o(!1)}),e.jsx("div",{className:`\n        fixed inset-y-0 left-0 z-50 w-72 glass-morphism shadow-2xl transform transition-all duration-500 ease-out lg:translate-x-0 lg:static lg:inset-0 lg:flex lg:flex-col\n        ${i?"translate-x-0":"-translate-x-full"}\n      `,children:e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsxs("div",{className:"flex items-center justify-between h-20 px-6 border-b border-white/20",children:[e.jsx("div",{className:"flex flex-col animate-slide-down",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-10 h-10 gradient-primary rounded-xl flex items-center justify-center shadow-lg hover-lift",children:e.jsxs("div",{className:"relative",children:[e.jsx(te,{className:"w-5 h-5 text-white"}),e.jsx(re,{className:"w-3 h-3 text-yellow-300 absolute -top-1 -right-1 animate-pulse"})]})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-xl font-bold gradient-text leading-tight",children:"Premun IA"}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("span",{className:"text-xs text-slate-600 font-medium",children:"by"}),e.jsx("span",{className:"text-xs font-semibold text-slate-700",children:"MEKNI Hamdi"}),e.jsx(se,{className:"w-3 h-3 text-green-500"})]})]})]})}),e.jsx(Ma,{variant:"ghost",size:"sm",className:"lg:hidden hover:bg-white/20 rounded-xl transition-all duration-200",onClick:()=>o(!1),children:e.jsx(ee,{className:"w-5 h-5"})})]}),e.jsxs("nav",{className:"flex-1 px-4 py-6 space-y-2 overflow-y-auto",children:[e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"flex items-center space-x-2 px-2 mb-3",children:[e.jsx(ne,{className:"w-4 h-4 text-slate-500"}),e.jsx("span",{className:"text-xs font-semibold text-slate-500 uppercase tracking-wider",children:"Navigation"})]})}),Aa.map((t,r)=>{const a=n.pathname===t.href,i=t.icon;return e.jsx("div",{className:"transform transition-all duration-200",style:{animationDelay:50*r+"ms"},children:e.jsxs(Ma,{variant:a?"default":"ghost",className:`\n                      w-full justify-start space-x-3 rounded-xl transition-all duration-300 hover-lift relative group\n                      ${a?"gradient-primary text-white shadow-lg hover:shadow-xl":"text-slate-700 hover:bg-white/60 hover:text-slate-900 hover:shadow-md"}\n                    `,onClick:()=>{s(t.href),o(!1)},children:[e.jsx(i,{className:"w-5 h-5 transition-transform duration-200 "+(a?"":"group-hover:scale-110")}),e.jsx("span",{className:"font-medium flex-1 text-left",children:t.name}),t.badge&&e.jsx("span",{className:`\n                        px-2 py-0.5 text-xs font-bold rounded-full transition-all duration-200\n                        ${"IA"===t.badge?"bg-gradient-to-r from-purple-500 to-pink-500 text-white":"Nouveau"===t.badge?"bg-gradient-to-r from-green-500 to-emerald-500 text-white":"bg-slate-100 text-slate-700"}\n                      `,children:t.badge}),a&&e.jsx(ae,{className:"w-4 h-4 ml-2 animate-bounce-gentle"}),!a&&e.jsx("div",{className:"absolute inset-0 rounded-xl bg-gradient-to-r from-transparent via-white/20 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300 transform -skew-x-12"})]})},t.name)})]}),e.jsxs("div",{className:"p-4 border-t border-white/20",children:[e.jsxs("div",{className:"mb-3 p-3 rounded-xl bg-gradient-to-r from-blue-50 to-purple-50 border border-blue-100",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-1",children:[e.jsx("div",{className:"w-2 h-2 bg-green-400 rounded-full animate-pulse"}),e.jsx("span",{className:"text-xs font-medium text-slate-600",children:"Système actif"})]}),e.jsx("div",{className:"text-xs text-slate-500",children:"CRM connecté et opérationnel"})]}),e.jsxs(Ma,{variant:"ghost",className:"w-full justify-start space-x-3 text-slate-700 hover:bg-red-50 hover:text-red-600 rounded-xl transition-all duration-200 hover-lift",onClick:async()=>{try{await a(),s("/login")}catch(e){console.error("Error signing out:",e)}},children:[e.jsx(ie,{className:"w-5 h-5"}),e.jsx("span",{className:"font-medium",children:"Déconnexion"})]})]})]})}),e.jsxs("div",{className:"flex-1 flex flex-col",children:[e.jsx("header",{className:"bg-white border-b border-slate-200 lg:hidden",children:e.jsx("div",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("button",{className:"p-2 rounded-lg hover:bg-slate-100",onClick:()=>o(!0),children:e.jsx(oe,{className:"w-5 h-5"})}),e.jsx("div",{className:"w-8 h-8 bg-slate-600 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-sm font-medium text-white",children:"MH"})})]})})}),e.jsx("main",{className:"flex-1 bg-slate-50 min-h-screen",children:t})]})]})}function $a(e){const t=Object.prototype.toString.call(e);return e instanceof Date||"object"==typeof e&&"[object Date]"===t?new e.constructor(+e):"number"==typeof e||"[object Number]"===t||"string"==typeof e||"[object String]"===t?new Date(e):new Date(NaN)}function La(e,t){return e instanceof Date?new e.constructor(t):new Date(t)}function Fa(e,t){const r=$a(e);return isNaN(t)?La(e,NaN):t?(r.setDate(r.getDate()+t),r):r}function Ba(e,t){const r=$a(e);if(isNaN(t))return La(e,NaN);if(!t)return r;const s=r.getDate(),n=La(e,r.getTime());n.setMonth(r.getMonth()+t+1,0);return s>=n.getDate()?n:(r.setFullYear(n.getFullYear(),n.getMonth(),s),r)}const qa=6048e5;let Ua={};function Wa(){return Ua}function za(e,t){var r,s,n,a;const i=Wa(),o=(null==t?void 0:t.weekStartsOn)??(null==(s=null==(r=null==t?void 0:t.locale)?void 0:r.options)?void 0:s.weekStartsOn)??i.weekStartsOn??(null==(a=null==(n=i.locale)?void 0:n.options)?void 0:a.weekStartsOn)??0,l=$a(e),c=l.getDay(),d=(c<o?7:0)+c-o;return l.setDate(l.getDate()-d),l.setHours(0,0,0,0),l}function Ha(e){return za(e,{weekStartsOn:1})}function Ka(e){const t=$a(e),r=t.getFullYear(),s=La(e,0);s.setFullYear(r+1,0,4),s.setHours(0,0,0,0);const n=Ha(s),a=La(e,0);a.setFullYear(r,0,4),a.setHours(0,0,0,0);const i=Ha(a);return t.getTime()>=n.getTime()?r+1:t.getTime()>=i.getTime()?r:r-1}function Va(e){const t=$a(e);return t.setHours(0,0,0,0),t}function Ja(e){const t=$a(e),r=new Date(Date.UTC(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds(),t.getMilliseconds()));return r.setUTCFullYear(t.getFullYear()),+e-+r}function Ya(e,t){const r=Va(e),s=Va(t),n=+r-Ja(r),a=+s-Ja(s);return Math.round((n-a)/864e5)}function Ga(e,t){return Fa(e,7*t)}function Xa(e,t){return Ba(e,12*t)}function Qa(e,t){return+Va(e)===+Va(t)}function Za(e){return e instanceof Date||"object"==typeof e&&"[object Date]"===Object.prototype.toString.call(e)}function ei(e,t){const r=$a(e),s=$a(t);return 12*(r.getFullYear()-s.getFullYear())+(r.getMonth()-s.getMonth())}function ti(e){const t=$a(e),r=t.getMonth();return t.setFullYear(t.getFullYear(),r+1,0),t.setHours(23,59,59,999),t}function ri(e){const t=$a(e);return t.setDate(1),t.setHours(0,0,0,0),t}function si(e){const t=$a(e),r=La(e,0);return r.setFullYear(t.getFullYear(),0,1),r.setHours(0,0,0,0),r}function ni(e,t){var r,s,n,a;const i=Wa(),o=(null==t?void 0:t.weekStartsOn)??(null==(s=null==(r=null==t?void 0:t.locale)?void 0:r.options)?void 0:s.weekStartsOn)??i.weekStartsOn??(null==(a=null==(n=i.locale)?void 0:n.options)?void 0:a.weekStartsOn)??0,l=$a(e),c=l.getDay(),d=6+(c<o?-7:0)-(c-o);return l.setDate(l.getDate()+d),l.setHours(23,59,59,999),l}function ai(e){return ni(e,{weekStartsOn:1})}const ii={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}};function oi(e){return(t={})=>{const r=t.width?String(t.width):e.defaultWidth;return e.formats[r]||e.formats[e.defaultWidth]}}const li={date:oi({formats:{full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},defaultWidth:"full"}),time:oi({formats:{full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},defaultWidth:"full"}),dateTime:oi({formats:{full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},defaultWidth:"full"})},ci={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"};function di(e){return(t,r)=>{let s;if("formatting"===((null==r?void 0:r.context)?String(r.context):"standalone")&&e.formattingValues){const t=e.defaultFormattingWidth||e.defaultWidth,n=(null==r?void 0:r.width)?String(r.width):t;s=e.formattingValues[n]||e.formattingValues[t]}else{const t=e.defaultWidth,n=(null==r?void 0:r.width)?String(r.width):e.defaultWidth;s=e.values[n]||e.values[t]}return s[e.argumentCallback?e.argumentCallback(t):t]}}function ui(e){return(t,r={})=>{const s=r.width,n=s&&e.matchPatterns[s]||e.matchPatterns[e.defaultMatchWidth],a=t.match(n);if(!a)return null;const i=a[0],o=s&&e.parsePatterns[s]||e.parsePatterns[e.defaultParseWidth],l=Array.isArray(o)?function(e,t){for(let r=0;r<e.length;r++)if(t(e[r]))return r;return}(o,e=>e.test(i)):function(e,t){for(const r in e)if(Object.prototype.hasOwnProperty.call(e,r)&&t(e[r]))return r;return}(o,e=>e.test(i));let c;c=e.valueCallback?e.valueCallback(l):l,c=r.valueCallback?r.valueCallback(c):c;return{value:c,rest:t.slice(i.length)}}}function hi(e){return(t,r={})=>{const s=t.match(e.matchPattern);if(!s)return null;const n=s[0],a=t.match(e.parsePattern);if(!a)return null;let i=e.valueCallback?e.valueCallback(a[0]):a[0];i=r.valueCallback?r.valueCallback(i):i;return{value:i,rest:t.slice(n.length)}}}const mi={code:"en-US",formatDistance:(e,t,r)=>{let s;const n=ii[e];return s="string"==typeof n?n:1===t?n.one:n.other.replace("{{count}}",t.toString()),(null==r?void 0:r.addSuffix)?r.comparison&&r.comparison>0?"in "+s:s+" ago":s},formatLong:li,formatRelative:(e,t,r,s)=>ci[e],localize:{ordinalNumber:(e,t)=>{const r=Number(e),s=r%100;if(s>20||s<10)switch(s%10){case 1:return r+"st";case 2:return r+"nd";case 3:return r+"rd"}return r+"th"},era:di({values:{narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},defaultWidth:"wide"}),quarter:di({values:{narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},defaultWidth:"wide",argumentCallback:e=>e-1}),month:di({values:{narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},defaultWidth:"wide"}),day:di({values:{narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},defaultWidth:"wide"}),dayPeriod:di({values:{narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},defaultWidth:"wide",formattingValues:{narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},defaultFormattingWidth:"wide"})},match:{ordinalNumber:hi({matchPattern:/^(\d+)(th|st|nd|rd)?/i,parsePattern:/\d+/i,valueCallback:e=>parseInt(e,10)}),era:ui({matchPatterns:{narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},defaultMatchWidth:"wide",parsePatterns:{any:[/^b/i,/^(a|c)/i]},defaultParseWidth:"any"}),quarter:ui({matchPatterns:{narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},defaultMatchWidth:"wide",parsePatterns:{any:[/1/i,/2/i,/3/i,/4/i]},defaultParseWidth:"any",valueCallback:e=>e+1}),month:ui({matchPatterns:{narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},defaultMatchWidth:"wide",parsePatterns:{narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},defaultParseWidth:"any"}),day:ui({matchPatterns:{narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},defaultMatchWidth:"wide",parsePatterns:{narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},defaultParseWidth:"any"}),dayPeriod:ui({matchPatterns:{narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},defaultMatchWidth:"any",parsePatterns:{any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},defaultParseWidth:"any"})},options:{weekStartsOn:0,firstWeekContainsDate:1}};function fi(e){const t=$a(e),r=+Ha(t)-+function(e){const t=Ka(e),r=La(e,0);return r.setFullYear(t,0,4),r.setHours(0,0,0,0),Ha(r)}(t);return Math.round(r/qa)+1}function pi(e,t){var r,s,n,a;const i=$a(e),o=i.getFullYear(),l=Wa(),c=(null==t?void 0:t.firstWeekContainsDate)??(null==(s=null==(r=null==t?void 0:t.locale)?void 0:r.options)?void 0:s.firstWeekContainsDate)??l.firstWeekContainsDate??(null==(a=null==(n=l.locale)?void 0:n.options)?void 0:a.firstWeekContainsDate)??1,d=La(e,0);d.setFullYear(o+1,0,c),d.setHours(0,0,0,0);const u=za(d,t),h=La(e,0);h.setFullYear(o,0,c),h.setHours(0,0,0,0);const m=za(h,t);return i.getTime()>=u.getTime()?o+1:i.getTime()>=m.getTime()?o:o-1}function vi(e,t){const r=$a(e),s=+za(r,t)-+function(e,t){var r,s,n,a;const i=Wa(),o=(null==t?void 0:t.firstWeekContainsDate)??(null==(s=null==(r=null==t?void 0:t.locale)?void 0:r.options)?void 0:s.firstWeekContainsDate)??i.firstWeekContainsDate??(null==(a=null==(n=i.locale)?void 0:n.options)?void 0:a.firstWeekContainsDate)??1,l=pi(e,t),c=La(e,0);return c.setFullYear(l,0,o),c.setHours(0,0,0,0),za(c,t)}(r,t);return Math.round(s/qa)+1}function gi(e,t){return(e<0?"-":"")+Math.abs(e).toString().padStart(t,"0")}const xi={y(e,t){const r=e.getFullYear(),s=r>0?r:1-r;return gi("yy"===t?s%100:s,t.length)},M(e,t){const r=e.getMonth();return"M"===t?String(r+1):gi(r+1,2)},d:(e,t)=>gi(e.getDate(),t.length),a(e,t){const r=e.getHours()/12>=1?"pm":"am";switch(t){case"a":case"aa":return r.toUpperCase();case"aaa":return r;case"aaaaa":return r[0];default:return"am"===r?"a.m.":"p.m."}},h:(e,t)=>gi(e.getHours()%12||12,t.length),H:(e,t)=>gi(e.getHours(),t.length),m:(e,t)=>gi(e.getMinutes(),t.length),s:(e,t)=>gi(e.getSeconds(),t.length),S(e,t){const r=t.length,s=e.getMilliseconds();return gi(Math.trunc(s*Math.pow(10,r-3)),t.length)}},yi="midnight",bi="noon",wi="morning",ji="afternoon",_i="evening",Ni="night",ki={G:function(e,t,r){const s=e.getFullYear()>0?1:0;switch(t){case"G":case"GG":case"GGG":return r.era(s,{width:"abbreviated"});case"GGGGG":return r.era(s,{width:"narrow"});default:return r.era(s,{width:"wide"})}},y:function(e,t,r){if("yo"===t){const t=e.getFullYear(),s=t>0?t:1-t;return r.ordinalNumber(s,{unit:"year"})}return xi.y(e,t)},Y:function(e,t,r,s){const n=pi(e,s),a=n>0?n:1-n;if("YY"===t){return gi(a%100,2)}return"Yo"===t?r.ordinalNumber(a,{unit:"year"}):gi(a,t.length)},R:function(e,t){return gi(Ka(e),t.length)},u:function(e,t){return gi(e.getFullYear(),t.length)},Q:function(e,t,r){const s=Math.ceil((e.getMonth()+1)/3);switch(t){case"Q":return String(s);case"QQ":return gi(s,2);case"Qo":return r.ordinalNumber(s,{unit:"quarter"});case"QQQ":return r.quarter(s,{width:"abbreviated",context:"formatting"});case"QQQQQ":return r.quarter(s,{width:"narrow",context:"formatting"});default:return r.quarter(s,{width:"wide",context:"formatting"})}},q:function(e,t,r){const s=Math.ceil((e.getMonth()+1)/3);switch(t){case"q":return String(s);case"qq":return gi(s,2);case"qo":return r.ordinalNumber(s,{unit:"quarter"});case"qqq":return r.quarter(s,{width:"abbreviated",context:"standalone"});case"qqqqq":return r.quarter(s,{width:"narrow",context:"standalone"});default:return r.quarter(s,{width:"wide",context:"standalone"})}},M:function(e,t,r){const s=e.getMonth();switch(t){case"M":case"MM":return xi.M(e,t);case"Mo":return r.ordinalNumber(s+1,{unit:"month"});case"MMM":return r.month(s,{width:"abbreviated",context:"formatting"});case"MMMMM":return r.month(s,{width:"narrow",context:"formatting"});default:return r.month(s,{width:"wide",context:"formatting"})}},L:function(e,t,r){const s=e.getMonth();switch(t){case"L":return String(s+1);case"LL":return gi(s+1,2);case"Lo":return r.ordinalNumber(s+1,{unit:"month"});case"LLL":return r.month(s,{width:"abbreviated",context:"standalone"});case"LLLLL":return r.month(s,{width:"narrow",context:"standalone"});default:return r.month(s,{width:"wide",context:"standalone"})}},w:function(e,t,r,s){const n=vi(e,s);return"wo"===t?r.ordinalNumber(n,{unit:"week"}):gi(n,t.length)},I:function(e,t,r){const s=fi(e);return"Io"===t?r.ordinalNumber(s,{unit:"week"}):gi(s,t.length)},d:function(e,t,r){return"do"===t?r.ordinalNumber(e.getDate(),{unit:"date"}):xi.d(e,t)},D:function(e,t,r){const s=function(e){const t=$a(e);return Ya(t,si(t))+1}(e);return"Do"===t?r.ordinalNumber(s,{unit:"dayOfYear"}):gi(s,t.length)},E:function(e,t,r){const s=e.getDay();switch(t){case"E":case"EE":case"EEE":return r.day(s,{width:"abbreviated",context:"formatting"});case"EEEEE":return r.day(s,{width:"narrow",context:"formatting"});case"EEEEEE":return r.day(s,{width:"short",context:"formatting"});default:return r.day(s,{width:"wide",context:"formatting"})}},e:function(e,t,r,s){const n=e.getDay(),a=(n-s.weekStartsOn+8)%7||7;switch(t){case"e":return String(a);case"ee":return gi(a,2);case"eo":return r.ordinalNumber(a,{unit:"day"});case"eee":return r.day(n,{width:"abbreviated",context:"formatting"});case"eeeee":return r.day(n,{width:"narrow",context:"formatting"});case"eeeeee":return r.day(n,{width:"short",context:"formatting"});default:return r.day(n,{width:"wide",context:"formatting"})}},c:function(e,t,r,s){const n=e.getDay(),a=(n-s.weekStartsOn+8)%7||7;switch(t){case"c":return String(a);case"cc":return gi(a,t.length);case"co":return r.ordinalNumber(a,{unit:"day"});case"ccc":return r.day(n,{width:"abbreviated",context:"standalone"});case"ccccc":return r.day(n,{width:"narrow",context:"standalone"});case"cccccc":return r.day(n,{width:"short",context:"standalone"});default:return r.day(n,{width:"wide",context:"standalone"})}},i:function(e,t,r){const s=e.getDay(),n=0===s?7:s;switch(t){case"i":return String(n);case"ii":return gi(n,t.length);case"io":return r.ordinalNumber(n,{unit:"day"});case"iii":return r.day(s,{width:"abbreviated",context:"formatting"});case"iiiii":return r.day(s,{width:"narrow",context:"formatting"});case"iiiiii":return r.day(s,{width:"short",context:"formatting"});default:return r.day(s,{width:"wide",context:"formatting"})}},a:function(e,t,r){const s=e.getHours()/12>=1?"pm":"am";switch(t){case"a":case"aa":return r.dayPeriod(s,{width:"abbreviated",context:"formatting"});case"aaa":return r.dayPeriod(s,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return r.dayPeriod(s,{width:"narrow",context:"formatting"});default:return r.dayPeriod(s,{width:"wide",context:"formatting"})}},b:function(e,t,r){const s=e.getHours();let n;switch(n=12===s?bi:0===s?yi:s/12>=1?"pm":"am",t){case"b":case"bb":return r.dayPeriod(n,{width:"abbreviated",context:"formatting"});case"bbb":return r.dayPeriod(n,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return r.dayPeriod(n,{width:"narrow",context:"formatting"});default:return r.dayPeriod(n,{width:"wide",context:"formatting"})}},B:function(e,t,r){const s=e.getHours();let n;switch(n=s>=17?_i:s>=12?ji:s>=4?wi:Ni,t){case"B":case"BB":case"BBB":return r.dayPeriod(n,{width:"abbreviated",context:"formatting"});case"BBBBB":return r.dayPeriod(n,{width:"narrow",context:"formatting"});default:return r.dayPeriod(n,{width:"wide",context:"formatting"})}},h:function(e,t,r){if("ho"===t){let t=e.getHours()%12;return 0===t&&(t=12),r.ordinalNumber(t,{unit:"hour"})}return xi.h(e,t)},H:function(e,t,r){return"Ho"===t?r.ordinalNumber(e.getHours(),{unit:"hour"}):xi.H(e,t)},K:function(e,t,r){const s=e.getHours()%12;return"Ko"===t?r.ordinalNumber(s,{unit:"hour"}):gi(s,t.length)},k:function(e,t,r){let s=e.getHours();return 0===s&&(s=24),"ko"===t?r.ordinalNumber(s,{unit:"hour"}):gi(s,t.length)},m:function(e,t,r){return"mo"===t?r.ordinalNumber(e.getMinutes(),{unit:"minute"}):xi.m(e,t)},s:function(e,t,r){return"so"===t?r.ordinalNumber(e.getSeconds(),{unit:"second"}):xi.s(e,t)},S:function(e,t){return xi.S(e,t)},X:function(e,t,r){const s=e.getTimezoneOffset();if(0===s)return"Z";switch(t){case"X":return Ci(s);case"XXXX":case"XX":return Ei(s);default:return Ei(s,":")}},x:function(e,t,r){const s=e.getTimezoneOffset();switch(t){case"x":return Ci(s);case"xxxx":case"xx":return Ei(s);default:return Ei(s,":")}},O:function(e,t,r){const s=e.getTimezoneOffset();switch(t){case"O":case"OO":case"OOO":return"GMT"+Si(s,":");default:return"GMT"+Ei(s,":")}},z:function(e,t,r){const s=e.getTimezoneOffset();switch(t){case"z":case"zz":case"zzz":return"GMT"+Si(s,":");default:return"GMT"+Ei(s,":")}},t:function(e,t,r){return gi(Math.trunc(e.getTime()/1e3),t.length)},T:function(e,t,r){return gi(e.getTime(),t.length)}};function Si(e,t=""){const r=e>0?"-":"+",s=Math.abs(e),n=Math.trunc(s/60),a=s%60;return 0===a?r+String(n):r+String(n)+t+gi(a,2)}function Ci(e,t){if(e%60==0){return(e>0?"-":"+")+gi(Math.abs(e)/60,2)}return Ei(e,t)}function Ei(e,t=""){const r=e>0?"-":"+",s=Math.abs(e);return r+gi(Math.trunc(s/60),2)+t+gi(s%60,2)}const Ti=(e,t)=>{switch(e){case"P":return t.date({width:"short"});case"PP":return t.date({width:"medium"});case"PPP":return t.date({width:"long"});default:return t.date({width:"full"})}},Pi=(e,t)=>{switch(e){case"p":return t.time({width:"short"});case"pp":return t.time({width:"medium"});case"ppp":return t.time({width:"long"});default:return t.time({width:"full"})}},Oi={p:Pi,P:(e,t)=>{const r=e.match(/(P+)(p+)?/)||[],s=r[1],n=r[2];if(!n)return Ti(e,t);let a;switch(s){case"P":a=t.dateTime({width:"short"});break;case"PP":a=t.dateTime({width:"medium"});break;case"PPP":a=t.dateTime({width:"long"});break;default:a=t.dateTime({width:"full"})}return a.replace("{{date}}",Ti(s,t)).replace("{{time}}",Pi(n,t))}},Di=/^D+$/,Ri=/^Y+$/,Mi=["D","DD","YY","YYYY"];const Ai=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,Ii=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,$i=/^'([^]*?)'?$/,Li=/''/g,Fi=/[a-zA-Z]/;function Bi(e,t,r){var s,n,a,i,o,l,c,d;const u=Wa(),h=(null==r?void 0:r.locale)??u.locale??mi,m=(null==r?void 0:r.firstWeekContainsDate)??(null==(n=null==(s=null==r?void 0:r.locale)?void 0:s.options)?void 0:n.firstWeekContainsDate)??u.firstWeekContainsDate??(null==(i=null==(a=u.locale)?void 0:a.options)?void 0:i.firstWeekContainsDate)??1,f=(null==r?void 0:r.weekStartsOn)??(null==(l=null==(o=null==r?void 0:r.locale)?void 0:o.options)?void 0:l.weekStartsOn)??u.weekStartsOn??(null==(d=null==(c=u.locale)?void 0:c.options)?void 0:d.weekStartsOn)??0,p=$a(e);if(!function(e){if(!Za(e)&&"number"!=typeof e)return!1;const t=$a(e);return!isNaN(Number(t))}(p))throw new RangeError("Invalid time value");let v=t.match(Ii).map(e=>{const t=e[0];if("p"===t||"P"===t){return(0,Oi[t])(e,h.formatLong)}return e}).join("").match(Ai).map(e=>{if("''"===e)return{isToken:!1,value:"'"};const t=e[0];if("'"===t)return{isToken:!1,value:qi(e)};if(ki[t])return{isToken:!0,value:e};if(t.match(Fi))throw new RangeError("Format string contains an unescaped latin alphabet character `"+t+"`");return{isToken:!1,value:e}});h.localize.preprocessor&&(v=h.localize.preprocessor(p,v));const g={firstWeekContainsDate:m,weekStartsOn:f,locale:h};return v.map(s=>{if(!s.isToken)return s.value;const n=s.value;(!(null==r?void 0:r.useAdditionalWeekYearTokens)&&function(e){return Ri.test(e)}(n)||!(null==r?void 0:r.useAdditionalDayOfYearTokens)&&function(e){return Di.test(e)}(n))&&function(e,t,r){const s=function(e,t,r){const s="Y"===e[0]?"years":"days of the month";return`Use \`${e.toLowerCase()}\` instead of \`${e}\` (in \`${t}\`) for formatting ${s} to the input \`${r}\`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md`}(e,t,r);if(Mi.includes(e))throw new RangeError(s)}(n,t,String(e));return(0,ki[n[0]])(p,n,h.localize,g)}).join("")}function qi(e){const t=e.match($i);return t?t[1].replace(Li,"'"):e}function Ui(e,t){return function(e,t,r){const s=za(e,r),n=za(t,r),a=+s-Ja(s),i=+n-Ja(n);return Math.round((a-i)/qa)}(function(e){const t=$a(e),r=t.getMonth();return t.setFullYear(t.getFullYear(),r+1,0),t.setHours(0,0,0,0),t}(e),ri(e),t)+1}function Wi(e,t){const r=$a(e),s=$a(t);return r.getTime()>s.getTime()}function zi(e,t){return+$a(e)<+$a(t)}function Hi(e,t){const r=$a(e),s=$a(t);return r.getFullYear()===s.getFullYear()&&r.getMonth()===s.getMonth()}function Ki(e,t){return Fa(e,-t)}function Vi(e,t){const r=$a(e),s=r.getFullYear(),n=r.getDate(),a=La(e,0);a.setFullYear(s,t,15),a.setHours(0,0,0,0);const i=function(e){const t=$a(e),r=t.getFullYear(),s=t.getMonth(),n=La(e,0);return n.setFullYear(r,s+1,0),n.setHours(0,0,0,0),n.getDate()}(a);return r.setMonth(t,Math.min(n,i)),r}function Ji(e,t){const r=$a(e);return isNaN(+r)?La(e,NaN):(r.setFullYear(t),r)}const Yi={lessThanXSeconds:{one:"moins d’une seconde",other:"moins de {{count}} secondes"},xSeconds:{one:"1 seconde",other:"{{count}} secondes"},halfAMinute:"30 secondes",lessThanXMinutes:{one:"moins d’une minute",other:"moins de {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"environ 1 heure",other:"environ {{count}} heures"},xHours:{one:"1 heure",other:"{{count}} heures"},xDays:{one:"1 jour",other:"{{count}} jours"},aboutXWeeks:{one:"environ 1 semaine",other:"environ {{count}} semaines"},xWeeks:{one:"1 semaine",other:"{{count}} semaines"},aboutXMonths:{one:"environ 1 mois",other:"environ {{count}} mois"},xMonths:{one:"1 mois",other:"{{count}} mois"},aboutXYears:{one:"environ 1 an",other:"environ {{count}} ans"},xYears:{one:"1 an",other:"{{count}} ans"},overXYears:{one:"plus d’un an",other:"plus de {{count}} ans"},almostXYears:{one:"presqu’un an",other:"presque {{count}} ans"}},Gi={date:oi({formats:{full:"EEEE d MMMM y",long:"d MMMM y",medium:"d MMM y",short:"dd/MM/y"},defaultWidth:"full"}),time:oi({formats:{full:"HH:mm:ss zzzz",long:"HH:mm:ss z",medium:"HH:mm:ss",short:"HH:mm"},defaultWidth:"full"}),dateTime:oi({formats:{full:"{{date}} 'à' {{time}}",long:"{{date}} 'à' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},defaultWidth:"full"})},Xi={lastWeek:"eeee 'dernier à' p",yesterday:"'hier à' p",today:"'aujourd’hui à' p",tomorrow:"'demain à' p'",nextWeek:"eeee 'prochain à' p",other:"P"},Qi=["MMM","MMMM"],Zi={preprocessor:(e,t)=>{if(1===e.getDate())return t;return t.some(e=>e.isToken&&Qi.includes(e.value))?t.map(e=>e.isToken&&"do"===e.value?{isToken:!0,value:"d"}:e):t},ordinalNumber:(e,t)=>{const r=Number(e),s=null==t?void 0:t.unit;if(0===r)return"0";let n;return n=1===r?s&&["year","week","hour","minute","second"].includes(s)?"ère":"er":"ème",r+n},era:di({values:{narrow:["av. J.-C","ap. J.-C"],abbreviated:["av. J.-C","ap. J.-C"],wide:["avant Jésus-Christ","après Jésus-Christ"]},defaultWidth:"wide"}),quarter:di({values:{narrow:["T1","T2","T3","T4"],abbreviated:["1er trim.","2ème trim.","3ème trim.","4ème trim."],wide:["1er trimestre","2ème trimestre","3ème trimestre","4ème trimestre"]},defaultWidth:"wide",argumentCallback:e=>e-1}),month:di({values:{narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["janv.","févr.","mars","avr.","mai","juin","juil.","août","sept.","oct.","nov.","déc."],wide:["janvier","février","mars","avril","mai","juin","juillet","août","septembre","octobre","novembre","décembre"]},defaultWidth:"wide"}),day:di({values:{narrow:["D","L","M","M","J","V","S"],short:["di","lu","ma","me","je","ve","sa"],abbreviated:["dim.","lun.","mar.","mer.","jeu.","ven.","sam."],wide:["dimanche","lundi","mardi","mercredi","jeudi","vendredi","samedi"]},defaultWidth:"wide"}),dayPeriod:di({values:{narrow:{am:"AM",pm:"PM",midnight:"minuit",noon:"midi",morning:"mat.",afternoon:"ap.m.",evening:"soir",night:"mat."},abbreviated:{am:"AM",pm:"PM",midnight:"minuit",noon:"midi",morning:"matin",afternoon:"après-midi",evening:"soir",night:"matin"},wide:{am:"AM",pm:"PM",midnight:"minuit",noon:"midi",morning:"du matin",afternoon:"de l’après-midi",evening:"du soir",night:"du matin"}},defaultWidth:"wide"})},eo={code:"fr",formatDistance:(e,t,r)=>{let s;const n=Yi[e];return s="string"==typeof n?n:1===t?n.one:n.other.replace("{{count}}",String(t)),(null==r?void 0:r.addSuffix)?r.comparison&&r.comparison>0?"dans "+s:"il y a "+s:s},formatLong:Gi,formatRelative:(e,t,r,s)=>Xi[e],localize:Zi,match:{ordinalNumber:hi({matchPattern:/^(\d+)(ième|ère|ème|er|e)?/i,parsePattern:/\d+/i,valueCallback:e=>parseInt(e)}),era:ui({matchPatterns:{narrow:/^(av\.J\.C|ap\.J\.C|ap\.J\.-C)/i,abbreviated:/^(av\.J\.-C|av\.J-C|apr\.J\.-C|apr\.J-C|ap\.J-C)/i,wide:/^(avant Jésus-Christ|après Jésus-Christ)/i},defaultMatchWidth:"wide",parsePatterns:{any:[/^av/i,/^ap/i]},defaultParseWidth:"any"}),quarter:ui({matchPatterns:{narrow:/^T?[1234]/i,abbreviated:/^[1234](er|ème|e)? trim\.?/i,wide:/^[1234](er|ème|e)? trimestre/i},defaultMatchWidth:"wide",parsePatterns:{any:[/1/i,/2/i,/3/i,/4/i]},defaultParseWidth:"any",valueCallback:e=>e+1}),month:ui({matchPatterns:{narrow:/^[jfmasond]/i,abbreviated:/^(janv|févr|mars|avr|mai|juin|juill|juil|août|sept|oct|nov|déc)\.?/i,wide:/^(janvier|février|mars|avril|mai|juin|juillet|août|septembre|octobre|novembre|décembre)/i},defaultMatchWidth:"wide",parsePatterns:{narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^av/i,/^ma/i,/^juin/i,/^juil/i,/^ao/i,/^s/i,/^o/i,/^n/i,/^d/i]},defaultParseWidth:"any"}),day:ui({matchPatterns:{narrow:/^[lmjvsd]/i,short:/^(di|lu|ma|me|je|ve|sa)/i,abbreviated:/^(dim|lun|mar|mer|jeu|ven|sam)\.?/i,wide:/^(dimanche|lundi|mardi|mercredi|jeudi|vendredi|samedi)/i},defaultMatchWidth:"wide",parsePatterns:{narrow:[/^d/i,/^l/i,/^m/i,/^m/i,/^j/i,/^v/i,/^s/i],any:[/^di/i,/^lu/i,/^ma/i,/^me/i,/^je/i,/^ve/i,/^sa/i]},defaultParseWidth:"any"}),dayPeriod:ui({matchPatterns:{narrow:/^(a|p|minuit|midi|mat\.?|ap\.?m\.?|soir|nuit)/i,any:/^([ap]\.?\s?m\.?|du matin|de l'après[-\s]midi|du soir|de la nuit)/i},defaultMatchWidth:"any",parsePatterns:{any:{am:/^a/i,pm:/^p/i,midnight:/^min/i,noon:/^mid/i,morning:/mat/i,afternoon:/ap/i,evening:/soir/i,night:/nuit/i}},defaultParseWidth:"any"})},options:{weekStartsOn:1,firstWeekContainsDate:4}};var to=function(){return to=Object.assign||function(e){for(var t,r=1,s=arguments.length;r<s;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e},to.apply(this,arguments)};function ro(e,t,r){for(var s,n=0,a=t.length;n<a;n++)!s&&n in t||(s||(s=Array.prototype.slice.call(t,0,n)),s[n]=t[n]);return e.concat(s||Array.prototype.slice.call(t))}function so(e){return"multiple"===e.mode}function no(e){return"range"===e.mode}function ao(e){return"single"===e.mode}"function"==typeof SuppressedError&&SuppressedError;var io={root:"rdp",multiple_months:"rdp-multiple_months",with_weeknumber:"rdp-with_weeknumber",vhidden:"rdp-vhidden",button_reset:"rdp-button_reset",button:"rdp-button",caption:"rdp-caption",caption_start:"rdp-caption_start",caption_end:"rdp-caption_end",caption_between:"rdp-caption_between",caption_label:"rdp-caption_label",caption_dropdowns:"rdp-caption_dropdowns",dropdown:"rdp-dropdown",dropdown_month:"rdp-dropdown_month",dropdown_year:"rdp-dropdown_year",dropdown_icon:"rdp-dropdown_icon",months:"rdp-months",month:"rdp-month",table:"rdp-table",tbody:"rdp-tbody",tfoot:"rdp-tfoot",head:"rdp-head",head_row:"rdp-head_row",head_cell:"rdp-head_cell",nav:"rdp-nav",nav_button:"rdp-nav_button",nav_button_previous:"rdp-nav_button_previous",nav_button_next:"rdp-nav_button_next",nav_icon:"rdp-nav_icon",row:"rdp-row",weeknumber:"rdp-weeknumber",cell:"rdp-cell",day:"rdp-day",day_today:"rdp-day_today",day_outside:"rdp-day_outside",day_selected:"rdp-day_selected",day_disabled:"rdp-day_disabled",day_hidden:"rdp-day_hidden",day_range_start:"rdp-day_range_start",day_range_end:"rdp-day_range_end",day_range_middle:"rdp-day_range_middle"};var oo=Object.freeze({__proto__:null,formatCaption:function(e,t){return Bi(e,"LLLL y",t)},formatDay:function(e,t){return Bi(e,"d",t)},formatMonthCaption:function(e,t){return Bi(e,"LLLL",t)},formatWeekNumber:function(e){return"".concat(e)},formatWeekdayName:function(e,t){return Bi(e,"cccccc",t)},formatYearCaption:function(e,t){return Bi(e,"yyyy",t)}}),lo=Object.freeze({__proto__:null,labelDay:function(e,t,r){return Bi(e,"do MMMM (EEEE)",r)},labelMonthDropdown:function(){return"Month: "},labelNext:function(){return"Go to next month"},labelPrevious:function(){return"Go to previous month"},labelWeekNumber:function(e){return"Week n. ".concat(e)},labelWeekday:function(e,t){return Bi(e,"cccc",t)},labelYearDropdown:function(){return"Year: "}});var co=W.createContext(void 0);function uo(t){var r,s,n=t.initialProps,a={captionLayout:"buttons",classNames:io,formatters:oo,labels:lo,locale:mi,modifiersClassNames:{},modifiers:{},numberOfMonths:1,styles:{},today:new Date,mode:"default"},i=function(e){var t=e.fromYear,r=e.toYear,s=e.fromMonth,n=e.toMonth,a=e.fromDate,i=e.toDate;return s?a=ri(s):t&&(a=new Date(t,0,1)),n?i=ti(n):r&&(i=new Date(r,11,31)),{fromDate:a?Va(a):void 0,toDate:i?Va(i):void 0}}(n),o=i.fromDate,l=i.toDate,c=null!==(r=n.captionLayout)&&void 0!==r?r:a.captionLayout;"buttons"===c||o&&l||(c="buttons"),(ao(n)||so(n)||no(n))&&(s=n.onSelect);var d=to(to(to({},a),n),{captionLayout:c,classNames:to(to({},a.classNames),n.classNames),components:to({},n.components),formatters:to(to({},a.formatters),n.formatters),fromDate:o,labels:to(to({},a.labels),n.labels),mode:n.mode||a.mode,modifiers:to(to({},a.modifiers),n.modifiers),modifiersClassNames:to(to({},a.modifiersClassNames),n.modifiersClassNames),onSelect:s,styles:to(to({},a.styles),n.styles),toDate:l});return e.jsx(co.Provider,{value:d,children:t.children})}function ho(){var e=W.useContext(co);if(!e)throw new Error("useDayPicker must be used within a DayPickerProvider.");return e}function mo(t){var r=ho(),s=r.locale,n=r.classNames,a=r.styles,i=r.formatters.formatCaption;return e.jsx("div",{className:n.caption_label,style:a.caption_label,"aria-live":"polite",role:"presentation",id:t.id,children:i(t.displayMonth,{locale:s})})}function fo(t){return e.jsx("svg",to({width:"8px",height:"8px",viewBox:"0 0 120 120","data-testid":"iconDropdown"},t,{children:e.jsx("path",{d:"M4.22182541,48.2218254 C8.44222828,44.0014225 15.2388494,43.9273804 19.5496459,47.9996989 L19.7781746,48.2218254 L60,88.443 L100.221825,48.2218254 C104.442228,44.0014225 111.238849,43.9273804 115.549646,47.9996989 L115.778175,48.2218254 C119.998577,52.4422283 120.07262,59.2388494 116.000301,63.5496459 L115.778175,63.7781746 L67.7781746,111.778175 C63.5577717,115.998577 56.7611506,116.07262 52.4503541,112.000301 L52.2218254,111.778175 L4.22182541,63.7781746 C-0.0739418023,59.4824074 -0.0739418023,52.5175926 4.22182541,48.2218254 Z",fill:"currentColor",fillRule:"nonzero"})}))}function po(t){var r,s,n=t.onChange,a=t.value,i=t.children,o=t.caption,l=t.className,c=t.style,d=ho(),u=null!==(s=null===(r=d.components)||void 0===r?void 0:r.IconDropdown)&&void 0!==s?s:fo;return e.jsxs("div",{className:l,style:c,children:[e.jsx("span",{className:d.classNames.vhidden,children:t["aria-label"]}),e.jsx("select",{name:t.name,"aria-label":t["aria-label"],className:d.classNames.dropdown,style:d.styles.dropdown,value:a,onChange:n,children:i}),e.jsxs("div",{className:d.classNames.caption_label,style:d.styles.caption_label,"aria-hidden":"true",children:[o,e.jsx(u,{className:d.classNames.dropdown_icon,style:d.styles.dropdown_icon})]})]})}function vo(t){var r,s=ho(),n=s.fromDate,a=s.toDate,i=s.styles,o=s.locale,l=s.formatters.formatMonthCaption,c=s.classNames,d=s.components,u=s.labels.labelMonthDropdown;if(!n)return e.jsx(e.Fragment,{});if(!a)return e.jsx(e.Fragment,{});var h=[];if(function(e,t){const r=$a(e),s=$a(t);return r.getFullYear()===s.getFullYear()}(n,a))for(var m=ri(n),f=n.getMonth();f<=a.getMonth();f++)h.push(Vi(m,f));else for(m=ri(new Date),f=0;f<=11;f++)h.push(Vi(m,f));var p=null!==(r=null==d?void 0:d.Dropdown)&&void 0!==r?r:po;return e.jsx(p,{name:"months","aria-label":u(),className:c.dropdown_month,style:i.dropdown_month,onChange:function(e){var r=Number(e.target.value),s=Vi(ri(t.displayMonth),r);t.onChange(s)},value:t.displayMonth.getMonth(),caption:l(t.displayMonth,{locale:o}),children:h.map(function(t){return e.jsx("option",{value:t.getMonth(),children:l(t,{locale:o})},t.getMonth())})})}function go(t){var r,s=t.displayMonth,n=ho(),a=n.fromDate,i=n.toDate,o=n.locale,l=n.styles,c=n.classNames,d=n.components,u=n.formatters.formatYearCaption,h=n.labels.labelYearDropdown,m=[];if(!a)return e.jsx(e.Fragment,{});if(!i)return e.jsx(e.Fragment,{});for(var f=a.getFullYear(),p=i.getFullYear(),v=f;v<=p;v++)m.push(Ji(si(new Date),v));var g=null!==(r=null==d?void 0:d.Dropdown)&&void 0!==r?r:po;return e.jsx(g,{name:"years","aria-label":h(),className:c.dropdown_year,style:l.dropdown_year,onChange:function(e){var r=Ji(ri(s),Number(e.target.value));t.onChange(r)},value:s.getFullYear(),caption:u(s,{locale:o}),children:m.map(function(t){return e.jsx("option",{value:t.getFullYear(),children:u(t,{locale:o})},t.getFullYear())})})}function xo(){var e=ho(),t=function(e){var t=e.month,r=e.defaultMonth,s=e.today,n=t||r||s||new Date,a=e.toDate,i=e.fromDate,o=e.numberOfMonths,l=void 0===o?1:o;return a&&ei(a,n)<0&&(n=Ba(a,-1*(l-1))),i&&ei(n,i)<0&&(n=i),ri(n)}(e),r=function(e,t){var r=W.useState(e),s=r[0];return[void 0===t?s:t,r[1]]}(t,e.month),s=r[0],n=r[1];return[s,function(t){var r;if(!e.disableNavigation){var s=ri(t);n(s),null===(r=e.onMonthChange)||void 0===r||r.call(e,s)}}]}var yo=W.createContext(void 0);function bo(t){var r=ho(),s=xo(),n=s[0],a=s[1],i=function(e,t){for(var r=t.reverseMonths,s=t.numberOfMonths,n=ri(e),a=ei(ri(Ba(n,s)),n),i=[],o=0;o<a;o++){var l=Ba(n,o);i.push(l)}return r&&(i=i.reverse()),i}(n,r),o=function(e,t){if(!t.disableNavigation){var r=t.toDate,s=t.pagedNavigation,n=t.numberOfMonths,a=void 0===n?1:n,i=s?a:1,o=ri(e);if(!r)return Ba(o,i);if(!(ei(r,e)<a))return Ba(o,i)}}(n,r),l=function(e,t){if(!t.disableNavigation){var r=t.fromDate,s=t.pagedNavigation,n=t.numberOfMonths,a=s?void 0===n?1:n:1,i=ri(e);if(!r)return Ba(i,-a);if(!(ei(i,r)<=0))return Ba(i,-a)}}(n,r),c=function(e){return i.some(function(t){return Hi(e,t)})},d={currentMonth:n,displayMonths:i,goToMonth:a,goToDate:function(e,t){c(e)||(t&&zi(e,t)?a(Ba(e,1+-1*r.numberOfMonths)):a(e))},previousMonth:l,nextMonth:o,isDateDisplayed:c};return e.jsx(yo.Provider,{value:d,children:t.children})}function wo(){var e=W.useContext(yo);if(!e)throw new Error("useNavigation must be used within a NavigationProvider");return e}function jo(t){var r,s=ho(),n=s.classNames,a=s.styles,i=s.components,o=wo().goToMonth,l=function(e){o(Ba(e,t.displayIndex?-t.displayIndex:0))},c=null!==(r=null==i?void 0:i.CaptionLabel)&&void 0!==r?r:mo,d=e.jsx(c,{id:t.id,displayMonth:t.displayMonth});return e.jsxs("div",{className:n.caption_dropdowns,style:a.caption_dropdowns,children:[e.jsx("div",{className:n.vhidden,children:d}),e.jsx(vo,{onChange:l,displayMonth:t.displayMonth}),e.jsx(go,{onChange:l,displayMonth:t.displayMonth})]})}function _o(t){return e.jsx("svg",to({width:"16px",height:"16px",viewBox:"0 0 120 120"},t,{children:e.jsx("path",{d:"M69.490332,3.34314575 C72.6145263,0.218951416 77.6798462,0.218951416 80.8040405,3.34314575 C83.8617626,6.40086786 83.9268205,11.3179931 80.9992143,14.4548388 L80.8040405,14.6568542 L35.461,60 L80.8040405,105.343146 C83.8617626,108.400868 83.9268205,113.317993 80.9992143,116.454839 L80.8040405,116.656854 C77.7463184,119.714576 72.8291931,119.779634 69.6923475,116.852028 L69.490332,116.656854 L18.490332,65.6568542 C15.4326099,62.5991321 15.367552,57.6820069 18.2951583,54.5451612 L18.490332,54.3431458 L69.490332,3.34314575 Z",fill:"currentColor",fillRule:"nonzero"})}))}function No(t){return e.jsx("svg",to({width:"16px",height:"16px",viewBox:"0 0 120 120"},t,{children:e.jsx("path",{d:"M49.8040405,3.34314575 C46.6798462,0.218951416 41.6145263,0.218951416 38.490332,3.34314575 C35.4326099,6.40086786 35.367552,11.3179931 38.2951583,14.4548388 L38.490332,14.6568542 L83.8333725,60 L38.490332,105.343146 C35.4326099,108.400868 35.367552,113.317993 38.2951583,116.454839 L38.490332,116.656854 C41.5480541,119.714576 46.4651794,119.779634 49.602025,116.852028 L49.8040405,116.656854 L100.804041,65.6568542 C103.861763,62.5991321 103.926821,57.6820069 100.999214,54.5451612 L100.804041,54.3431458 L49.8040405,3.34314575 Z",fill:"currentColor"})}))}var ko=W.forwardRef(function(t,r){var s=ho(),n=s.classNames,a=s.styles,i=[n.button_reset,n.button];t.className&&i.push(t.className);var o=i.join(" "),l=to(to({},a.button_reset),a.button);return t.style&&Object.assign(l,t.style),e.jsx("button",to({},t,{ref:r,type:"button",className:o,style:l}))});function So(t){var r,s,n=ho(),a=n.dir,i=n.locale,o=n.classNames,l=n.styles,c=n.labels,d=c.labelPrevious,u=c.labelNext,h=n.components;if(!t.nextMonth&&!t.previousMonth)return e.jsx(e.Fragment,{});var m=d(t.previousMonth,{locale:i}),f=[o.nav_button,o.nav_button_previous].join(" "),p=u(t.nextMonth,{locale:i}),v=[o.nav_button,o.nav_button_next].join(" "),g=null!==(r=null==h?void 0:h.IconRight)&&void 0!==r?r:No,x=null!==(s=null==h?void 0:h.IconLeft)&&void 0!==s?s:_o;return e.jsxs("div",{className:o.nav,style:l.nav,children:[!t.hidePrevious&&e.jsx(ko,{name:"previous-month","aria-label":m,className:f,style:l.nav_button_previous,disabled:!t.previousMonth,onClick:t.onPreviousClick,children:"rtl"===a?e.jsx(g,{className:o.nav_icon,style:l.nav_icon}):e.jsx(x,{className:o.nav_icon,style:l.nav_icon})}),!t.hideNext&&e.jsx(ko,{name:"next-month","aria-label":p,className:v,style:l.nav_button_next,disabled:!t.nextMonth,onClick:t.onNextClick,children:"rtl"===a?e.jsx(x,{className:o.nav_icon,style:l.nav_icon}):e.jsx(g,{className:o.nav_icon,style:l.nav_icon})})]})}function Co(t){var r=ho().numberOfMonths,s=wo(),n=s.previousMonth,a=s.nextMonth,i=s.goToMonth,o=s.displayMonths,l=o.findIndex(function(e){return Hi(t.displayMonth,e)}),c=0===l,d=l===o.length-1,u=r>1&&(c||!d),h=r>1&&(d||!c);return e.jsx(So,{displayMonth:t.displayMonth,hideNext:u,hidePrevious:h,nextMonth:a,previousMonth:n,onPreviousClick:function(){n&&i(n)},onNextClick:function(){a&&i(a)}})}function Eo(t){var r,s,n=ho(),a=n.classNames,i=n.disableNavigation,o=n.styles,l=n.captionLayout,c=n.components,d=null!==(r=null==c?void 0:c.CaptionLabel)&&void 0!==r?r:mo;return s=i?e.jsx(d,{id:t.id,displayMonth:t.displayMonth}):"dropdown"===l?e.jsx(jo,{displayMonth:t.displayMonth,id:t.id}):"dropdown-buttons"===l?e.jsxs(e.Fragment,{children:[e.jsx(jo,{displayMonth:t.displayMonth,displayIndex:t.displayIndex,id:t.id}),e.jsx(Co,{displayMonth:t.displayMonth,displayIndex:t.displayIndex,id:t.id})]}):e.jsxs(e.Fragment,{children:[e.jsx(d,{id:t.id,displayMonth:t.displayMonth,displayIndex:t.displayIndex}),e.jsx(Co,{displayMonth:t.displayMonth,id:t.id})]}),e.jsx("div",{className:a.caption,style:o.caption,children:s})}function To(t){var r=ho(),s=r.footer,n=r.styles,a=r.classNames.tfoot;return s?e.jsx("tfoot",{className:a,style:n.tfoot,children:e.jsx("tr",{children:e.jsx("td",{colSpan:8,children:s})})}):e.jsx(e.Fragment,{})}function Po(){var t=ho(),r=t.classNames,s=t.styles,n=t.showWeekNumber,a=t.locale,i=t.weekStartsOn,o=t.ISOWeek,l=t.formatters.formatWeekdayName,c=t.labels.labelWeekday,d=function(e,t,r){for(var s=r?Ha(new Date):za(new Date,{locale:e,weekStartsOn:t}),n=[],a=0;a<7;a++){var i=Fa(s,a);n.push(i)}return n}(a,i,o);return e.jsxs("tr",{style:s.head_row,className:r.head_row,children:[n&&e.jsx("td",{style:s.head_cell,className:r.head_cell}),d.map(function(t,n){return e.jsx("th",{scope:"col",className:r.head_cell,style:s.head_cell,"aria-label":c(t,{locale:a}),children:l(t,{locale:a})},n)})]})}function Oo(){var t,r=ho(),s=r.classNames,n=r.styles,a=r.components,i=null!==(t=null==a?void 0:a.HeadRow)&&void 0!==t?t:Po;return e.jsx("thead",{style:n.head,className:s.head,children:e.jsx(i,{})})}function Do(t){var r=ho(),s=r.locale,n=r.formatters.formatDay;return e.jsx(e.Fragment,{children:n(t.date,{locale:s})})}var Ro=W.createContext(void 0);function Mo(t){if(!so(t.initialProps)){return e.jsx(Ro.Provider,{value:{selected:void 0,modifiers:{disabled:[]}},children:t.children})}return e.jsx(Ao,{initialProps:t.initialProps,children:t.children})}function Ao(t){var r=t.initialProps,s=t.children,n=r.selected,a=r.min,i=r.max,o={disabled:[]};n&&o.disabled.push(function(e){var t=i&&n.length>i-1,r=n.some(function(t){return Qa(t,e)});return Boolean(t&&!r)});var l={selected:n,onDayClick:function(e,t,s){var o,l;if((null===(o=r.onDayClick)||void 0===o||o.call(r,e,t,s),!Boolean(t.selected&&a&&(null==n?void 0:n.length)===a))&&!Boolean(!t.selected&&i&&(null==n?void 0:n.length)===i)){var c=n?ro([],n):[];if(t.selected){var d=c.findIndex(function(t){return Qa(e,t)});c.splice(d,1)}else c.push(e);null===(l=r.onSelect)||void 0===l||l.call(r,c,e,t,s)}},modifiers:o};return e.jsx(Ro.Provider,{value:l,children:s})}function Io(){var e=W.useContext(Ro);if(!e)throw new Error("useSelectMultiple must be used within a SelectMultipleProvider");return e}var $o,Lo,Fo=W.createContext(void 0);function Bo(t){if(!no(t.initialProps)){return e.jsx(Fo.Provider,{value:{selected:void 0,modifiers:{range_start:[],range_end:[],range_middle:[],disabled:[]}},children:t.children})}return e.jsx(qo,{initialProps:t.initialProps,children:t.children})}function qo(t){var r=t.initialProps,s=t.children,n=r.selected,a=n||{},i=a.from,o=a.to,l=r.min,c=r.max,d={range_start:[],range_end:[],range_middle:[],disabled:[]};if(i?(d.range_start=[i],o?(d.range_end=[o],Qa(i,o)||(d.range_middle=[{after:i,before:o}])):d.range_end=[i]):o&&(d.range_start=[o],d.range_end=[o]),l&&(i&&!o&&d.disabled.push({after:Ki(i,l-1),before:Fa(i,l-1)}),i&&o&&d.disabled.push({after:i,before:Fa(i,l-1)}),!i&&o&&d.disabled.push({after:Ki(o,l-1),before:Fa(o,l-1)})),c){if(i&&!o&&(d.disabled.push({before:Fa(i,1-c)}),d.disabled.push({after:Fa(i,c-1)})),i&&o){var u=c-(Ya(o,i)+1);d.disabled.push({before:Ki(i,u)}),d.disabled.push({after:Fa(o,u)})}!i&&o&&(d.disabled.push({before:Fa(o,1-c)}),d.disabled.push({after:Fa(o,c-1)}))}return e.jsx(Fo.Provider,{value:{selected:n,onDayClick:function(e,t,s){var a,i;null===(a=r.onDayClick)||void 0===a||a.call(r,e,t,s);var o=function(e,t){var r=t||{},s=r.from,n=r.to;if(s&&n){if(Qa(n,e)&&Qa(s,e))return;if(Qa(n,e))return{from:n,to:void 0};if(Qa(s,e))return;return Wi(s,e)?{from:e,to:n}:{from:s,to:e}}return n?Wi(e,n)?{from:n,to:e}:{from:e,to:n}:s?zi(e,s)?{from:e,to:s}:{from:s,to:e}:{from:e,to:void 0}}(e,n);null===(i=r.onSelect)||void 0===i||i.call(r,o,e,t,s)},modifiers:d},children:s})}function Uo(){var e=W.useContext(Fo);if(!e)throw new Error("useSelectRange must be used within a SelectRangeProvider");return e}function Wo(e){return Array.isArray(e)?ro([],e):void 0!==e?[e]:[]}(Lo=$o||($o={})).Outside="outside",Lo.Disabled="disabled",Lo.Selected="selected",Lo.Hidden="hidden",Lo.Today="today",Lo.RangeStart="range_start",Lo.RangeEnd="range_end",Lo.RangeMiddle="range_middle";var zo=$o.Selected,Ho=$o.Disabled,Ko=$o.Hidden,Vo=$o.Today,Jo=$o.RangeEnd,Yo=$o.RangeMiddle,Go=$o.RangeStart,Xo=$o.Outside;var Qo=W.createContext(void 0);function Zo(t){var r=ho(),s=function(e,t,r){var s,n=((s={})[zo]=Wo(e.selected),s[Ho]=Wo(e.disabled),s[Ko]=Wo(e.hidden),s[Vo]=[e.today],s[Jo]=[],s[Yo]=[],s[Go]=[],s[Xo]=[],s);return e.fromDate&&n[Ho].push({before:e.fromDate}),e.toDate&&n[Ho].push({after:e.toDate}),so(e)?n[Ho]=n[Ho].concat(t.modifiers[Ho]):no(e)&&(n[Ho]=n[Ho].concat(r.modifiers[Ho]),n[Go]=r.modifiers[Go],n[Yo]=r.modifiers[Yo],n[Jo]=r.modifiers[Jo]),n}(r,Io(),Uo()),n=function(e){var t={};return Object.entries(e).forEach(function(e){var r=e[0],s=e[1];t[r]=Wo(s)}),t}(r.modifiers),a=to(to({},s),n);return e.jsx(Qo.Provider,{value:a,children:t.children})}function el(){var e=W.useContext(Qo);if(!e)throw new Error("useModifiers must be used within a ModifiersProvider");return e}function tl(e,t){return t.some(function(t){if("boolean"==typeof t)return t;if(Za(t))return Qa(e,t);var r,s,n,a,i;if(function(e){return Array.isArray(e)&&e.every(Za)}(t))return t.includes(e);if(function(e){return Boolean(e&&"object"==typeof e&&"from"in e)}(t))return r=e,a=(s=t).from,i=s.to,a&&i?(Ya(i,a)<0&&(a=(n=[i,a])[0],i=n[1]),Ya(r,a)>=0&&Ya(i,r)>=0):i?Qa(i,r):!!a&&Qa(a,r);if(function(e){return Boolean(e&&"object"==typeof e&&"dayOfWeek"in e)}(t))return t.dayOfWeek.includes(e.getDay());if(function(e){return Boolean(e&&"object"==typeof e&&"before"in e&&"after"in e)}(t)){var o=Ya(t.before,e)>0,l=Ya(t.after,e)<0;return Wi(t.before,t.after)?l&&o:o||l}return function(e){return Boolean(e&&"object"==typeof e&&"after"in e)}(t)?Ya(e,t.after)>0:function(e){return Boolean(e&&"object"==typeof e&&"before"in e)}(t)?Ya(t.before,e)>0:"function"==typeof t&&t(e)})}function rl(e,t,r){var s=Object.keys(t).reduce(function(r,s){var n=t[s];return tl(e,n)&&r.push(s),r},[]),n={};return s.forEach(function(e){return n[e]=!0}),r&&!Hi(e,r)&&(n.outside=!0),n}function sl(e,t){var r=t.moveBy,s=t.direction,n=t.context,a=t.modifiers,i=t.retry,o=void 0===i?{count:0,lastFocused:e}:i,l=n.weekStartsOn,c=n.fromDate,d=n.toDate,u=n.locale,h={day:Fa,week:Ga,month:Ba,year:Xa,startOfWeek:function(e){return n.ISOWeek?Ha(e):za(e,{locale:u,weekStartsOn:l})},endOfWeek:function(e){return n.ISOWeek?ai(e):ni(e,{locale:u,weekStartsOn:l})}}[r](e,"after"===s?1:-1);"before"===s&&c?h=function(e){let t;return e.forEach(function(e){const r=$a(e);(void 0===t||t<r||isNaN(Number(r)))&&(t=r)}),t||new Date(NaN)}([c,h]):"after"===s&&d&&(h=function(e){let t;return e.forEach(e=>{const r=$a(e);(!t||t>r||isNaN(+r))&&(t=r)}),t||new Date(NaN)}([d,h]));var m=!0;if(a){var f=rl(h,a);m=!f.disabled&&!f.hidden}return m?h:o.count>365?o.lastFocused:sl(h,{moveBy:r,direction:s,context:n,modifiers:a,retry:to(to({},o),{count:o.count+1})})}var nl=W.createContext(void 0);function al(t){var r=wo(),s=el(),n=W.useState(),a=n[0],i=n[1],o=W.useState(),l=o[0],c=o[1],d=function(e,t){for(var r,s,n=ri(e[0]),a=ti(e[e.length-1]),i=n;i<=a;){var o=rl(i,t);if(o.disabled||o.hidden)i=Fa(i,1);else{if(o.selected)return i;o.today&&!s&&(s=i),r||(r=i),i=Fa(i,1)}}return s||r}(r.displayMonths,s),u=(null!=a?a:l&&r.isDateDisplayed(l))?l:d,h=function(e){i(e)},m=ho(),f=function(e,t){if(a){var n=sl(a,{moveBy:e,direction:t,context:m,modifiers:s});Qa(a,n)||(r.goToDate(n,a),h(n))}},p={focusedDay:a,focusTarget:u,blur:function(){c(a),i(void 0)},focus:h,focusDayAfter:function(){return f("day","after")},focusDayBefore:function(){return f("day","before")},focusWeekAfter:function(){return f("week","after")},focusWeekBefore:function(){return f("week","before")},focusMonthBefore:function(){return f("month","before")},focusMonthAfter:function(){return f("month","after")},focusYearBefore:function(){return f("year","before")},focusYearAfter:function(){return f("year","after")},focusStartOfWeek:function(){return f("startOfWeek","before")},focusEndOfWeek:function(){return f("endOfWeek","after")}};return e.jsx(nl.Provider,{value:p,children:t.children})}function il(){var e=W.useContext(nl);if(!e)throw new Error("useFocusContext must be used within a FocusProvider");return e}var ol=W.createContext(void 0);function ll(t){if(!ao(t.initialProps)){return e.jsx(ol.Provider,{value:{selected:void 0},children:t.children})}return e.jsx(cl,{initialProps:t.initialProps,children:t.children})}function cl(t){var r=t.initialProps,s=t.children,n={selected:r.selected,onDayClick:function(e,t,s){var n,a,i;null===(n=r.onDayClick)||void 0===n||n.call(r,e,t,s),!t.selected||r.required?null===(i=r.onSelect)||void 0===i||i.call(r,e,e,t,s):null===(a=r.onSelect)||void 0===a||a.call(r,void 0,e,t,s)}};return e.jsx(ol.Provider,{value:n,children:s})}function dl(){var e=W.useContext(ol);if(!e)throw new Error("useSelectSingle must be used within a SelectSingleProvider");return e}function ul(e,t){var r=[e.classNames.day];return Object.keys(t).forEach(function(t){var s=e.modifiersClassNames[t];if(s)r.push(s);else if(function(e){return Object.values($o).includes(e)}(t)){var n=e.classNames["day_".concat(t)];n&&r.push(n)}}),r}function hl(t,r,s){var n,a,i,o=ho(),l=il(),c=function(e,t){return rl(e,el(),t)}(t,r),d=function(e,t){var r=ho(),s=dl(),n=Io(),a=Uo(),i=il(),o=i.focusDayAfter,l=i.focusDayBefore,c=i.focusWeekAfter,d=i.focusWeekBefore,u=i.blur,h=i.focus,m=i.focusMonthBefore,f=i.focusMonthAfter,p=i.focusYearBefore,v=i.focusYearAfter,g=i.focusStartOfWeek,x=i.focusEndOfWeek;return{onClick:function(i){var o,l,c,d;ao(r)?null===(o=s.onDayClick)||void 0===o||o.call(s,e,t,i):so(r)?null===(l=n.onDayClick)||void 0===l||l.call(n,e,t,i):no(r)?null===(c=a.onDayClick)||void 0===c||c.call(a,e,t,i):null===(d=r.onDayClick)||void 0===d||d.call(r,e,t,i)},onFocus:function(s){var n;h(e),null===(n=r.onDayFocus)||void 0===n||n.call(r,e,t,s)},onBlur:function(s){var n;u(),null===(n=r.onDayBlur)||void 0===n||n.call(r,e,t,s)},onKeyDown:function(s){var n;switch(s.key){case"ArrowLeft":s.preventDefault(),s.stopPropagation(),"rtl"===r.dir?o():l();break;case"ArrowRight":s.preventDefault(),s.stopPropagation(),"rtl"===r.dir?l():o();break;case"ArrowDown":s.preventDefault(),s.stopPropagation(),c();break;case"ArrowUp":s.preventDefault(),s.stopPropagation(),d();break;case"PageUp":s.preventDefault(),s.stopPropagation(),s.shiftKey?p():m();break;case"PageDown":s.preventDefault(),s.stopPropagation(),s.shiftKey?v():f();break;case"Home":s.preventDefault(),s.stopPropagation(),g();break;case"End":s.preventDefault(),s.stopPropagation(),x()}null===(n=r.onDayKeyDown)||void 0===n||n.call(r,e,t,s)},onKeyUp:function(s){var n;null===(n=r.onDayKeyUp)||void 0===n||n.call(r,e,t,s)},onMouseEnter:function(s){var n;null===(n=r.onDayMouseEnter)||void 0===n||n.call(r,e,t,s)},onMouseLeave:function(s){var n;null===(n=r.onDayMouseLeave)||void 0===n||n.call(r,e,t,s)},onPointerEnter:function(s){var n;null===(n=r.onDayPointerEnter)||void 0===n||n.call(r,e,t,s)},onPointerLeave:function(s){var n;null===(n=r.onDayPointerLeave)||void 0===n||n.call(r,e,t,s)},onTouchCancel:function(s){var n;null===(n=r.onDayTouchCancel)||void 0===n||n.call(r,e,t,s)},onTouchEnd:function(s){var n;null===(n=r.onDayTouchEnd)||void 0===n||n.call(r,e,t,s)},onTouchMove:function(s){var n;null===(n=r.onDayTouchMove)||void 0===n||n.call(r,e,t,s)},onTouchStart:function(s){var n;null===(n=r.onDayTouchStart)||void 0===n||n.call(r,e,t,s)}}}(t,c),u=function(){var e=ho(),t=dl(),r=Io(),s=Uo();return ao(e)?t.selected:so(e)?r.selected:no(e)?s.selected:void 0}(),h=Boolean(o.onDayClick||"default"!==o.mode);W.useEffect(function(){var e;c.outside||l.focusedDay&&h&&Qa(l.focusedDay,t)&&(null===(e=s.current)||void 0===e||e.focus())},[l.focusedDay,t,s,h,c.outside]);var m=ul(o,c).join(" "),f=function(e,t){var r=to({},e.styles.day);return Object.keys(t).forEach(function(t){var s;r=to(to({},r),null===(s=e.modifiersStyles)||void 0===s?void 0:s[t])}),r}(o,c),p=Boolean(c.outside&&!o.showOutsideDays||c.hidden),v=null!==(i=null===(a=o.components)||void 0===a?void 0:a.DayContent)&&void 0!==i?i:Do,g={style:f,className:m,children:e.jsx(v,{date:t,displayMonth:r,activeModifiers:c}),role:"gridcell"},x=l.focusTarget&&Qa(l.focusTarget,t)&&!c.outside,y=l.focusedDay&&Qa(l.focusedDay,t),b=to(to(to({},g),((n={disabled:c.disabled,role:"gridcell"})["aria-selected"]=c.selected,n.tabIndex=y||x?0:-1,n)),d);return{isButton:h,isHidden:p,activeModifiers:c,selectedDays:u,buttonProps:b,divProps:g}}function ml(t){var r=W.useRef(null),s=hl(t.date,t.displayMonth,r);return s.isHidden?e.jsx("div",{role:"gridcell"}):s.isButton?e.jsx(ko,to({name:"day",ref:r},s.buttonProps)):e.jsx("div",to({},s.divProps))}function fl(t){var r=t.number,s=t.dates,n=ho(),a=n.onWeekNumberClick,i=n.styles,o=n.classNames,l=n.locale,c=n.labels.labelWeekNumber,d=(0,n.formatters.formatWeekNumber)(Number(r),{locale:l});if(!a)return e.jsx("span",{className:o.weeknumber,style:i.weeknumber,children:d});var u=c(Number(r),{locale:l});return e.jsx(ko,{name:"week-number","aria-label":u,className:o.weeknumber,style:i.weeknumber,onClick:function(e){a(r,s,e)},children:d})}function pl(t){var r,s,n,a=ho(),i=a.styles,o=a.classNames,l=a.showWeekNumber,c=a.components,d=null!==(r=null==c?void 0:c.Day)&&void 0!==r?r:ml,u=null!==(s=null==c?void 0:c.WeekNumber)&&void 0!==s?s:fl;return l&&(n=e.jsx("td",{className:o.cell,style:i.cell,children:e.jsx(u,{number:t.weekNumber,dates:t.dates})})),e.jsxs("tr",{className:o.row,style:i.row,children:[n,t.dates.map(function(r){return e.jsx("td",{className:o.cell,style:i.cell,role:"presentation",children:e.jsx(d,{displayMonth:t.displayMonth,date:r})},function(e){return Math.trunc(+$a(e)/1e3)}(r))})]})}function vl(e,t,r){for(var s=(null==r?void 0:r.ISOWeek)?ai(t):ni(t,r),n=(null==r?void 0:r.ISOWeek)?Ha(e):za(e,r),a=Ya(s,n),i=[],o=0;o<=a;o++)i.push(Fa(n,o));return i.reduce(function(e,t){var s=(null==r?void 0:r.ISOWeek)?fi(t):vi(t,r),n=e.find(function(e){return e.weekNumber===s});return n?(n.dates.push(t),e):(e.push({weekNumber:s,dates:[t]}),e)},[])}function gl(t){var r,s,n,a=ho(),i=a.locale,o=a.classNames,l=a.styles,c=a.hideHead,d=a.fixedWeeks,u=a.components,h=a.weekStartsOn,m=a.firstWeekContainsDate,f=a.ISOWeek,p=function(e,t){var r=vl(ri(e),ti(e),t);if(null==t?void 0:t.useFixedWeeks){var s=Ui(e,t);if(s<6){var n=r[r.length-1],a=n.dates[n.dates.length-1],i=Ga(a,6-s),o=vl(Ga(a,1),i,t);r.push.apply(r,o)}}return r}(t.displayMonth,{useFixedWeeks:Boolean(d),ISOWeek:f,locale:i,weekStartsOn:h,firstWeekContainsDate:m}),v=null!==(r=null==u?void 0:u.Head)&&void 0!==r?r:Oo,g=null!==(s=null==u?void 0:u.Row)&&void 0!==s?s:pl,x=null!==(n=null==u?void 0:u.Footer)&&void 0!==n?n:To;return e.jsxs("table",{id:t.id,className:o.table,style:l.table,role:"grid","aria-labelledby":t["aria-labelledby"],children:[!c&&e.jsx(v,{}),e.jsx("tbody",{className:o.tbody,style:l.tbody,children:p.map(function(r){return e.jsx(g,{displayMonth:t.displayMonth,dates:r.dates,weekNumber:r.weekNumber},r.weekNumber)})}),e.jsx(x,{displayMonth:t.displayMonth})]})}var xl="undefined"!=typeof window&&window.document&&window.document.createElement?W.useLayoutEffect:W.useEffect,yl=!1,bl=0;function wl(){return"react-day-picker-".concat(++bl)}function jl(t){var r,s,n=ho(),a=n.dir,i=n.classNames,o=n.styles,l=n.components,c=wo().displayMonths,d=function(e){var t,r=null!=e?e:yl?wl():null,s=W.useState(r),n=s[0],a=s[1];return xl(function(){null===n&&a(wl())},[]),W.useEffect(function(){!1===yl&&(yl=!0)},[]),null!==(t=null!=e?e:n)&&void 0!==t?t:void 0}(n.id?"".concat(n.id,"-").concat(t.displayIndex):void 0),u=n.id?"".concat(n.id,"-grid-").concat(t.displayIndex):void 0,h=[i.month],m=o.month,f=0===t.displayIndex,p=t.displayIndex===c.length-1,v=!f&&!p;"rtl"===a&&(p=(r=[f,p])[0],f=r[1]),f&&(h.push(i.caption_start),m=to(to({},m),o.caption_start)),p&&(h.push(i.caption_end),m=to(to({},m),o.caption_end)),v&&(h.push(i.caption_between),m=to(to({},m),o.caption_between));var g=null!==(s=null==l?void 0:l.Caption)&&void 0!==s?s:Eo;return e.jsxs("div",{className:h.join(" "),style:m,children:[e.jsx(g,{id:d,displayMonth:t.displayMonth,displayIndex:t.displayIndex}),e.jsx(gl,{id:u,"aria-labelledby":d,displayMonth:t.displayMonth})]},t.displayIndex)}function _l(t){var r=ho(),s=r.classNames,n=r.styles;return e.jsx("div",{className:s.months,style:n.months,children:t.children})}function Nl(t){var r,s,n=t.initialProps,a=ho(),i=il(),o=wo(),l=W.useState(!1),c=l[0],d=l[1];W.useEffect(function(){a.initialFocus&&i.focusTarget&&(c||(i.focus(i.focusTarget),d(!0)))},[a.initialFocus,c,i.focus,i.focusTarget,i]);var u=[a.classNames.root,a.className];a.numberOfMonths>1&&u.push(a.classNames.multiple_months),a.showWeekNumber&&u.push(a.classNames.with_weeknumber);var h=to(to({},a.styles.root),a.style),m=Object.keys(n).filter(function(e){return e.startsWith("data-")}).reduce(function(e,t){var r;return to(to({},e),((r={})[t]=n[t],r))},{}),f=null!==(s=null===(r=n.components)||void 0===r?void 0:r.Months)&&void 0!==s?s:_l;return e.jsx("div",to({className:u.join(" "),style:h,dir:a.dir,id:a.id,nonce:n.nonce,title:n.title,lang:n.lang},m,{children:e.jsx(f,{children:o.displayMonths.map(function(t,r){return e.jsx(jl,{displayIndex:r,displayMonth:t},r)})})}))}function kl(t){var r=t.children,s=function(e,t){var r={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(r[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(s=Object.getOwnPropertySymbols(e);n<s.length;n++)t.indexOf(s[n])<0&&Object.prototype.propertyIsEnumerable.call(e,s[n])&&(r[s[n]]=e[s[n]])}return r}(t,["children"]);return e.jsx(uo,{initialProps:s,children:e.jsx(bo,{children:e.jsx(ll,{initialProps:s,children:e.jsx(Mo,{initialProps:s,children:e.jsx(Bo,{initialProps:s,children:e.jsx(Zo,{children:e.jsx(al,{children:r})})})})})})})}function Sl(t){return e.jsx(kl,to({},t,{children:e.jsx(Nl,{initialProps:t})}))}function Cl({className:t,classNames:r,showOutsideDays:s=!0,...n}){return e.jsx(Sl,{showOutsideDays:s,className:Na("p-3",t),classNames:{months:"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0",month:"space-y-4",caption:"flex justify-center pt-1 relative items-center",caption_label:"text-sm font-medium",nav:"space-x-1 flex items-center",nav_button:Na(Ra({variant:"outline"}),"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100"),nav_button_previous:"absolute left-1",nav_button_next:"absolute right-1",table:"w-full border-collapse space-y-1",head_row:"flex",head_cell:"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]",row:"flex w-full mt-2",cell:"h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20",day:Na(Ra({variant:"ghost"}),"h-9 w-9 p-0 font-normal aria-selected:opacity-100"),day_range_end:"day-range-end",day_selected:"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground",day_today:"bg-accent text-accent-foreground",day_outside:"day-outside text-muted-foreground opacity-50 aria-selected:bg-accent/50 aria-selected:text-muted-foreground aria-selected:opacity-30",day_disabled:"text-muted-foreground opacity-50",day_range_middle:"aria-selected:bg-accent aria-selected:text-accent-foreground",day_hidden:"invisible",...r},components:{IconLeft:({...t})=>e.jsx(pe,{className:"h-4 w-4"}),IconRight:({...t})=>e.jsx(ae,{className:"h-4 w-4"})},...n})}Cl.displayName="Calendar";var El="Popover",[Tl,Pl]=s(El,[p]),Ol=p(),[Dl,Rl]=Tl(El),Ml=t=>{const{__scopePopover:r,children:s,open:n,defaultOpen:a,onOpenChange:o,modal:l=!1}=t,c=Ol(r),d=W.useRef(null),[u,h]=W.useState(!1),[m,f]=i({prop:n,defaultProp:a??!1,onChange:o,caller:El});return e.jsx(k,{...c,children:e.jsx(Dl,{scope:r,contentId:S(),triggerRef:d,open:m,onOpenChange:f,onOpenToggle:W.useCallback(()=>f(e=>!e),[f]),hasCustomAnchor:u,onCustomAnchorAdd:W.useCallback(()=>h(!0),[]),onCustomAnchorRemove:W.useCallback(()=>h(!1),[]),modal:l,children:s})})};Ml.displayName=El;var Al="PopoverAnchor";W.forwardRef((t,r)=>{const{__scopePopover:s,...n}=t,a=Rl(Al,s),i=Ol(s),{onCustomAnchorAdd:o,onCustomAnchorRemove:l}=a;return W.useEffect(()=>(o(),()=>l()),[o,l]),e.jsx(v,{...i,...n,ref:r})}).displayName=Al;var Il="PopoverTrigger",$l=W.forwardRef((r,s)=>{const{__scopePopover:a,...i}=r,o=Rl(Il,a),l=Ol(a),d=n(s,o.triggerRef),u=e.jsx(t.button,{type:"button","aria-haspopup":"dialog","aria-expanded":o.open,"aria-controls":o.contentId,"data-state":Yl(o.open),...i,ref:d,onClick:c(r.onClick,o.onOpenToggle)});return o.hasCustomAnchor?u:e.jsx(v,{asChild:!0,...l,children:u})});$l.displayName=Il;var Ll="PopoverPortal",[Fl,Bl]=Tl(Ll,{forceMount:void 0}),ql=t=>{const{__scopePopover:r,forceMount:s,children:n,container:a}=t,i=Rl(Ll,r);return e.jsx(Fl,{scope:r,forceMount:s,children:e.jsx(o,{present:s||i.open,children:e.jsx(u,{asChild:!0,container:a,children:n})})})};ql.displayName=Ll;var Ul="PopoverContent",Wl=W.forwardRef((t,r)=>{const s=Bl(Ul,t.__scopePopover),{forceMount:n=s.forceMount,...a}=t,i=Rl(Ul,t.__scopePopover);return e.jsx(o,{present:n||i.open,children:i.modal?e.jsx(Hl,{...a,ref:r}):e.jsx(Kl,{...a,ref:r})})});Wl.displayName=Ul;var zl=N("PopoverContent.RemoveScroll"),Hl=W.forwardRef((t,r)=>{const s=Rl(Ul,t.__scopePopover),a=W.useRef(null),i=n(r,a),o=W.useRef(!1);return W.useEffect(()=>{const e=a.current;if(e)return g(e)},[]),e.jsx(x,{as:zl,allowPinchZoom:!0,children:e.jsx(Vl,{...t,ref:i,trapFocus:s.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:c(t.onCloseAutoFocus,e=>{var t;e.preventDefault(),o.current||null==(t=s.triggerRef.current)||t.focus()}),onPointerDownOutside:c(t.onPointerDownOutside,e=>{const t=e.detail.originalEvent,r=0===t.button&&!0===t.ctrlKey,s=2===t.button||r;o.current=s},{checkForDefaultPrevented:!1}),onFocusOutside:c(t.onFocusOutside,e=>e.preventDefault(),{checkForDefaultPrevented:!1})})})}),Kl=W.forwardRef((t,r)=>{const s=Rl(Ul,t.__scopePopover),n=W.useRef(!1),a=W.useRef(!1);return e.jsx(Vl,{...t,ref:r,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:e=>{var r,i;null==(r=t.onCloseAutoFocus)||r.call(t,e),e.defaultPrevented||(n.current||null==(i=s.triggerRef.current)||i.focus(),e.preventDefault()),n.current=!1,a.current=!1},onInteractOutside:e=>{var r,i;null==(r=t.onInteractOutside)||r.call(t,e),e.defaultPrevented||(n.current=!0,"pointerdown"===e.detail.originalEvent.type&&(a.current=!0));const o=e.target;(null==(i=s.triggerRef.current)?void 0:i.contains(o))&&e.preventDefault(),"focusin"===e.detail.originalEvent.type&&a.current&&e.preventDefault()}})}),Vl=W.forwardRef((t,r)=>{const{__scopePopover:s,trapFocus:n,onOpenAutoFocus:a,onCloseAutoFocus:i,disableOutsidePointerEvents:o,onEscapeKeyDown:l,onPointerDownOutside:c,onFocusOutside:d,onInteractOutside:u,...h}=t,m=Rl(Ul,s),f=Ol(s);return y(),e.jsx(b,{asChild:!0,loop:!0,trapped:n,onMountAutoFocus:a,onUnmountAutoFocus:i,children:e.jsx(w,{asChild:!0,disableOutsidePointerEvents:o,onInteractOutside:u,onEscapeKeyDown:l,onPointerDownOutside:c,onFocusOutside:d,onDismiss:()=>m.onOpenChange(!1),children:e.jsx(j,{"data-state":Yl(m.open),role:"dialog",id:m.contentId,...f,...h,ref:r,style:{...h.style,"--radix-popover-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-popover-content-available-width":"var(--radix-popper-available-width)","--radix-popover-content-available-height":"var(--radix-popper-available-height)","--radix-popover-trigger-width":"var(--radix-popper-anchor-width)","--radix-popover-trigger-height":"var(--radix-popper-anchor-height)"}})})})}),Jl="PopoverClose";W.forwardRef((r,s)=>{const{__scopePopover:n,...a}=r,i=Rl(Jl,n);return e.jsx(t.button,{type:"button",...a,ref:s,onClick:c(r.onClick,()=>i.onOpenChange(!1))})}).displayName=Jl;function Yl(e){return e?"open":"closed"}W.forwardRef((t,r)=>{const{__scopePopover:s,...n}=t,a=Ol(s);return e.jsx(_,{...a,...n,ref:r})}).displayName="PopoverArrow";var Gl=ql,Xl=Wl;const Ql=Ml,Zl=$l,ec=W.forwardRef(({className:t,align:r="center",sideOffset:s=4,...n},a)=>e.jsx(Gl,{children:e.jsx(Xl,{ref:a,align:r,sideOffset:s,className:Na("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",t),...n})}));function tc({date:t,onSelect:r,className:s}){return e.jsx(rc,{date:t,onSelect:r,className:s})}function rc({date:t,onSelect:r,className:s}){return e.jsx("div",{className:Na("grid gap-2",s),children:e.jsxs(Ql,{children:[e.jsx(Zl,{asChild:!0,children:e.jsxs(Ma,{id:"date",variant:"outline",className:Na("w-[300px] justify-start text-left font-normal",!t&&"text-muted-foreground"),children:[e.jsx(ve,{className:"mr-2 h-4 w-4"}),(null==t?void 0:t.from)?t.to?e.jsxs(e.Fragment,{children:[Bi(t.from,"dd MMM yyyy",{locale:eo})," - ",Bi(t.to,"dd MMM yyyy",{locale:eo})]}):Bi(t.from,"dd MMM yyyy",{locale:eo}):e.jsx("span",{children:"Sélectionner une période"})]})}),e.jsx(ec,{className:"w-auto p-0",align:"start",children:e.jsx(Cl,{initialFocus:!0,mode:"range",defaultMonth:null==t?void 0:t.from,selected:t,onSelect:r,numberOfMonths:2,locale:eo})})]})})}ec.displayName=Xl.displayName;const sc=P,nc=W.forwardRef(({className:t,...r},s)=>e.jsx(C,{ref:s,className:Na("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",t),...r}));nc.displayName=C.displayName;const ac=W.forwardRef(({className:t,...r},s)=>e.jsx(E,{ref:s,className:Na("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",t),...r}));ac.displayName=E.displayName;const ic=W.forwardRef(({className:t,...r},s)=>e.jsx(T,{ref:s,className:Na("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",t),...r}));ic.displayName=T.displayName;const oc=W.forwardRef(({className:t,...r},s)=>e.jsx("div",{ref:s,className:Na("rounded-lg border bg-card text-card-foreground shadow-sm",t),...r}));oc.displayName="Card";const lc=W.forwardRef(({className:t,...r},s)=>e.jsx("div",{ref:s,className:Na("flex flex-col space-y-1.5 p-6",t),...r}));lc.displayName="CardHeader";const cc=W.forwardRef(({className:t,...r},s)=>e.jsx("h3",{ref:s,className:Na("text-2xl font-semibold leading-none tracking-tight",t),...r}));cc.displayName="CardTitle";const dc=W.forwardRef(({className:t,...r},s)=>e.jsx("p",{ref:s,className:Na("text-sm text-muted-foreground",t),...r}));dc.displayName="CardDescription";const uc=W.forwardRef(({className:t,...r},s)=>e.jsx("div",{ref:s,className:Na("p-6 pt-0",t),...r}));uc.displayName="CardContent";function hc(e,[t,r]){return Math.min(r,Math.max(t,e))}function mc(e){const t=W.useRef({value:e,previous:e});return W.useMemo(()=>(t.current.value!==e&&(t.current.previous=t.current.value,t.current.value=e),t.current.previous),[e])}W.forwardRef(({className:t,...r},s)=>e.jsx("div",{ref:s,className:Na("flex items-center p-6 pt-0",t),...r})).displayName="CardFooter";var fc=[" ","Enter","ArrowUp","ArrowDown"],pc=[" ","Enter"],vc="Select",[gc,xc,yc]=r(vc),[bc,wc]=s(vc,[yc,p]),jc=p(),[_c,Nc]=bc(vc),[kc,Sc]=bc(vc),Cc=t=>{const{__scopeSelect:r,children:s,open:n,defaultOpen:a,onOpenChange:o,value:l,defaultValue:c,onValueChange:d,dir:u,name:h,autoComplete:m,disabled:f,required:p,form:v}=t,g=jc(r),[x,y]=W.useState(null),[b,w]=W.useState(null),[j,_]=W.useState(!1),N=O(u),[C,E]=i({prop:n,defaultProp:a??!1,onChange:o,caller:vc}),[T,P]=i({prop:l,defaultProp:c,onChange:d,caller:vc}),D=W.useRef(null),R=!x||(v||!!x.closest("form")),[M,A]=W.useState(new Set),I=Array.from(M).map(e=>e.props.value).join(";");return e.jsx(k,{...g,children:e.jsxs(_c,{required:p,scope:r,trigger:x,onTriggerChange:y,valueNode:b,onValueNodeChange:w,valueNodeHasChildren:j,onValueNodeHasChildrenChange:_,contentId:S(),value:T,onValueChange:P,open:C,onOpenChange:E,dir:N,triggerPointerDownPosRef:D,disabled:f,children:[e.jsx(gc.Provider,{scope:r,children:e.jsx(kc,{scope:t.__scopeSelect,onNativeOptionAdd:W.useCallback(e=>{A(t=>new Set(t).add(e))},[]),onNativeOptionRemove:W.useCallback(e=>{A(t=>{const r=new Set(t);return r.delete(e),r})},[]),children:s})}),R?e.jsxs(md,{"aria-hidden":!0,required:p,tabIndex:-1,name:h,autoComplete:m,value:T,onChange:e=>P(e.target.value),disabled:f,form:v,children:[void 0===T?e.jsx("option",{value:""}):null,Array.from(M)]},I):null]})})};Cc.displayName=vc;var Ec="SelectTrigger",Tc=W.forwardRef((r,s)=>{const{__scopeSelect:a,disabled:i=!1,...o}=r,l=jc(a),d=Nc(Ec,a),u=d.disabled||i,h=n(s,d.onTriggerChange),m=xc(a),f=W.useRef("touch"),[p,g,x]=pd(e=>{const t=m().filter(e=>!e.disabled),r=t.find(e=>e.value===d.value),s=vd(t,e,r);void 0!==s&&d.onValueChange(s.value)}),y=e=>{u||(d.onOpenChange(!0),x()),e&&(d.triggerPointerDownPosRef.current={x:Math.round(e.pageX),y:Math.round(e.pageY)})};return e.jsx(v,{asChild:!0,...l,children:e.jsx(t.button,{type:"button",role:"combobox","aria-controls":d.contentId,"aria-expanded":d.open,"aria-required":d.required,"aria-autocomplete":"none",dir:d.dir,"data-state":d.open?"open":"closed",disabled:u,"data-disabled":u?"":void 0,"data-placeholder":fd(d.value)?"":void 0,...o,ref:h,onClick:c(o.onClick,e=>{e.currentTarget.focus(),"mouse"!==f.current&&y(e)}),onPointerDown:c(o.onPointerDown,e=>{f.current=e.pointerType;const t=e.target;t.hasPointerCapture(e.pointerId)&&t.releasePointerCapture(e.pointerId),0===e.button&&!1===e.ctrlKey&&"mouse"===e.pointerType&&(y(e),e.preventDefault())}),onKeyDown:c(o.onKeyDown,e=>{const t=""!==p.current;e.ctrlKey||e.altKey||e.metaKey||1!==e.key.length||g(e.key),t&&" "===e.key||fc.includes(e.key)&&(y(),e.preventDefault())})})})});Tc.displayName=Ec;var Pc="SelectValue",Oc=W.forwardRef((r,s)=>{const{__scopeSelect:a,className:i,style:o,children:l,placeholder:c="",...d}=r,u=Nc(Pc,a),{onValueNodeHasChildrenChange:m}=u,f=void 0!==l,p=n(s,u.onValueNodeChange);return h(()=>{m(f)},[m,f]),e.jsx(t.span,{...d,ref:p,style:{pointerEvents:"none"},children:fd(u.value)?e.jsx(e.Fragment,{children:c}):l})});Oc.displayName=Pc;var Dc=W.forwardRef((r,s)=>{const{__scopeSelect:n,children:a,...i}=r;return e.jsx(t.span,{"aria-hidden":!0,...i,ref:s,children:a||"▼"})});Dc.displayName="SelectIcon";var Rc=t=>e.jsx(u,{asChild:!0,...t});Rc.displayName="SelectPortal";var Mc="SelectContent",Ac=W.forwardRef((t,r)=>{const s=Nc(Mc,t.__scopeSelect),[n,a]=W.useState();if(h(()=>{a(new DocumentFragment)},[]),!s.open){const r=n;return r?B.createPortal(e.jsx($c,{scope:t.__scopeSelect,children:e.jsx(gc.Slot,{scope:t.__scopeSelect,children:e.jsx("div",{children:t.children})})}),r):null}return e.jsx(Bc,{...t,ref:r})});Ac.displayName=Mc;var Ic=10,[$c,Lc]=bc(Mc),Fc=N("SelectContent.RemoveScroll"),Bc=W.forwardRef((t,r)=>{const{__scopeSelect:s,position:a="item-aligned",onCloseAutoFocus:i,onEscapeKeyDown:o,onPointerDownOutside:l,side:d,sideOffset:u,align:h,alignOffset:m,arrowPadding:f,collisionBoundary:p,collisionPadding:v,sticky:j,hideWhenDetached:_,avoidCollisions:N,...k}=t,S=Nc(Mc,s),[C,E]=W.useState(null),[T,P]=W.useState(null),O=n(r,e=>E(e)),[D,R]=W.useState(null),[M,A]=W.useState(null),I=xc(s),[$,L]=W.useState(!1),F=W.useRef(!1);W.useEffect(()=>{if(C)return g(C)},[C]),y();const B=W.useCallback(e=>{const[t,...r]=I().map(e=>e.ref.current),[s]=r.slice(-1),n=document.activeElement;for(const a of e){if(a===n)return;if(null==a||a.scrollIntoView({block:"nearest"}),a===t&&T&&(T.scrollTop=0),a===s&&T&&(T.scrollTop=T.scrollHeight),null==a||a.focus(),document.activeElement!==n)return}},[I,T]),q=W.useCallback(()=>B([D,C]),[B,D,C]);W.useEffect(()=>{$&&q()},[$,q]);const{onOpenChange:U,triggerPointerDownPosRef:z}=S;W.useEffect(()=>{if(C){let e={x:0,y:0};const t=t=>{var r,s;e={x:Math.abs(Math.round(t.pageX)-((null==(r=z.current)?void 0:r.x)??0)),y:Math.abs(Math.round(t.pageY)-((null==(s=z.current)?void 0:s.y)??0))}},r=r=>{e.x<=10&&e.y<=10?r.preventDefault():C.contains(r.target)||U(!1),document.removeEventListener("pointermove",t),z.current=null};return null!==z.current&&(document.addEventListener("pointermove",t),document.addEventListener("pointerup",r,{capture:!0,once:!0})),()=>{document.removeEventListener("pointermove",t),document.removeEventListener("pointerup",r,{capture:!0})}}},[C,U,z]),W.useEffect(()=>{const e=()=>U(!1);return window.addEventListener("blur",e),window.addEventListener("resize",e),()=>{window.removeEventListener("blur",e),window.removeEventListener("resize",e)}},[U]);const[H,K]=pd(e=>{const t=I().filter(e=>!e.disabled),r=t.find(e=>e.ref.current===document.activeElement),s=vd(t,e,r);s&&setTimeout(()=>s.ref.current.focus())}),V=W.useCallback((e,t,r)=>{const s=!F.current&&!r;(void 0!==S.value&&S.value===t||s)&&(R(e),s&&(F.current=!0))},[S.value]),J=W.useCallback(()=>null==C?void 0:C.focus(),[C]),Y=W.useCallback((e,t,r)=>{const s=!F.current&&!r;(void 0!==S.value&&S.value===t||s)&&A(e)},[S.value]),G="popper"===a?Uc:qc,X=G===Uc?{side:d,sideOffset:u,align:h,alignOffset:m,arrowPadding:f,collisionBoundary:p,collisionPadding:v,sticky:j,hideWhenDetached:_,avoidCollisions:N}:{};return e.jsx($c,{scope:s,content:C,viewport:T,onViewportChange:P,itemRefCallback:V,selectedItem:D,onItemLeave:J,itemTextRefCallback:Y,focusSelectedItem:q,selectedItemText:M,position:a,isPositioned:$,searchRef:H,children:e.jsx(x,{as:Fc,allowPinchZoom:!0,children:e.jsx(b,{asChild:!0,trapped:S.open,onMountAutoFocus:e=>{e.preventDefault()},onUnmountAutoFocus:c(i,e=>{var t;null==(t=S.trigger)||t.focus({preventScroll:!0}),e.preventDefault()}),children:e.jsx(w,{asChild:!0,disableOutsidePointerEvents:!0,onEscapeKeyDown:o,onPointerDownOutside:l,onFocusOutside:e=>e.preventDefault(),onDismiss:()=>S.onOpenChange(!1),children:e.jsx(G,{role:"listbox",id:S.contentId,"data-state":S.open?"open":"closed",dir:S.dir,onContextMenu:e=>e.preventDefault(),...k,...X,onPlaced:()=>L(!0),ref:O,style:{display:"flex",flexDirection:"column",outline:"none",...k.style},onKeyDown:c(k.onKeyDown,e=>{const t=e.ctrlKey||e.altKey||e.metaKey;if("Tab"===e.key&&e.preventDefault(),t||1!==e.key.length||K(e.key),["ArrowUp","ArrowDown","Home","End"].includes(e.key)){let t=I().filter(e=>!e.disabled).map(e=>e.ref.current);if(["ArrowUp","End"].includes(e.key)&&(t=t.slice().reverse()),["ArrowUp","ArrowDown"].includes(e.key)){const r=e.target,s=t.indexOf(r);t=t.slice(s+1)}setTimeout(()=>B(t)),e.preventDefault()}})})})})})})});Bc.displayName="SelectContentImpl";var qc=W.forwardRef((r,s)=>{const{__scopeSelect:a,onPlaced:i,...o}=r,l=Nc(Mc,a),c=Lc(Mc,a),[d,u]=W.useState(null),[m,f]=W.useState(null),p=n(s,e=>f(e)),v=xc(a),g=W.useRef(!1),x=W.useRef(!0),{viewport:y,selectedItem:b,selectedItemText:w,focusSelectedItem:j}=c,_=W.useCallback(()=>{if(l.trigger&&l.valueNode&&d&&m&&y&&b&&w){const e=l.trigger.getBoundingClientRect(),t=m.getBoundingClientRect(),r=l.valueNode.getBoundingClientRect(),s=w.getBoundingClientRect();if("rtl"!==l.dir){const n=s.left-t.left,a=r.left-n,i=e.left-a,o=e.width+i,l=Math.max(o,t.width),c=window.innerWidth-Ic,u=hc(a,[Ic,Math.max(Ic,c-l)]);d.style.minWidth=o+"px",d.style.left=u+"px"}else{const n=t.right-s.right,a=window.innerWidth-r.right-n,i=window.innerWidth-e.right-a,o=e.width+i,l=Math.max(o,t.width),c=window.innerWidth-Ic,u=hc(a,[Ic,Math.max(Ic,c-l)]);d.style.minWidth=o+"px",d.style.right=u+"px"}const n=v(),a=window.innerHeight-2*Ic,o=y.scrollHeight,c=window.getComputedStyle(m),u=parseInt(c.borderTopWidth,10),h=parseInt(c.paddingTop,10),f=parseInt(c.borderBottomWidth,10),p=u+h+o+parseInt(c.paddingBottom,10)+f,x=Math.min(5*b.offsetHeight,p),j=window.getComputedStyle(y),_=parseInt(j.paddingTop,10),N=parseInt(j.paddingBottom,10),k=e.top+e.height/2-Ic,S=a-k,C=b.offsetHeight/2,E=u+h+(b.offsetTop+C),T=p-E;if(E<=k){const e=n.length>0&&b===n[n.length-1].ref.current;d.style.bottom="0px";const t=m.clientHeight-y.offsetTop-y.offsetHeight,r=E+Math.max(S,C+(e?N:0)+t+f);d.style.height=r+"px"}else{const e=n.length>0&&b===n[0].ref.current;d.style.top="0px";const t=Math.max(k,u+y.offsetTop+(e?_:0)+C)+T;d.style.height=t+"px",y.scrollTop=E-k+y.offsetTop}d.style.margin=`${Ic}px 0`,d.style.minHeight=x+"px",d.style.maxHeight=a+"px",null==i||i(),requestAnimationFrame(()=>g.current=!0)}},[v,l.trigger,l.valueNode,d,m,y,b,w,l.dir,i]);h(()=>_(),[_]);const[N,k]=W.useState();h(()=>{m&&k(window.getComputedStyle(m).zIndex)},[m]);const S=W.useCallback(e=>{e&&!0===x.current&&(_(),null==j||j(),x.current=!1)},[_,j]);return e.jsx(Wc,{scope:a,contentWrapper:d,shouldExpandOnScrollRef:g,onScrollButtonChange:S,children:e.jsx("div",{ref:u,style:{display:"flex",flexDirection:"column",position:"fixed",zIndex:N},children:e.jsx(t.div,{...o,ref:p,style:{boxSizing:"border-box",maxHeight:"100%",...o.style}})})})});qc.displayName="SelectItemAlignedPosition";var Uc=W.forwardRef((t,r)=>{const{__scopeSelect:s,align:n="start",collisionPadding:a=Ic,...i}=t,o=jc(s);return e.jsx(j,{...o,...i,ref:r,align:n,collisionPadding:a,style:{boxSizing:"border-box",...i.style,"--radix-select-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-select-content-available-width":"var(--radix-popper-available-width)","--radix-select-content-available-height":"var(--radix-popper-available-height)","--radix-select-trigger-width":"var(--radix-popper-anchor-width)","--radix-select-trigger-height":"var(--radix-popper-anchor-height)"}})});Uc.displayName="SelectPopperPosition";var[Wc,zc]=bc(Mc,{}),Hc="SelectViewport",Kc=W.forwardRef((r,s)=>{const{__scopeSelect:a,nonce:i,...o}=r,l=Lc(Hc,a),d=zc(Hc,a),u=n(s,l.onViewportChange),h=W.useRef(0);return e.jsxs(e.Fragment,{children:[e.jsx("style",{dangerouslySetInnerHTML:{__html:"[data-radix-select-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-select-viewport]::-webkit-scrollbar{display:none}"},nonce:i}),e.jsx(gc.Slot,{scope:a,children:e.jsx(t.div,{"data-radix-select-viewport":"",role:"presentation",...o,ref:u,style:{position:"relative",flex:1,overflow:"hidden auto",...o.style},onScroll:c(o.onScroll,e=>{const t=e.currentTarget,{contentWrapper:r,shouldExpandOnScrollRef:s}=d;if((null==s?void 0:s.current)&&r){const e=Math.abs(h.current-t.scrollTop);if(e>0){const s=window.innerHeight-2*Ic,n=parseFloat(r.style.minHeight),a=parseFloat(r.style.height),i=Math.max(n,a);if(i<s){const n=i+e,a=Math.min(s,n),o=n-a;r.style.height=a+"px","0px"===r.style.bottom&&(t.scrollTop=o>0?o:0,r.style.justifyContent="flex-end")}}}h.current=t.scrollTop})})})]})});Kc.displayName=Hc;var Vc="SelectGroup",[Jc,Yc]=bc(Vc);W.forwardRef((r,s)=>{const{__scopeSelect:n,...a}=r,i=S();return e.jsx(Jc,{scope:n,id:i,children:e.jsx(t.div,{role:"group","aria-labelledby":i,...a,ref:s})})}).displayName=Vc;var Gc="SelectLabel",Xc=W.forwardRef((r,s)=>{const{__scopeSelect:n,...a}=r,i=Yc(Gc,n);return e.jsx(t.div,{id:i.id,...a,ref:s})});Xc.displayName=Gc;var Qc="SelectItem",[Zc,ed]=bc(Qc),td=W.forwardRef((r,s)=>{const{__scopeSelect:a,value:i,disabled:o=!1,textValue:l,...d}=r,u=Nc(Qc,a),h=Lc(Qc,a),m=u.value===i,[f,p]=W.useState(l??""),[v,g]=W.useState(!1),x=n(s,e=>{var t;return null==(t=h.itemRefCallback)?void 0:t.call(h,e,i,o)}),y=S(),b=W.useRef("touch"),w=()=>{o||(u.onValueChange(i),u.onOpenChange(!1))};if(""===i)throw new Error("A <Select.Item /> must have a value prop that is not an empty string. This is because the Select value can be set to an empty string to clear the selection and show the placeholder.");return e.jsx(Zc,{scope:a,value:i,disabled:o,textId:y,isSelected:m,onItemTextChange:W.useCallback(e=>{p(t=>t||((null==e?void 0:e.textContent)??"").trim())},[]),children:e.jsx(gc.ItemSlot,{scope:a,value:i,disabled:o,textValue:f,children:e.jsx(t.div,{role:"option","aria-labelledby":y,"data-highlighted":v?"":void 0,"aria-selected":m&&v,"data-state":m?"checked":"unchecked","aria-disabled":o||void 0,"data-disabled":o?"":void 0,tabIndex:o?void 0:-1,...d,ref:x,onFocus:c(d.onFocus,()=>g(!0)),onBlur:c(d.onBlur,()=>g(!1)),onClick:c(d.onClick,()=>{"mouse"!==b.current&&w()}),onPointerUp:c(d.onPointerUp,()=>{"mouse"===b.current&&w()}),onPointerDown:c(d.onPointerDown,e=>{b.current=e.pointerType}),onPointerMove:c(d.onPointerMove,e=>{var t;b.current=e.pointerType,o?null==(t=h.onItemLeave)||t.call(h):"mouse"===b.current&&e.currentTarget.focus({preventScroll:!0})}),onPointerLeave:c(d.onPointerLeave,e=>{var t;e.currentTarget===document.activeElement&&(null==(t=h.onItemLeave)||t.call(h))}),onKeyDown:c(d.onKeyDown,e=>{var t;""!==(null==(t=h.searchRef)?void 0:t.current)&&" "===e.key||(pc.includes(e.key)&&w()," "===e.key&&e.preventDefault())})})})})});td.displayName=Qc;var rd="SelectItemText",sd=W.forwardRef((r,s)=>{const{__scopeSelect:a,className:i,style:o,...l}=r,c=Nc(rd,a),d=Lc(rd,a),u=ed(rd,a),m=Sc(rd,a),[f,p]=W.useState(null),v=n(s,e=>p(e),u.onItemTextChange,e=>{var t;return null==(t=d.itemTextRefCallback)?void 0:t.call(d,e,u.value,u.disabled)}),g=null==f?void 0:f.textContent,x=W.useMemo(()=>e.jsx("option",{value:u.value,disabled:u.disabled,children:g},u.value),[u.disabled,u.value,g]),{onNativeOptionAdd:y,onNativeOptionRemove:b}=m;return h(()=>(y(x),()=>b(x)),[y,b,x]),e.jsxs(e.Fragment,{children:[e.jsx(t.span,{id:u.textId,...l,ref:v}),u.isSelected&&c.valueNode&&!c.valueNodeHasChildren?B.createPortal(l.children,c.valueNode):null]})});sd.displayName=rd;var nd="SelectItemIndicator",ad=W.forwardRef((r,s)=>{const{__scopeSelect:n,...a}=r;return ed(nd,n).isSelected?e.jsx(t.span,{"aria-hidden":!0,...a,ref:s}):null});ad.displayName=nd;var id="SelectScrollUpButton",od=W.forwardRef((t,r)=>{const s=Lc(id,t.__scopeSelect),a=zc(id,t.__scopeSelect),[i,o]=W.useState(!1),l=n(r,a.onScrollButtonChange);return h(()=>{if(s.viewport&&s.isPositioned){let e=function(){const e=t.scrollTop>0;o(e)};const t=s.viewport;return e(),t.addEventListener("scroll",e),()=>t.removeEventListener("scroll",e)}},[s.viewport,s.isPositioned]),i?e.jsx(dd,{...t,ref:l,onAutoScroll:()=>{const{viewport:e,selectedItem:t}=s;e&&t&&(e.scrollTop=e.scrollTop-t.offsetHeight)}}):null});od.displayName=id;var ld="SelectScrollDownButton",cd=W.forwardRef((t,r)=>{const s=Lc(ld,t.__scopeSelect),a=zc(ld,t.__scopeSelect),[i,o]=W.useState(!1),l=n(r,a.onScrollButtonChange);return h(()=>{if(s.viewport&&s.isPositioned){let e=function(){const e=t.scrollHeight-t.clientHeight,r=Math.ceil(t.scrollTop)<e;o(r)};const t=s.viewport;return e(),t.addEventListener("scroll",e),()=>t.removeEventListener("scroll",e)}},[s.viewport,s.isPositioned]),i?e.jsx(dd,{...t,ref:l,onAutoScroll:()=>{const{viewport:e,selectedItem:t}=s;e&&t&&(e.scrollTop=e.scrollTop+t.offsetHeight)}}):null});cd.displayName=ld;var dd=W.forwardRef((r,s)=>{const{__scopeSelect:n,onAutoScroll:a,...i}=r,o=Lc("SelectScrollButton",n),l=W.useRef(null),d=xc(n),u=W.useCallback(()=>{null!==l.current&&(window.clearInterval(l.current),l.current=null)},[]);return W.useEffect(()=>()=>u(),[u]),h(()=>{var e;const t=d().find(e=>e.ref.current===document.activeElement);null==(e=null==t?void 0:t.ref.current)||e.scrollIntoView({block:"nearest"})},[d]),e.jsx(t.div,{"aria-hidden":!0,...i,ref:s,style:{flexShrink:0,...i.style},onPointerDown:c(i.onPointerDown,()=>{null===l.current&&(l.current=window.setInterval(a,50))}),onPointerMove:c(i.onPointerMove,()=>{var e;null==(e=o.onItemLeave)||e.call(o),null===l.current&&(l.current=window.setInterval(a,50))}),onPointerLeave:c(i.onPointerLeave,()=>{u()})})}),ud=W.forwardRef((r,s)=>{const{__scopeSelect:n,...a}=r;return e.jsx(t.div,{"aria-hidden":!0,...a,ref:s})});ud.displayName="SelectSeparator";var hd="SelectArrow";W.forwardRef((t,r)=>{const{__scopeSelect:s,...n}=t,a=jc(s),i=Nc(hd,s),o=Lc(hd,s);return i.open&&"popper"===o.position?e.jsx(_,{...a,...n,ref:r}):null}).displayName=hd;var md=W.forwardRef(({__scopeSelect:r,value:s,...a},i)=>{const o=W.useRef(null),l=n(i,o),c=mc(s);return W.useEffect(()=>{const e=o.current;if(!e)return;const t=window.HTMLSelectElement.prototype,r=Object.getOwnPropertyDescriptor(t,"value").set;if(c!==s&&r){const t=new Event("change",{bubbles:!0});r.call(e,s),e.dispatchEvent(t)}},[c,s]),e.jsx(t.select,{...a,style:{...Rn,...a.style},ref:l,defaultValue:s})});function fd(e){return""===e||void 0===e}function pd(e){const t=l(e),r=W.useRef(""),s=W.useRef(0),n=W.useCallback(e=>{const n=r.current+e;t(n),function e(t){r.current=t,window.clearTimeout(s.current),""!==t&&(s.current=window.setTimeout(()=>e(""),1e3))}(n)},[t]),a=W.useCallback(()=>{r.current="",window.clearTimeout(s.current)},[]);return W.useEffect(()=>()=>window.clearTimeout(s.current),[]),[r,n,a]}function vd(e,t,r){const s=t.length>1&&Array.from(t).every(e=>e===t[0])?t[0]:t,n=r?e.indexOf(r):-1;let a=(i=e,o=Math.max(n,0),i.map((e,t)=>i[(o+t)%i.length]));var i,o;1===s.length&&(a=a.filter(e=>e!==r));const l=a.find(e=>e.textValue.toLowerCase().startsWith(s.toLowerCase()));return l!==r?l:void 0}md.displayName="SelectBubbleInput";var gd=Tc,xd=Dc,yd=Rc,bd=Ac,wd=Kc,jd=Xc,_d=td,Nd=sd,kd=ad,Sd=od,Cd=cd,Ed=ud;const Td=Cc,Pd=Oc,Od=W.forwardRef(({className:t,children:r,...s},n)=>e.jsxs(gd,{ref:n,className:Na("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",t),...s,children:[r,e.jsx(xd,{asChild:!0,children:e.jsx(ge,{className:"h-4 w-4 opacity-50"})})]}));Od.displayName=gd.displayName;const Dd=W.forwardRef(({className:t,...r},s)=>e.jsx(Sd,{ref:s,className:Na("flex cursor-default items-center justify-center py-1",t),...r,children:e.jsx(xe,{className:"h-4 w-4"})}));Dd.displayName=Sd.displayName;const Rd=W.forwardRef(({className:t,...r},s)=>e.jsx(Cd,{ref:s,className:Na("flex cursor-default items-center justify-center py-1",t),...r,children:e.jsx(ge,{className:"h-4 w-4"})}));Rd.displayName=Cd.displayName;const Md=W.forwardRef(({className:t,children:r,position:s="popper",...n},a)=>e.jsx(yd,{children:e.jsxs(bd,{ref:a,className:Na("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2","popper"===s&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",t),position:s,...n,children:[e.jsx(Dd,{}),e.jsx(wd,{className:Na("p-1","popper"===s&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:r}),e.jsx(Rd,{})]})}));Md.displayName=bd.displayName;W.forwardRef(({className:t,...r},s)=>e.jsx(jd,{ref:s,className:Na("py-1.5 pl-8 pr-2 text-sm font-semibold",t),...r})).displayName=jd.displayName;const Ad=W.forwardRef(({className:t,children:r,...s},n)=>e.jsxs(_d,{ref:n,className:Na("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t),...s,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(kd,{children:e.jsx(ye,{className:"h-4 w-4"})})}),e.jsx(Nd,{children:r})]}));Ad.displayName=_d.displayName;function Id({projets:t=[],contrats:r=[]}){const[s,n]=W.useState("all"),a=W.useMemo(()=>{const e=new Date,n=r.filter(t=>(t=>{if("all"===s)return!0;if(!t)return!1;const r=new Date(t),n=Math.floor((e.getTime()-r.getTime())/864e5);switch(s){case"7d":return n<=7;case"30d":return n<=30;case"90d":return n<=90;case"1y":return n<=365;default:return!0}})(t.contrat_date_creation)),a={};n.forEach(e=>{const r=t.find(t=>t.projet_id===e.projet_id),s=(null==r?void 0:r.commercial)||"Non attribué";a[s]||(a[s]={contrats:0,primeTotal:0,commissionAnnee1:0}),a[s].contrats++,a[s].primeTotal+=e.prime_brute_annuelle||0,a[s].commissionAnnee1+=e.commissionnement_annee1||0});const i={};n.forEach(e=>{if(e.contrat_date_creation){const t=new Date(e.contrat_date_creation),r=`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}`;i[r]||(i[r]={month:r,primes:0,commissions:0}),i[r].primes+=e.prime_brute_annuelle||0,i[r].commissions+=e.commissionnement_annee1||0}});const o=Object.values(i).sort((e,t)=>e.month.localeCompare(t.month)),l=n.reduce((e,t)=>e+(t.prime_brute_annuelle||0),0),c=n.reduce((e,t)=>e+(t.commissionnement_annee1||0),0);return{revenueByCommercial:Object.entries(a).map(([e,t])=>({nom:e,...t})).sort((e,t)=>t.commissionAnnee1-e.commissionAnnee1),monthlyData:o,globalMetrics:{totalPrimes:l,totalCommissions:c,nbContrats:n.length}}},[r,t,s]);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-foreground",children:"Analyse des Revenus"}),e.jsx("p",{className:"text-muted-foreground",children:"Primes et commissions sur la période sélectionnée"})]}),e.jsxs(Td,{value:s,onValueChange:n,children:[e.jsx(Od,{className:"w-40",children:e.jsx(Pd,{})}),e.jsxs(Md,{children:[e.jsx(Ad,{value:"all",children:"Afficher tout"}),e.jsx(Ad,{value:"7d",children:"7 derniers jours"}),e.jsx(Ad,{value:"30d",children:"30 derniers jours"}),e.jsx(Ad,{value:"90d",children:"3 derniers mois"}),e.jsx(Ad,{value:"1y",children:"Cette année"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[e.jsx(oc,{className:"card-glow",children:e.jsxs(uc,{className:"p-6",children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Nombre de Contrats"}),e.jsx("p",{className:"text-2xl font-bold text-foreground",children:a.globalMetrics.nbContrats})]})}),e.jsx(oc,{className:"card-glow",children:e.jsxs(uc,{className:"p-6",children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Total Commissions"}),e.jsxs("p",{className:"text-2xl font-bold text-foreground",children:["€",a.globalMetrics.totalCommissions.toLocaleString()]})]})}),e.jsx(oc,{className:"card-glow",children:e.jsxs(uc,{className:"p-6",children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Nombre de Contrats"}),e.jsx("p",{className:"text-2xl font-bold text-foreground",children:a.globalMetrics.nbContrats})]})})]}),e.jsxs(oc,{className:"card-glow",children:[e.jsx(lc,{children:e.jsx(cc,{children:"Évolution Mensuelle des Revenus"})}),e.jsx(uc,{children:e.jsx(Re,{width:"100%",height:300,children:e.jsxs(Me,{data:a.monthlyData,children:[e.jsx(Ae,{strokeDasharray:"3 3"}),e.jsx(Ie,{dataKey:"month"}),e.jsx($e,{}),e.jsx(Le,{formatter:e=>`€${Number(e).toLocaleString()}`}),e.jsx(Fe,{type:"monotone",dataKey:"primes",stroke:"#3b82f6",name:"Primes",strokeWidth:2}),e.jsx(Fe,{type:"monotone",dataKey:"commissions",stroke:"#10b981",name:"Commissions",strokeWidth:2})]})})})]})]})}function $d({projets:t=[],contrats:r=[]}){const[s,n]=W.useState("all"),a=W.useMemo(()=>{const e=new Date,t=r.filter(t=>(t=>{if("all"===s)return!0;if(!t)return!1;const r=new Date(t),n=Math.floor((e.getTime()-r.getTime())/864e5);switch(s){case"7d":return n<=7;case"30d":return n<=30;case"90d":return n<=90;case"1y":return n<=365;default:return!0}})(t.contrat_date_creation)),n={};t.forEach(e=>{const t=e.contrat_produit||"Non spécifié";n[t]||(n[t]={contrats:0,primeTotal:0,commissionTotal:0}),n[t].contrats++,n[t].primeTotal+=e.prime_brute_annuelle||0,n[t].commissionTotal+=e.commissionnement_annee1||0});const a=Object.entries(n).map(([e,t])=>({nom:e,...t})).sort((e,t)=>t.primeTotal-e.primeTotal),i={};t.forEach(e=>{const t=e.contrat_compagnie||"Non spécifiée";i[t]||(i[t]={contrats:0,primeTotal:0}),i[t].contrats++,i[t].primeTotal+=e.prime_brute_annuelle||0});return{topProduits:a,topCompanies:Object.entries(i).map(([e,t])=>({nom:e,...t})).sort((e,t)=>t.primeTotal-e.primeTotal),totalContrats:t.length}},[r,s]),i=["#3b82f6","#ef4444","#10b981","#f59e0b","#8b5cf6","#ec4899"];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-foreground",children:"Analyse Produits & Compagnies"}),e.jsx("p",{className:"text-muted-foreground",children:"Performance par produit et compagnie"})]}),e.jsxs(Td,{value:s,onValueChange:n,children:[e.jsx(Od,{className:"w-40",children:e.jsx(Pd,{})}),e.jsxs(Md,{children:[e.jsx(Ad,{value:"all",children:"Afficher tout"}),e.jsx(Ad,{value:"7d",children:"7 derniers jours"}),e.jsx(Ad,{value:"30d",children:"30 derniers jours"}),e.jsx(Ad,{value:"90d",children:"3 derniers mois"}),e.jsx(Ad,{value:"1y",children:"Cette année"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(oc,{className:"card-glow",children:[e.jsx(lc,{children:e.jsx(cc,{children:"Top Produits par Chiffre d'Affaires"})}),e.jsx(uc,{children:e.jsx(Re,{width:"100%",height:300,children:e.jsxs(Be,{data:a.topProduits.slice(0,5),children:[e.jsx(Ae,{strokeDasharray:"3 3"}),e.jsx(Ie,{dataKey:"nom"}),e.jsx($e,{}),e.jsx(Le,{formatter:e=>`€${Number(e).toLocaleString()}`}),e.jsx(qe,{dataKey:"primeTotal",fill:"#3b82f6"})]})})})]}),e.jsxs(oc,{className:"card-glow",children:[e.jsx(lc,{children:e.jsx(cc,{children:"Répartition par Compagnie"})}),e.jsx(uc,{children:e.jsx(Re,{width:"100%",height:300,children:e.jsxs(Ue,{children:[e.jsx(We,{data:a.topCompanies.slice(0,5),cx:"50%",cy:"50%",outerRadius:100,dataKey:"primeTotal",nameKey:"nom",children:a.topCompanies.slice(0,5).map((t,r)=>e.jsx(ze,{fill:i[r%i.length]},`cell-${r}`))}),e.jsx(Le,{formatter:e=>`€${Number(e).toLocaleString()}`})]})})})]})]})]})}function Ld({projets:t=[],contrats:r=[]}){const[s,n]=W.useState("all"),a=W.useMemo(()=>{const e=new Date,n=t=>{if("all"===s)return!0;if(!t)return!1;const r=new Date(t),n=Math.floor((e.getTime()-r.getTime())/864e5);switch(s){case"7d":return n<=7;case"30d":return n<=30;case"90d":return n<=90;case"1y":return n<=365;default:return!0}},a=t.filter(e=>n(e.date_creation)),o=r.filter(e=>n(e.created_at)||n(e.contrat_date_creation)),l={},c=new Set;a.forEach(e=>{e.statut&&(c.add(e.statut),l[e.statut]=(l[e.statut]||0)+1)});const d=Array.from(c).sort((e,t)=>l[t]-l[e]).map(e=>({name:e,value:l[e]||0,fill:i(e)})).filter(e=>e.value>0),u=a.length,h=o.length;let m=0;if(o.some(e=>e.projet_id)){const e=new Set(o.map(e=>e.projet_id).filter(e=>e));m=a.filter(t=>t.projet_id&&e.has(t.projet_id)).length}else m=Math.floor(.8*h);return{funnelData:d,totalProjets:u,projetsSignes:m,totalContrats:h,tauxConversion:u>0?m/u*100:0,statutsDisponibles:Array.from(c),statutCounts:l}},[t,r,s]);function i(e){return{Nouveau:"#3b82f6","Projet à traiter":"#f59e0b","Devis envoyé":"#8b5cf6","Contrat enregistré":"#10b981",Perdu:"#ef4444"}[e]||"#6b7280"}return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-foreground",children:"Analyse du Pipeline Commercial"}),e.jsx("p",{className:"text-muted-foreground",children:"Suivi des opportunités et entonnoir de conversion"})]}),e.jsxs(Td,{value:s,onValueChange:n,children:[e.jsx(Od,{className:"w-40",children:e.jsx(Pd,{})}),e.jsxs(Md,{children:[e.jsx(Ad,{value:"all",children:"Afficher tout"}),e.jsx(Ad,{value:"7d",children:"7 derniers jours"}),e.jsx(Ad,{value:"30d",children:"30 derniers jours"}),e.jsx(Ad,{value:"90d",children:"3 derniers mois"}),e.jsx(Ad,{value:"1y",children:"Cette année"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[e.jsx(oc,{className:"card-glow",children:e.jsxs(uc,{className:"p-6",children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Total Projets"}),e.jsx("p",{className:"text-2xl font-bold text-foreground",children:a.totalProjets})]})}),e.jsx(oc,{className:"card-glow",children:e.jsxs(uc,{className:"p-6",children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Total Contrats"}),e.jsx("p",{className:"text-2xl font-bold text-foreground",children:a.totalContrats})]})}),e.jsx(oc,{className:"card-glow",children:e.jsxs(uc,{className:"p-6",children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Projets Convertis"}),e.jsx("p",{className:"text-2xl font-bold text-foreground",children:a.projetsSignes})]})}),e.jsx(oc,{className:"card-glow",children:e.jsxs(uc,{className:"p-6",children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Taux de Conversion"}),e.jsxs("p",{className:"text-2xl font-bold text-foreground",children:[a.tauxConversion.toFixed(1),"%"]})]})})]}),a.statutsDisponibles.length>0&&e.jsxs(oc,{className:"card-glow border-blue-200 bg-blue-50",children:[e.jsx(lc,{children:e.jsx(cc,{className:"text-blue-800",children:"Statuts Disponibles dans vos Données"})}),e.jsx(uc,{children:e.jsx("div",{className:"flex flex-wrap gap-2",children:a.statutsDisponibles.map(t=>e.jsxs("span",{className:"px-3 py-1 bg-blue-100 text-blue-800 rounded-full text-sm",children:[t," (",a.statutCounts[t]||0,")"]},t))})})]}),e.jsxs(oc,{className:"card-glow",children:[e.jsx(lc,{children:e.jsx(cc,{children:"Entonnoir de Conversion"})}),e.jsx(uc,{children:e.jsx(Re,{width:"100%",height:300,children:e.jsxs(He,{children:[e.jsx(Le,{}),e.jsx(Ke,{dataKey:"value",data:a.funnelData,isAnimationActive:!0,children:e.jsx(Ve,{position:"right",fill:"#64748b",stroke:"none",dataKey:"name"})})]})})})]})]})}function Fd({contacts:t=[],projets:r=[],contrats:s=[]}){return e.jsxs(sc,{defaultValue:"revenue",className:"w-full",children:[e.jsxs(nc,{className:"grid w-full grid-cols-3",children:[e.jsx(ac,{value:"revenue",children:"Analyse des Revenus"}),e.jsx(ac,{value:"products",children:"Analyse Produits"}),e.jsx(ac,{value:"pipeline",children:"Analyse du Pipeline"})]}),e.jsx(ic,{value:"revenue",children:e.jsx(Id,{projets:r,contrats:s})}),e.jsx(ic,{value:"products",children:e.jsx($d,{projets:r,contrats:s})}),e.jsx(ic,{value:"pipeline",children:e.jsx(Ld,{projets:r,contrats:s})})]})}W.forwardRef(({className:t,...r},s)=>e.jsx(Ed,{ref:s,className:Na("-mx-1 my-1 h-px bg-muted",t),...r})).displayName=Ed.displayName;const Bd=_a("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function qd({className:t,variant:r,...s}){return e.jsx("div",{className:Na(Bd({variant:r}),t),...s})}const Ud=({stats:t,clients:r,projets:s,contrats:n,segments:a,workflows:i,campaigns:o,aiPredictions:l,interactions:c})=>{const[d,u]=W.useState("commercial"),[h,m]=W.useState(),f=W.useMemo(()=>r,[r]),{contacts:p,projets:v,contrats:g}=W.useMemo(()=>{if(!(null==h?void 0:h.from))return{contacts:f,projets:s,contrats:n};const e=h.from,t=h.to||e;return{contacts:f.filter(r=>{if(!r.created_at)return!1;const s=new Date(r.created_at);return s>=e&&s<=t}),projets:s.filter(r=>{if(!r.date_creation)return!1;const s=new Date(r.date_creation);return s>=e&&s<=t}),contrats:n.filter(r=>{if(!r.contrat_date_creation)return!1;const s=new Date(r.contrat_date_creation);return s>=e&&s<=t})}},[f,s,n,h]),x=25e3*W.useMemo(()=>{if((null==h?void 0:h.from)&&(null==h?void 0:h.to))return 12*(h.to.getFullYear()-h.from.getFullYear())+h.to.getMonth()-h.from.getMonth()+1;const e=[...s.map(e=>e.date_creation?new Date(e.date_creation):null),...n.map(e=>e.contrat_date_creation?new Date(e.contrat_date_creation):null)].filter(e=>e instanceof Date&&!isNaN(e.getTime()));if(e.length<2)return 1;const t=new Date(Math.min(...e.map(e=>e.getTime()))),r=new Date(Math.max(...e.map(e=>e.getTime())));return 12*(r.getFullYear()-t.getFullYear())+r.getMonth()-t.getMonth()+1},[h,s,n]),y=W.useMemo(()=>{const e=p.length,t=v.length,r=g.length,s=t>0?r/t*100:0,n=g.reduce((e,t)=>e+(t.prime_brute_annuelle||0),0),a=g.reduce((e,t)=>e+(t.commissionnement_annee1||0),0),i=v.filter(e=>{var t,r;return"Ne répond pas"!==e.statut&&!(null==(t=e.statut)?void 0:t.toLowerCase().includes("perdu"))&&!(null==(r=e.statut)?void 0:r.toLowerCase().includes("inexploitable"))}),o=t>0?i.length/t*100:0,l=v.filter(e=>{var t;return null==(t=e.statut)?void 0:t.includes("Devis")}).length,c=v.filter(e=>{var t,r;return(null==(t=e.statut)?void 0:t.includes("cours"))||(null==(r=e.statut)?void 0:r.includes("traiter"))}).length,d=["annulé","annule","perdu","refusé","résilié"],u=g.filter(e=>{const t=e.projet_statut||"N/A",r=t.toLowerCase();return!d.some(e=>r.includes(e))&&"N/A"!==t}),h=new Map;u.forEach(e=>{const t=e.commercial||"Non assigné";if("Non assigné"!==t){h.has(t)||h.set(t,{contrats:0,ca:0});const r=h.get(t);r.contrats++,r.ca+=e.prime_brute_annuelle||0}});const m=new Map;v.forEach(e=>{const t=e.commercial||"Non assigné";if("Non assigné"!==t){m.has(t)||m.set(t,{projets:0});m.get(t).projets++}});const f=new Set;for(const p of h.keys())f.add(p);for(const p of m.keys())f.add(p);const y=new Map;f.forEach(e=>{const t=h.get(e)||{contrats:0,ca:0},r=m.get(e)||{projets:0};y.set(e,{projets:r.projets,contrats:t.contrats,ca:t.ca})});const b=Array.from(y.entries()).sort(([,e],[,t])=>t.ca-e.ca).slice(0,5).map(([e,t])=>({commercial:e,stats:t,progressObjectif:Math.min(t.ca/x*100,100),ecartObjectif:t.ca-x})),w=new Map;g.forEach(e=>{const t=e.contrat_produit||"Non spécifié",r=e.contrat_compagnie||"Non spécifiée",s=`${t} - ${r}`;w.has(s)||w.set(s,{count:0,ca:0,produit:t,compagnie:r}),w.get(s).count++,w.get(s).ca+=e.prime_brute_annuelle||0});return{totalContacts:e,totalProjets:t,totalContrats:r,tauxConversion:s,tauxJoinabilite:o,caTotal:n,commissions:a,devisEnvoyes:l,enCours:c,topCommerciaux:b,topProduits:Array.from(w.entries()).sort(([,e],[,t])=>t.ca-e.ca).slice(0,5)}},[p,v,g,x,s]);return e.jsx("div",{className:"space-y-6",children:e.jsxs(sc,{value:d,onValueChange:u,className:"w-full",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-bold text-foreground",children:"Dashboard Commercial"}),e.jsx("p",{className:"text-muted-foreground",children:"KPIs, performances et analyses temps réel"})]}),e.jsx(tc,{date:h,onSelect:m})]}),e.jsxs(nc,{className:"grid w-auto grid-cols-2",children:[e.jsx(ac,{value:"commercial",children:"Performances Commerciales"}),e.jsx(ac,{value:"analytics",children:"Analyses Détaillées"})]})]}),e.jsxs(ic,{value:"commercial",className:"space-y-6",children:[e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4",children:[{title:"Contacts Total",value:y.totalContacts,icon:"fas fa-users",color:"from-blue-500 to-blue-600",change:"+12%"},{title:"Projets",value:y.totalProjets,icon:"fas fa-project-diagram",color:"from-green-500 to-green-600",change:"+8%"},{title:"Contrats Signés",value:y.totalContrats,icon:"fas fa-file-signature",color:"from-purple-500 to-purple-600",change:"+15%"},{title:"Taux Conversion",value:`${y.tauxConversion.toFixed(1)}%`,icon:"fas fa-percentage",color:"from-orange-500 to-orange-600",change:y.tauxConversion>20?"+5%":"-2%"},{title:"Taux Joinabilité",value:`${y.tauxJoinabilite.toFixed(1)}%`,icon:"fas fa-phone",color:"from-pink-500 to-pink-600",change:y.tauxJoinabilite>70?"+3%":"-1%"},{title:"CA Total",value:`€${(y.caTotal/1e3).toFixed(0)}k`,icon:"fas fa-euro-sign",color:"from-emerald-500 to-emerald-600",change:"+22%"}].map((t,r)=>e.jsx(oc,{className:"card-glow",children:e.jsxs(uc,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("div",{className:`w-10 h-10 bg-gradient-to-r ${t.color} rounded-lg flex items-center justify-center`,children:e.jsx("i",{className:`${t.icon} text-white text-sm`})}),e.jsx(qd,{className:t.change.startsWith("+")?"metric-positive":"metric-negative",children:t.change})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-muted-foreground",children:t.title}),e.jsx("p",{className:"text-lg font-bold text-foreground",children:t.value})]})]})},r))}),e.jsxs(oc,{className:"card-glow",children:[e.jsx(lc,{children:e.jsxs(cc,{className:"flex items-center",children:[e.jsx("i",{className:"fas fa-trophy mr-2 text-yellow-600"}),"Top Commerciaux"]})}),e.jsx(uc,{children:e.jsx("div",{className:"space-y-4",children:y.topCommerciaux.map((t,r)=>e.jsxs("div",{className:"p-4 border border-border rounded-lg bg-gradient-to-r from-background to-muted/20",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("div",{className:"w-10 h-10 rounded-full flex items-center justify-center font-bold text-white "+(0===r?"bg-gradient-to-r from-yellow-500 to-yellow-600":1===r?"bg-gradient-to-r from-gray-400 to-gray-500":2===r?"bg-gradient-to-r from-orange-500 to-orange-600":"bg-gradient-to-r from-blue-500 to-blue-600"),children:["#",r+1]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-foreground text-lg",children:t.commercial}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[t.stats.projets," projets • ",t.stats.contrats," contrats"]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-xl font-bold text-primary",children:["€",(t.stats.ca/1e3).toFixed(0),"k"]}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[t.stats.projets>0?(t.stats.contrats/t.stats.projets*100).toFixed(0):t.stats.contrats>0?"N/A":0,"%",t.stats.projets>0?"% conversion":t.stats.contrats>0?" (contrats sans projets)":"% conversion"]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsxs("span",{className:"text-muted-foreground",children:["Objectif: €",(x/1e3).toFixed(0),"k"]}),e.jsxs("span",{className:"font-medium "+(t.ecartObjectif>=0?"text-green-600":"text-orange-600"),children:[t.ecartObjectif>=0?"+":"","€",(t.ecartObjectif/1e3).toFixed(1),"k"]})]}),e.jsx("div",{className:"w-full bg-muted rounded-full h-2",children:e.jsx("div",{className:"h-2 rounded-full transition-all duration-500 "+(t.progressObjectif>=100?"bg-gradient-to-r from-green-500 to-green-600":t.progressObjectif>=75?"bg-gradient-to-r from-blue-500 to-blue-600":"bg-gradient-to-r from-orange-500 to-orange-600"),style:{width:`${Math.min(t.progressObjectif,100)}%`}})}),e.jsxs("div",{className:"text-xs text-muted-foreground text-right",children:[t.progressObjectif.toFixed(1),"% de l'objectif atteint"]})]})]},t.commercial))})})]}),e.jsxs(oc,{className:"card-glow",children:[e.jsx(lc,{children:e.jsxs(cc,{className:"flex items-center",children:[e.jsx("i",{className:"fas fa-chart-pie mr-2 text-primary"}),"Top Produits & Compagnies"]})}),e.jsx(uc,{children:e.jsx("div",{className:"space-y-4",children:y.topProduits.map(([t,r],s)=>e.jsxs("div",{className:"flex items-center justify-between p-3 border border-border rounded-lg",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-foreground",children:r.produit}),e.jsx("p",{className:"text-sm text-muted-foreground",children:r.compagnie})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-lg font-bold text-blue-600",children:["€",(r.ca/1e3).toFixed(0),"k"]}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[r.count," contrats"]})]})]},t))})})]})]}),e.jsx(ic,{value:"analytics",children:e.jsxs("div",{className:"hero-section rounded-2xl p-6",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx(be,{className:"w-16 h-16 mx-auto mb-4 text-blue-600"}),e.jsx("h3",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Analyses Détaillées"}),e.jsx("p",{className:"text-gray-600",children:"Vue approfondie des performances et des insights"})]}),e.jsx(Fd,{contacts:p,projets:v,contrats:g})]})})]})})};function Wd(){const{user:t,loading:r}=jn(),s=H(),[n,a]=W.useState({contacts:[],projets:[],contrats:[],interactions:[],campaigns:[],stats:{totalContacts:0,activeClients:0,prospects:0,totalRevenue:0,conversionRate:"0",avgRevenuePerClient:"0",growthRate:"0",activeCampaigns:0,crossSellOpportunities:0,aiScore:0}}),{contacts:i,projets:o,contrats:l,interactions:c,campaigns:d,stats:u}=n,[h,m]=W.useState(!1);if(W.useEffect(()=>{t&&f()},[t]),W.useEffect(()=>{r||t||s("/login",{replace:!0})},[t,r,s]),!r&&!t)return null;const f=async()=>{if(!h){m(!0);try{const[{data:e,error:t},{data:r,error:s},{data:n,error:i},{data:o,error:l}]=await Promise.all([yn.from("contact").select("*, projets(projet_id)").order("created_at",{ascending:!1}),yn.from("projets").select("*").order("created_at",{ascending:!1}),yn.from("contrats").select("*").order("contrat_date_creation",{ascending:!1}),yn.from("interactions").select("*").order("created_at",{ascending:!1})]);t&&console.error("Error loading contacts:",t),s&&console.error("Error loading projets:",s),i&&console.error("Error loading contrats:",i),l&&console.error("Error loading interactions:",l);const c=(null==e?void 0:e.length)||0,d=(null==e?void 0:e.filter(e=>"active"===e.statut).length)||0,u=(null==e?void 0:e.filter(e=>"prospect"===e.statut).length)||0,h=(null==r?void 0:r.length)||0,m=(null==n?void 0:n.length)||0,f=(null==n?void 0:n.reduce((e,t)=>e+(t.prime_brute_annuelle||0),0))||0,p=h>0?(m/h*100).toFixed(2):"0",v=c>0?(f/c).toFixed(2):"0",g={totalContacts:c,activeClients:d,prospects:u,totalRevenue:f,conversionRate:p,avgRevenuePerClient:v,growthRate:"+5%",activeCampaigns:10,crossSellOpportunities:5,aiScore:75};a({contacts:e||[],projets:r||[],contrats:n||[],interactions:o||[],campaigns:[],stats:g})}catch(e){console.error("Error loading dashboard data:",e),a({contacts:[],projets:[],contrats:[],interactions:[],campaigns:[],stats:{totalContacts:0,activeClients:0,prospects:0,totalRevenue:0,conversionRate:"0",avgRevenuePerClient:"0",growthRate:"0",activeCampaigns:0,crossSellOpportunities:0,aiScore:0}})}finally{m(!1)}}};return e.jsx(Ia,{title:"Dashboard",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-6 py-8",children:[e.jsxs("div",{className:"mb-12",children:[e.jsx("h1",{className:"text-3xl font-light text-slate-900 mb-2",children:"Dashboard"}),e.jsx("p",{className:"text-slate-600 text-base",children:"Vue d'ensemble de votre activité"})]}),e.jsx(Ud,{stats:u,clients:i,projets:o,contrats:l,segments:[],workflows:[],campaigns:d,aiPredictions:[],interactions:c,isLoading:h})]})})}const zd=W.forwardRef(({className:t,type:r,...s},n)=>e.jsx("input",{type:r,className:Na("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",t),ref:n,...s}));zd.displayName="Input";const Hd=$,Kd=L,Vd=W.forwardRef(({className:t,...r},s)=>e.jsx(D,{ref:s,className:Na("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",t),...r}));Vd.displayName=D.displayName;const Jd=W.forwardRef(({className:t,children:r,...s},n)=>e.jsxs(Kd,{children:[e.jsx(Vd,{}),e.jsxs(R,{ref:n,className:Na("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",t),...s,children:[r,e.jsxs(M,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[e.jsx(ee,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));Jd.displayName=R.displayName;const Yd=({className:t,...r})=>e.jsx("div",{className:Na("flex flex-col space-y-1.5 text-center sm:text-left",t),...r});Yd.displayName="DialogHeader";const Gd=W.forwardRef(({className:t,...r},s)=>e.jsx(A,{ref:s,className:Na("text-lg font-semibold leading-none tracking-tight",t),...r}));Gd.displayName=A.displayName;W.forwardRef(({className:t,...r},s)=>e.jsx(I,{ref:s,className:Na("text-sm text-muted-foreground",t),...r})).displayName=I.displayName;var Xd=W.forwardRef((r,s)=>e.jsx(t.label,{...r,ref:s,onMouseDown:e=>{var t;e.target.closest("button, input, select, textarea")||(null==(t=r.onMouseDown)||t.call(r,e),!e.defaultPrevented&&e.detail>1&&e.preventDefault())}}));Xd.displayName="Label";var Qd=Xd;const Zd=_a("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),eu=W.forwardRef(({className:t,...r},s)=>e.jsx(Qd,{ref:s,className:Na(Zd(),t),...r}));eu.displayName=Qd.displayName;const tu=W.forwardRef(({className:t,...r},s)=>e.jsx("textarea",{className:Na("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",t),ref:s,...r}));tu.displayName="Textarea";var ru="Checkbox",[su,nu]=s(ru),[au,iu]=su(ru);function ou(t){const{__scopeCheckbox:r,checked:s,children:n,defaultChecked:a,disabled:o,form:l,name:c,onCheckedChange:d,required:u,value:h="on",internal_do_not_use_render:m}=t,[f,p]=i({prop:s,defaultProp:a??!1,onChange:d,caller:ru}),[v,g]=W.useState(null),[x,y]=W.useState(null),b=W.useRef(!1),w=!v||(!!l||!!v.closest("form")),j={checked:f,disabled:o,setChecked:p,control:v,setControl:g,name:c,form:l,value:h,hasConsumerStoppedPropagationRef:b,required:u,defaultChecked:!vu(a)&&a,isFormControl:w,bubbleInput:x,setBubbleInput:y};return e.jsx(au,{scope:r,...j,children:pu(m)?m(j):n})}var lu="CheckboxTrigger",cu=W.forwardRef(({__scopeCheckbox:r,onKeyDown:s,onClick:a,...i},o)=>{const{control:l,value:d,disabled:u,checked:h,required:m,setControl:f,setChecked:p,hasConsumerStoppedPropagationRef:v,isFormControl:g,bubbleInput:x}=iu(lu,r),y=n(o,f),b=W.useRef(h);return W.useEffect(()=>{const e=null==l?void 0:l.form;if(e){const t=()=>p(b.current);return e.addEventListener("reset",t),()=>e.removeEventListener("reset",t)}},[l,p]),e.jsx(t.button,{type:"button",role:"checkbox","aria-checked":vu(h)?"mixed":h,"aria-required":m,"data-state":gu(h),"data-disabled":u?"":void 0,disabled:u,value:d,...i,ref:y,onKeyDown:c(s,e=>{"Enter"===e.key&&e.preventDefault()}),onClick:c(a,e=>{p(e=>!!vu(e)||!e),x&&g&&(v.current=e.isPropagationStopped(),v.current||e.stopPropagation())})})});cu.displayName=lu;var du=W.forwardRef((t,r)=>{const{__scopeCheckbox:s,name:n,checked:a,defaultChecked:i,required:o,disabled:l,value:c,onCheckedChange:d,form:u,...h}=t;return e.jsx(ou,{__scopeCheckbox:s,checked:a,defaultChecked:i,disabled:l,required:o,onCheckedChange:d,name:n,form:u,value:c,internal_do_not_use_render:({isFormControl:t})=>e.jsxs(e.Fragment,{children:[e.jsx(cu,{...h,ref:r,__scopeCheckbox:s}),t&&e.jsx(fu,{__scopeCheckbox:s})]})})});du.displayName=ru;var uu="CheckboxIndicator",hu=W.forwardRef((r,s)=>{const{__scopeCheckbox:n,forceMount:a,...i}=r,l=iu(uu,n);return e.jsx(o,{present:a||vu(l.checked)||!0===l.checked,children:e.jsx(t.span,{"data-state":gu(l.checked),"data-disabled":l.disabled?"":void 0,...i,ref:s,style:{pointerEvents:"none",...r.style}})})});hu.displayName=uu;var mu="CheckboxBubbleInput",fu=W.forwardRef(({__scopeCheckbox:r,...s},a)=>{const{control:i,hasConsumerStoppedPropagationRef:o,checked:l,defaultChecked:c,required:d,disabled:u,name:h,value:m,form:f,bubbleInput:p,setBubbleInput:v}=iu(mu,r),g=n(a,v),x=mc(l),y=F(i);W.useEffect(()=>{const e=p;if(!e)return;const t=window.HTMLInputElement.prototype,r=Object.getOwnPropertyDescriptor(t,"checked").set,s=!o.current;if(x!==l&&r){const t=new Event("click",{bubbles:s});e.indeterminate=vu(l),r.call(e,!vu(l)&&l),e.dispatchEvent(t)}},[p,x,l,o]);const b=W.useRef(!vu(l)&&l);return e.jsx(t.input,{type:"checkbox","aria-hidden":!0,defaultChecked:c??b.current,required:d,disabled:u,name:h,value:m,form:f,...s,tabIndex:-1,ref:g,style:{...s.style,...y,position:"absolute",pointerEvents:"none",opacity:0,margin:0,transform:"translateX(-100%)"}})});function pu(e){return"function"==typeof e}function vu(e){return"indeterminate"===e}function gu(e){return vu(e)?"indeterminate":e?"checked":"unchecked"}fu.displayName=mu;const xu=W.forwardRef(({className:t,...r},s)=>e.jsx(du,{ref:s,className:Na("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",t),...r,children:e.jsx(hu,{className:Na("flex items-center justify-center text-current"),children:e.jsx(ye,{className:"h-4 w-4"})})}));xu.displayName=du.displayName;var yu=Object.defineProperty,bu=(e,t,r)=>((e,t,r)=>t in e?yu(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r)(e,"symbol"!=typeof t?t+"":t,r);const wu="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";wu.startsWith("xkeysib-test-key");const ju=new class{constructor(e=wu){bu(this,"apiKey"),bu(this,"baseUrl"),this.apiKey=e,this.baseUrl="https://api.brevo.com/v3"}async makeBrevoRequest(e,t="GET",r){try{this.baseUrl;const s=await fetch(`${this.baseUrl}${e}`,{method:t,headers:{"api-key":this.apiKey,"Content-Type":"application/json",Accept:"application/json"},body:r?JSON.stringify(r):void 0});if(!s.ok){const e=await s.text();let t;try{t=JSON.parse(e)}catch{t={message:e}}throw console.error(`❌ Brevo API Error ${s.status}:`,t),new Error(`Brevo API Error ${s.status}: ${t.message||s.statusText}`)}const n=await s.json();return Object.keys(n).join(", "),n}catch(s){throw console.error("❌ Brevo API Request Failed:",s),s}}async getAggregatedEmailStats(e,t){try{let r="/smtp/statistics/aggregatedReport";const s=new URLSearchParams;e&&s.append("startDate",e),t&&s.append("endDate",t),s.toString()&&(r+="?"+s.toString());const n=await this.makeBrevoRequest(r);return n.requests,n.delivered,n.uniqueOpens||n.opened,n.uniqueClicks||n.clicked,{requests:n.requests||0,delivered:n.delivered||0,hardBounces:n.hardBounces||0,softBounces:n.softBounces||0,complaints:n.complaints||0,unsubscriptions:n.unsubscriptions||0,opened:n.uniqueOpens||n.opened||0,clicked:n.uniqueClicks||n.clicked||0,invalid:n.invalid||0,deferred:n.deferred||0}}catch(r){throw console.error("❌ Failed to get aggregated email stats:",r),r}}async getEmailEvents(e,t,r,s=100){var n;try{const a=new URLSearchParams;e&&a.append("email",e),t&&a.append("startDate",t),r&&a.append("endDate",r),a.append("limit",s.toString()),a.append("offset","0");const i="/smtp/statistics/events?"+a.toString(),o=await this.makeBrevoRequest(i);return null==(n=o.events)||n.length,o.events||[]}catch(a){return console.error("❌ Failed to get email events:",a),[]}}async getCampaigns(e=50,t=0){var r;try{const s=`/emailCampaigns?limit=${e}&offset=${t}`,n=await this.makeBrevoRequest(s);return null==(r=n.campaigns)||r.length,n.campaigns||[]}catch(s){return console.error("❌ Failed to get campaigns:",s),[]}}async getCampaignStatistics(e){try{return await this.makeBrevoRequest(`/emailCampaigns/${e}`)}catch(t){return console.error(`❌ Failed to get campaign ${e} statistics:`,t),null}}async syncEmailDataWithBrevo(){const e=[];let t=0;try{const s=await this.getAggregatedEmailStats(),n=new Date;n.setDate(n.getDate()-30);const a=await this.getEmailEvents(void 0,n.toISOString().split("T")[0],(new Date).toISOString().split("T")[0],1e3);a.length;for(const i of a)try{await this.processEmailEvent(i),t++}catch(r){e.push(`Event processing error for ${i.email}: ${r}`),console.error("❌ Event processing error:",r)}return await this.updateGlobalEmailStats(s),e.length,{success:!0,updated:t,errors:e,stats:s}}catch(r){return console.error("❌ Brevo sync failed:",r),{success:!1,updated:t,errors:[...e,`Global sync error: ${r}`],stats:{requests:0,delivered:0,hardBounces:0,softBounces:0,complaints:0,unsubscriptions:0,opened:0,clicked:0,invalid:0,deferred:0}}}}async processEmailEvent(e){var t,r;try{const{data:n}=await yn.from("contact").select("identifiant").eq("email",e.email).single();if(!n)return void e.email;let{data:a,error:i}=await yn.from("envois_email").select("id").eq("email_destinataire",e.email).eq("contact_id",n.identifiant).order("created_at",{ascending:!1}).limit(1).single();if(i&&"PGRST116"!==i.code)return void console.error("❌ Error finding email record:",i);if(a){const t={statut:this.mapBrevoEventToStatus(e.event),brevo_message_id:e["message-id"],brevo_smtp_id:null==(r=e["smtp-id"])?void 0:r.toString()};"opened"!==e.event||a.date_ouverture||(t.date_ouverture=new Date(1e3*e.ts).toISOString()),"click"!==e.event||a.date_clic||(t.date_clic=new Date(1e3*e.ts).toISOString()),this.isErrorEvent(e.event)&&e.reason&&(t.erreur_message=e.reason);const{error:s}=await yn.from("envois_email").update(t).eq("id",a.id);if(s)return void console.error("❌ Error updating email record:",s);e.email,e.event}else try{n.identifiant,e.email,this.mapBrevoEventToStatus(e.event),e.ts,e["message-id"];const{data:r,error:s}=await yn.from("envois_email").insert({campagne_id:null,contact_id:n.identifiant,projet_id:null,destinataire:e.email,sujet:e.subject||"Email Brevo",statut:this.mapBrevoEventToStatus(e.event),date_envoi:new Date(1e3*e.ts).toISOString(),date_ouverture:"opened"===e.event?new Date(1e3*e.ts).toISOString():null,date_clic:"click"===e.event?new Date(1e3*e.ts).toISOString():null,erreur_message:this.isErrorEvent(e.event)?e.reason:null,brevo_message_id:e["message-id"],brevo_smtp_id:null==(t=e["smtp-id"])?void 0:t.toString(),contenu_html:"",contenu_texte:""}).select().single();if(s)return console.error("❌ Error creating email record:",s),void console.error("🔍 DEBUG: Details erreur création:",{code:s.code,message:s.message,details:s.details,hint:s.hint});a=r,e.email,r.id}catch(s){console.error("💥 Erreur inattendue création email:",s)}}catch(n){throw console.error(`❌ Error processing email event for ${e.email}:`,n),n}}async updateGlobalEmailStats(e){try{const{error:t}=await yn.from("email_stats_global").upsert({id:1,total_requests:e.requests,total_delivered:e.delivered,total_opened:e.opened,total_clicked:e.clicked,total_hard_bounces:e.hardBounces,total_soft_bounces:e.softBounces,total_complaints:e.complaints,total_unsubscriptions:e.unsubscriptions,total_invalid:e.invalid,total_deferred:e.deferred,open_rate:e.delivered>0?e.opened/e.delivered*100:0,click_rate:e.delivered>0?e.clicked/e.delivered*100:0,bounce_rate:e.requests>0?(e.hardBounces+e.softBounces)/e.requests*100:0,last_sync:(new Date).toISOString()});t&&console.error("❌ Error updating global email stats:",t)}catch(t){console.error("❌ Failed to update global email stats:",t)}}mapBrevoEventToStatus(e){switch(e){case"delivered":return"delivre";case"request":return"envoye";case"opened":return"ouvert";case"click":return"clic";case"hard_bounce":case"soft_bounce":return"bounce";case"complaint":return"plainte";case"unsubscribed":return"desabonne";case"invalid_email":return"invalide";case"deferred":return"differe";default:return"inconnu"}}isErrorEvent(e){return["hard_bounce","soft_bounce","complaint","invalid_email"].includes(e)}async syncProjectEmailHistory(e){try{const{data:t,error:r}=await yn.from("envois_email").select("\n          id,\n          email_destinataire,\n          date_envoi,\n          statut,\n          brevo_message_id,\n          contact_id,\n          projet_id\n        ").eq("projet_id",e);if(r)throw r;null==t||t.length;const s=[];for(const e of t||[])if(e.destinataire){const t=await this.getEmailEvents(e.destinataire,void 0,void 0,10),r=t[0];if(r){const t=this.mapBrevoEventToStatus(r.event);t!==e.statut&&(await yn.from("envois_email").update({statut:t,brevo_message_id:r["message-id"]}).eq("id",e.id),e.statut=t)}s.push({...e,brevo_events:t,latest_brevo_status:r?this.mapBrevoEventToStatus(r.event):null})}return{success:!0,emails:s}}catch(t){return console.error(`❌ Project ${e} sync failed:`,t),{success:!1,emails:[],error:t instanceof Error?t.message:"Unknown error"}}}async syncEmailDataWithCRM(){const e=[];let t=0;try{const s=await this.getAggregatedEmailStats(),n=new Date;n.setDate(n.getDate()-30);const a=await this.getEmailEvents(void 0,n.toISOString().split("T")[0],(new Date).toISOString().split("T")[0],1e3);a.length;for(const i of a)try{await this.processEmailEvent(i),t++}catch(r){const t=`Erreur traitement événement ${i.email}: ${r.message}`;e.push(t),console.error(`❌ ${t}`,r)}return await this.updateGlobalEmailStats(s),e.length,{success:!0,updated:t,errors:e,message:`Synchronisation terminée: ${t} événements traités, ${e.length} erreurs`}}catch(r){return console.error("❌ Sync CRM échouée:",r),{success:!1,updated:t,errors:[...e,`Erreur globale: ${r.message}`],message:`Échec de la synchronisation: ${r.message}`}}}async testBrevoConnection(){const e={api_key_format:!1,api_endpoint_reachable:!1,account_info:null,rate_limit:null};try{e.api_key_format=this.apiKey.startsWith("xkeysib-")&&this.apiKey.length>20;const t=await this.makeBrevoRequest("/account");return e.api_endpoint_reachable=!0,e.account_info={company_name:t.companyName,email:t.email,first_name:t.firstName,last_name:t.lastName},{success:!0,account:t,diagnostics:e}}catch(t){return console.error("❌ Brevo connection test failed:",t),{success:!1,error:t instanceof Error?t.message:"Connection failed",diagnostics:e}}}},_u=e=>({totalSent:e.requests,delivered:e.delivered,opened:e.opened,clicked:e.clicked,bounced:e.hardBounces+e.softBounces,openRate:e.delivered>0?Math.round(e.opened/e.delivered*100*100)/100:0,clickRate:e.delivered>0?Math.round(e.clicked/e.delivered*100*100)/100:0,bounceRate:e.requests>0?Math.round((e.hardBounces+e.softBounces)/e.requests*100*100)/100:0});function Nu(){var t,r;const s=H(),{toast:n}=Dn(),[a,i]=W.useState([]),[o,l]=W.useState([]),[c,d]=W.useState(""),[u,h]=W.useState("all"),[m,f]=W.useState("all"),[p,v]=W.useState([]),[g,x]=W.useState([]),[y,b]=W.useState(new Set),[w,j]=W.useState(!0),[_,N]=W.useState(1),[k,S]=W.useState(20),[C,E]=W.useState("all"),[T,P]=W.useState("all"),[O,D]=W.useState("default"),[R,M]=W.useState(!1),[A,I]=W.useState(!1),[$,L]=W.useState(!1),[F,B]=W.useState(!1),[q,U]=W.useState(!1),[z,K]=W.useState(!1),[V,J]=W.useState([]),[Y,G]=W.useState(null),[X,Q]=W.useState({totalSent:0,delivered:0,opened:0,clicked:0,bounced:0,openRate:0,clickRate:0,bounceRate:0}),[Z,ee]=W.useState(!0),[te,re]=W.useState(new Map),[se,ne]=W.useState(!1),[ie,oe]=W.useState({templateId:"",subject:"",content:"",useCustomContent:!1}),[le,de]=W.useState({dateProposee:"",message:""}),he=async()=>{try{const{data:e,error:t}=await yn.from("envois_email").select("contact_id").not("contact_id","is",null);if(t)throw t;const r=new Map;null==e||e.forEach(e=>{e.contact_id&&r.set(e.contact_id,(r.get(e.contact_id)||0)+1)}),re(r)}catch(e){console.error("Error loading contact email counts:",e),re(new Map)}};W.useEffect(()=>{(async()=>{await fe(),await ge(),await xe(),await ye(),await he()})()},[]);const fe=async()=>{try{j(!0);const{data:e,error:t}=await yn.from("projets").select("\n          *,\n          contact:contact_id (\n            identifiant,\n            prenom,\n            nom,\n            email,\n            civilite\n          )\n        ").order("created_at",{ascending:!1});if(t)throw t;let r=e||[],s=0,a=0;r=r.filter(e=>{let t=!1;const r=[];return e.projet_id||(r.push("ID projet manquant"),t=!0),e.contact?e.contact.email||(r.push("Email contact manquant"),s++):(r.push("Contact manquant"),t=!0),e.contact_id&&e.contact&&e.contact_id!==e.contact.identifiant&&(r.push("Incohérence contact_id"),a++),t?(e.projet_id,r.join(", "),a++,!1):(e.contact.email||(e.projet_id,e.contact.prenom,e.contact.nom),!0)}),null==e||e.length,r.length,s>0&&n({title:"Informations sur les projets",description:`${s} projets sans email affichés - vérifiez manuellement si nécessaire`,variant:"default"}),i(r)}catch(e){console.error("Error loading projects:",e),n({title:"Erreur",description:"Impossible de charger les projets",variant:"destructive"})}finally{j(!1)}},ge=async()=>{try{const{data:e,error:t}=await yn.from("projets").select("statut, commercial").not("statut","is",null).not("commercial","is",null);if(t)throw t;const r=[...new Set(null==e?void 0:e.map(e=>e.statut).filter(Boolean))],s=[...new Set(null==e?void 0:e.map(e=>e.commercial).filter(Boolean))];v(r.sort()),x(s.sort())}catch(e){console.error("Error loading filters:",e)}},xe=async()=>{try{const{data:e,error:t}=await yn.from("email_templates").select("id, nom, sujet, contenu_html, contenu_texte").eq("statut","active").order("nom");if(t)throw t;l(e||[])}catch(e){console.error("Error loading templates:",e)}},ye=async()=>{try{ee(!0);const{data:e,error:t}=await yn.from("envois_email").select("statut, date_envoi, date_ouverture, date_clic, projet_id").order("created_at",{ascending:!1});if(t)throw t;const r=(null==e?void 0:e.filter(e=>e.projet_id))||[],s=r.length,n=r.filter(e=>"delivre"===e.statut||"envoye"===e.statut).length,a=r.filter(e=>e.date_ouverture).length,i=r.filter(e=>e.date_clic).length,o=r.filter(e=>"echec"===e.statut||"bounce"===e.statut).length,l=s>0?Math.round(a/s*100*100)/100:0,c=s>0?Math.round(i/s*100*100)/100:0,d=s>0?Math.round(o/s*100*100)/100:0;null==e||e.length,r.length,Q({totalSent:s,delivered:n,opened:a,clicked:i,bounced:o,openRate:l,clickRate:c,bounceRate:d})}catch(e){console.error("Error loading email stats:",e),Q({totalSent:0,delivered:0,opened:0,clicked:0,bounced:0,openRate:0,clickRate:0,bounceRate:0})}finally{ee(!1)}},be=W.useMemo(()=>{let e=a.filter(e=>{var t,r,s,n,a,i,o,l,d;const h=!c||(null==(r=null==(t=e.contact)?void 0:t.prenom)?void 0:r.toLowerCase().includes(c.toLowerCase()))||(null==(n=null==(s=e.contact)?void 0:s.nom)?void 0:n.toLowerCase().includes(c.toLowerCase()))||(null==(a=e.commercial)?void 0:a.toLowerCase().includes(c.toLowerCase()))||(null==(i=e.origine)?void 0:i.toLowerCase().includes(c.toLowerCase()))||e.projet_id.toString().includes(c.toLowerCase()),f="all"===u||(null==(o=e.statut)?void 0:o.toLowerCase().includes(u.toLowerCase())),p="all"===m||e.commercial===m,v="all"===C||"contacted"===C&&(null==(l=e.contact)?void 0:l.email)||"not_contacted"===C&&!(null==(d=e.contact)?void 0:d.email),g=(()=>{var t;if("all"===T)return!0;if(!(null==(t=e.contact)?void 0:t.identifiant))return"never"===T;const r=te.get(e.contact.identifiant)||0;switch(T){case"never":return 0===r;case"1-2":return r>=1&&r<=2;case"3-5":return r>=3&&r<=5;case"5+":return r>=5;default:return!0}})();return h&&f&&p&&v&&g});return"default"!==O&&(e=[...e].sort((e,t)=>{switch(O){case"date_desc":return new Date(t.date_creation).getTime()-new Date(e.date_creation).getTime();case"date_asc":return new Date(e.date_creation).getTime()-new Date(t.date_creation).getTime();default:return 0}})),e},[a,c,u,m,C,T,te,O]),Re=Math.ceil(be.length/k),Me=(_-1)*k,Ae=be.slice(Me,Me+k),Ie=()=>Ae.filter(e=>y.has(e.projet_id)).map(e=>{var t,r,s,n,a,i;return{projectId:e.projet_id,contactId:null==(t=e.contact)?void 0:t.identifiant,email:(null==(r=e.contact)?void 0:r.email)||"",prenom:(null==(s=e.contact)?void 0:s.prenom)||"",nom:(null==(n=e.contact)?void 0:n.nom)||"",civilite:(null==(a=e.contact)?void 0:a.civilite)||"",commercial:e.commercial||"",hasEmail:!!(null==(i=e.contact)?void 0:i.email)}}),$e=(e,t)=>e.replace(/{{nom_client}}/g,`${t.prenom} ${t.nom}`).replace(/{{prenom}}/g,t.prenom).replace(/{{nom}}/g,t.nom).replace(/{{nom_commercial}}/g,t.commercial).replace(/{{lien_rdv}}/g,t.lien_rdv||"#").replace(/{{infos_premunia}}/g,"\n        📞 Contactez-nous :\n        Téléphone : 01 23 45 67 89\n        Email : info@premunia.com\n        Disponible du lundi au vendredi, 9h-18h\n      "),Le=e=>{const t=[];return e.projectId||t.push(`Projet ID manquant pour ${e.email}`),e.contactId||t.push(`Contact ID manquant pour ${e.email}`),e.email&&e.email.includes("@")||t.push(`Email invalide: ${e.email}`),t},Fe=e=>{const t=null==e?void 0:e.toLowerCase();switch(!0){case(null==t?void 0:t.includes("ne repond pas"))||(null==t?void 0:t.includes("ne répond pas")):return"bg-orange-100 text-orange-800 dark:bg-orange-900 dark:text-orange-200";case null==t?void 0:t.includes("en cours"):return"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200";case null==t?void 0:t.includes("devis envoyé"):return"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200";case null==t?void 0:t.includes("contrat"):return"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200";default:return"bg-gray-100 text-gray-800 dark:bg-gray-800 dark:text-gray-200"}};return w?e.jsx("div",{className:"flex justify-center items-center p-12",children:e.jsx(we,{className:"h-8 w-8 animate-spin text-primary"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex justify-between items-center",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Gestion des Projets"}),e.jsxs("p",{className:"text-muted-foreground mt-2",children:[be.length," projets • ",y.size," sélectionnés"]})]})}),e.jsx(oc,{children:e.jsxs(uc,{className:"p-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-7 gap-4 mb-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(je,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(zd,{placeholder:"Rechercher...",value:c,onChange:e=>d(e.target.value),className:"pl-10"})]}),e.jsxs(Td,{value:u,onValueChange:h,children:[e.jsx(Od,{children:e.jsx(Pd,{placeholder:"Statut"})}),e.jsxs(Md,{children:[e.jsx(Ad,{value:"all",children:"Tous les statuts"}),e.jsx(Ad,{value:"ne repond pas",children:"Ne répond pas"}),e.jsx(Ad,{value:"en cours",children:"En cours"}),e.jsx(Ad,{value:"devis envoyé",children:"Devis envoyé"}),e.jsx(Ad,{value:"contrat",children:"Contrat signé"}),p.map(t=>e.jsx(Ad,{value:t,children:t},t))]})]}),e.jsxs(Td,{value:m,onValueChange:f,children:[e.jsx(Od,{children:e.jsx(Pd,{placeholder:"Commercial"})}),e.jsxs(Md,{children:[e.jsx(Ad,{value:"all",children:"Tous les commerciaux"}),g.map(t=>e.jsx(Ad,{value:t,children:t},t))]})]}),e.jsxs(Td,{value:C,onValueChange:E,children:[e.jsx(Od,{children:e.jsx(Pd,{placeholder:"Contact"})}),e.jsxs(Md,{children:[e.jsx(Ad,{value:"all",children:"Tous les contacts"}),e.jsx(Ad,{value:"contacted",children:"Contactés"}),e.jsx(Ad,{value:"not_contacted",children:"Non contactés"})]})]}),e.jsxs(Td,{value:T,onValueChange:P,children:[e.jsx(Od,{children:e.jsx(Pd,{placeholder:"Fréquence"})}),e.jsxs(Md,{children:[e.jsx(Ad,{value:"all",children:"Toutes fréquences"}),e.jsx(Ad,{value:"never",children:"Jamais contacté"}),e.jsx(Ad,{value:"1-2",children:"1-2 fois"}),e.jsx(Ad,{value:"3-5",children:"3-5 fois"}),e.jsx(Ad,{value:"5+",children:"Plus de 5 fois"})]})]}),e.jsxs(Td,{value:O,onValueChange:D,children:[e.jsx(Od,{children:e.jsx(Pd,{placeholder:"Trier par"})}),e.jsxs(Md,{children:[e.jsx(Ad,{value:"default",children:"Par défaut"}),e.jsx(Ad,{value:"date_desc",children:"📅 Date ↓ (Récent → Ancien)"}),e.jsx(Ad,{value:"date_asc",children:"📅 Date ↑ (Ancien → Récent)"})]})]}),e.jsx("div",{className:"flex gap-2",children:e.jsxs(Ma,{variant:"outline",onClick:()=>{d(""),h("all"),f("all"),E("all"),P("all"),D("default"),N(1)},children:[e.jsx(_e,{className:"h-4 w-4 mr-2"}),"Réinitialiser"]})})]}),e.jsx("div",{className:"flex items-center justify-between mt-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Éléments par page:"}),e.jsxs(Td,{value:k.toString(),onValueChange:e=>{S(parseInt(e)),N(1)},children:[e.jsx(Od,{className:"w-20",children:e.jsx(Pd,{})}),e.jsxs(Md,{children:[e.jsx(Ad,{value:"25",children:"25"}),e.jsx(Ad,{value:"50",children:"50"}),e.jsx(Ad,{value:"100",children:"100"}),e.jsx(Ad,{value:"200",children:"200"})]})]})]})})]})}),e.jsxs(oc,{children:[e.jsx(lc,{children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs(cc,{className:"flex items-center gap-2",children:[e.jsx(ce,{className:"h-5 w-5"}),"Statistiques Email"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(Ma,{variant:"outline",size:"sm",onClick:async()=>{ne(!0);try{const e=await ju.getAggregatedEmailStats(),t=_u(e);Q({totalSent:t.totalSent,delivered:t.delivered,opened:t.opened,clicked:t.clicked,bounced:t.bounced,openRate:t.openRate,clickRate:t.clickRate,bounceRate:t.bounceRate}),await ju.syncEmailDataWithCRM(),n({title:"Synchronisation Brevo complétée",description:"Les statistiques et données emails ont été mises à jour depuis l'API Brevo."}),await ye(),await he()}catch(e){console.error("Erreur lors de la synchronisation Brevo:",e),n({title:"Erreur de synchronisation",description:e.message||"Impossible de synchroniser avec Brevo",variant:"destructive"})}finally{ne(!1)}},disabled:se,className:"gap-2",title:"Synchroniser les données avec l'API Brevo",children:[se?e.jsx(we,{className:"h-4 w-4 animate-spin"}):e.jsx(Ne,{className:"h-4 w-4"}),se?"Synchronisation...":"Sync Brevo"]}),e.jsx(Ma,{variant:"ghost",size:"sm",onClick:ye,disabled:Z,title:"Actualiser les statistiques locales",children:e.jsx(ue,{className:"h-4 w-4"})})]})]})}),e.jsxs(uc,{children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4",children:[e.jsxs("div",{className:"text-center p-4 bg-blue-50 rounded-lg border border-blue-200",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:Z?e.jsx(we,{className:"h-6 w-6 animate-spin mx-auto"}):X.totalSent.toLocaleString()}),e.jsx("div",{className:"text-sm text-blue-700 mt-1",children:"Total envoyés"}),e.jsx("div",{className:"text-xs text-blue-600",children:Z?"Chargement...":"Tous les emails"})]}),e.jsxs("div",{className:"text-center p-4 bg-green-50 rounded-lg border border-green-200",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:Z?e.jsx(we,{className:"h-6 w-6 animate-spin mx-auto"}):X.delivered.toLocaleString()}),e.jsx("div",{className:"text-sm text-green-700 mt-1",children:"Délivrés"}),e.jsx("div",{className:"text-xs text-green-600",children:Z?"Chargement...":`${X.totalSent>0?Math.round(X.delivered/X.totalSent*100):0}% du total`})]}),e.jsxs("div",{className:"text-center p-4 bg-blue-50 rounded-lg border border-blue-200",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:Z?e.jsx(we,{className:"h-6 w-6 animate-spin mx-auto"}):X.opened.toLocaleString()}),e.jsx("div",{className:"text-sm text-blue-700 mt-1",children:"Ouverts"}),e.jsx("div",{className:"text-xs text-blue-600",children:Z?"Chargement...":`${X.openRate}% d'ouverture`})]}),e.jsxs("div",{className:"text-center p-4 bg-purple-50 rounded-lg border border-purple-200",children:[e.jsx("div",{className:"text-2xl font-bold text-purple-600",children:Z?e.jsx(we,{className:"h-6 w-6 animate-spin mx-auto"}):X.clicked.toLocaleString()}),e.jsx("div",{className:"text-sm text-purple-700 mt-1",children:"Clics"}),e.jsx("div",{className:"text-xs text-purple-600",children:Z?"Chargement...":`${X.clickRate}% de clics`})]}),e.jsxs("div",{className:"text-center p-4 bg-red-50 rounded-lg border border-red-200",children:[e.jsx("div",{className:"text-2xl font-bold text-red-600",children:Z?e.jsx(we,{className:"h-6 w-6 animate-spin mx-auto"}):X.bounced.toLocaleString()}),e.jsx("div",{className:"text-sm text-red-700 mt-1",children:"Rebonds"}),e.jsx("div",{className:"text-xs text-red-600",children:Z?"Chargement...":`${X.bounceRate}% de rebonds`})]})]}),e.jsxs("div",{className:"mt-4 p-3 bg-muted rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Taux d'ouverture:"}),e.jsx("span",{className:"font-medium",children:Z?"--":`${X.openRate}%`})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm mt-1",children:[e.jsx("span",{className:"text-muted-foreground",children:"Taux de clic:"}),e.jsx("span",{className:"font-medium",children:Z?"--":`${X.clickRate}%`})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm mt-1",children:[e.jsx("span",{className:"text-muted-foreground",children:"Taux de rebond:"}),e.jsx("span",{className:"font-medium",children:Z?"--":`${X.bounceRate}%`})]})]})]})]}),y.size>0&&e.jsx(oc,{className:"border-primary/20 bg-primary/5",children:e.jsx(uc,{className:"p-4",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"text-sm font-medium",children:[y.size," projet",y.size>1?"s":""," sélectionné",y.size>1?"s":""]}),e.jsxs("div",{className:"flex gap-2",children:[(()=>{const t=Ie().filter(e=>e.hasEmail),r=Ie().length;return e.jsxs(Ma,{onClick:()=>M(!0),className:"gap-2",disabled:0===t.length,title:t.length===r?`${t.length} projets avec email`:`${t.length}/${r} projets peuvent recevoir un email`,children:[e.jsx(ke,{className:"h-4 w-4"}),"Envoyer Email Groupé (",t.length,")",r!==t.length&&e.jsxs("span",{className:"text-xs opacity-70",children:["/",r]})]})})(),e.jsxs(Ma,{variant:"outline",onClick:()=>I(!0),className:"gap-2",children:[e.jsx(Se,{className:"h-4 w-4"}),"Proposer RDV"]})]})]})})}),e.jsxs(oc,{children:[e.jsx(lc,{children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs(cc,{className:"flex items-center gap-2",children:[e.jsx(Ce,{className:"h-5 w-5"}),"Projets CRM"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(xu,{checked:y.size===Ae.length&&Ae.length>0,onCheckedChange:()=>{y.size===Ae.length?b(new Set):b(new Set(Ae.map(e=>e.projet_id)))}}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Tout sélectionner (",Ae.length,")"]})]})]})}),e.jsxs(uc,{children:[e.jsx("div",{className:"design-card design-border rounded-lg p-4 mb-6",children:e.jsxs("div",{className:"grid grid-cols-6 gap-4 font-medium text-sm text-muted-foreground",children:[e.jsxs("div",{className:"flex items-center gap-2 cursor-pointer hover:text-primary transition-colors duration-200",onClick:()=>{D("date_desc"===O?"date_asc":"date_asc"===O?"default":"date_desc")},children:[e.jsx(ve,{className:"h-4 w-4"}),e.jsx("span",{children:"Date & ID"}),"date_desc"===O&&e.jsx(pe,{className:"h-3 w-3"}),"date_asc"===O&&e.jsx(ae,{className:"h-3 w-3"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ee,{className:"h-4 w-4"}),e.jsx("span",{children:"Contact"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(me,{className:"h-4 w-4"}),e.jsx("span",{children:"Statut"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ce,{className:"h-4 w-4"}),e.jsx("span",{children:"Commercial"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ce,{className:"h-4 w-4"}),e.jsx("span",{children:"Email & Contact"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Te,{className:"h-4 w-4"}),e.jsx("span",{children:"Actions"})]})]})}),e.jsx("div",{className:"space-y-4",children:Ae.map(t=>{var r,a,i,o,l;const c=(null==(r=t.contact)?void 0:r.identifiant)&&te.get(t.contact.identifiant)||0;return e.jsx("div",{className:"bg-white border border-gray-200 rounded-xl p-6 hover:shadow-md transition-all duration-300",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx(xu,{checked:y.has(t.projet_id),onCheckedChange:()=>(e=>{const t=new Set(y);t.has(e)?t.delete(e):t.add(e),b(t)})(t.projet_id),className:"mt-1"}),e.jsxs("div",{className:"flex-1 grid grid-cols-1 lg:grid-cols-6 gap-6 items-start",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"text-sm font-semibold text-foreground",children:new Date(t.date_creation).toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"2-digit"})}),e.jsxs("div",{className:"text-xs text-muted-foreground font-mono",children:["#",t.projet_id]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"font-semibold text-foreground flex items-center gap-2",children:[e.jsx(Ee,{className:"h-4 w-4 text-primary"}),null==(a=t.contact)?void 0:a.prenom," ",null==(i=t.contact)?void 0:i.nom,!(null==(o=t.contact)?void 0:o.email)&&e.jsx(Pe,{className:"h-4 w-4 text-orange-500","aria-label":"Pas d'adresse email"})]}),e.jsx("div",{className:"text-sm",children:(null==(l=t.contact)?void 0:l.email)?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ce,{className:"h-3 w-3 text-green-600"}),e.jsx("span",{className:"text-green-600 truncate",children:t.contact.email})]}):e.jsxs("div",{className:"flex items-center gap-2 text-orange-600",children:[e.jsx(Pe,{className:"h-3 w-3"}),e.jsx("span",{className:"text-xs",children:"Email manquant"})]})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(qd,{className:`${Fe(t.statut)} px-3 py-1 text-xs font-medium`,children:t.statut}),e.jsx("div",{className:"text-xs text-muted-foreground",children:t.origine&&`Origine: ${t.origine}`})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ce,{className:"h-4 w-4 text-primary"}),e.jsx("span",{className:"text-sm font-medium text-foreground",children:t.commercial})]}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Responsable"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ce,{className:"h-4 w-4 text-primary"}),e.jsx("span",{className:"text-sm font-medium",children:c}),e.jsx("span",{className:"text-xs text-muted-foreground",children:"emails envoyés"})]}),e.jsx("div",{className:"text-xs text-muted-foreground",children:0===c?"Pas encore contacté":1===c?"1 fois contacté":`${c} fois contacté`})]}),e.jsxs("div",{className:"flex items-center gap-1 justify-end",children:[e.jsx(Ma,{size:"sm",variant:"ghost",onClick:()=>(async e=>{try{K(!0),G(e),e.projet_id;const{data:t,error:r}=await yn.from("envois_email").select("id, campagne_id, contact_id, projet_id, destinataire, sujet, contenu_html, contenu_texte, statut, date_envoi, date_ouverture, date_clic, created_at").eq("projet_id",e.projet_id).order("created_at",{ascending:!1});if(r)throw console.error("🔍 DEBUG: Error loading emails:",r),r;if(null==t||t.length,t&&t.length>0){const e=new Map,r=[...new Set(t.map(e=>e.campagne_id).filter(Boolean))];if(r.length>0){const{data:s,error:n}=await yn.from("envois_groupes").select("id, nom_campagne, created_at, commercial").in("id",r);n?console.error("🔍 DEBUG: Error loading campaigns:",n):(null==s||s.length,null==s||s.forEach(r=>{const s=t.filter(e=>e.campagne_id===r.id);e.set(r.id,{campaign:r,emails:s})}))}const s=Array.from(e.values()).map(({campaign:e,emails:t})=>({campaign:e,emails:t,emailCount:t.length,sentCount:t.filter(e=>"envoye"===e.statut).length,openedCount:t.filter(e=>"ouvert"===e.statut).length,clickedCount:t.filter(e=>"clique"===e.statut).length,errorCount:t.filter(e=>"echec"===e.statut).length}));s.length,J(s),U(!0)}else n({title:"Aucun email trouvé",description:"Ce projet n'a pas d'historique d'emails.",variant:"destructive"})}catch(t){console.error("🔍 DEBUG: Error in loadProjectEmailHistory:",t),n({title:"Erreur",description:"Impossible de charger l'historique des emails",variant:"destructive"})}finally{K(!1)}})(t),title:"Historique emails",className:"h-8 w-8 p-0",children:e.jsx(Oe,{className:"h-4 w-4"})}),e.jsx(Ma,{size:"sm",variant:"ghost",onClick:()=>s(`/projects/${t.projet_id}`),title:"Voir détails",className:"h-8 w-8 p-0",children:e.jsx(Te,{className:"h-4 w-4"})})]})]})]})},t.projet_id)})}),Re>1&&e.jsxs("div",{className:"flex justify-between items-center mt-6",children:[e.jsxs("div",{className:"text-sm text-muted-foreground",children:[Me+1,"-",Math.min(Me+k,be.length)," sur ",be.length]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ma,{variant:"outline",size:"sm",onClick:()=>N(_-1),disabled:1===_,children:e.jsx(pe,{className:"h-4 w-4"})}),e.jsxs("span",{className:"text-sm",children:["Page ",_," sur ",Re]}),e.jsx(Ma,{variant:"outline",size:"sm",onClick:()=>N(_+1),disabled:_===Re,children:e.jsx(ae,{className:"h-4 w-4"})})]})]})]})]}),e.jsx(Hd,{open:R,onOpenChange:M,children:e.jsxs(Jd,{className:"max-w-4xl",children:[e.jsxs(Yd,{children:[e.jsxs(Gd,{children:["Envoi Email Groupé - ",Ie().length," destinataires"]}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Envoyer des emails personnalisés à plusieurs projets sélectionnés"})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(eu,{children:"Template existant"}),e.jsxs(Td,{value:ie.templateId,onValueChange:e=>{const t=o.find(t=>t.id===parseInt(e));t&&oe({templateId:e,subject:t.sujet,content:t.contenu_html,useCustomContent:!1})},disabled:ie.useCustomContent,children:[e.jsx(Od,{children:e.jsx(Pd,{placeholder:"Choisir un template"})}),e.jsx(Md,{children:o.map(t=>e.jsx(Ad,{value:t.id.toString(),children:t.nom},t.id))})]})]}),e.jsxs("div",{className:"flex items-center space-x-2 mt-8",children:[e.jsx(xu,{checked:ie.useCustomContent,onCheckedChange:e=>oe({...ie,useCustomContent:!!e,templateId:e?"":ie.templateId})}),e.jsx(eu,{children:"Rédiger un email personnalisé"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(eu,{children:"Sujet"}),e.jsx(zd,{value:ie.subject,onChange:e=>oe({...ie,subject:e.target.value}),placeholder:"Sujet de l'email"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(eu,{children:"Contenu HTML"}),e.jsx(tu,{value:ie.content,onChange:e=>oe({...ie,content:e.target.value}),placeholder:"Contenu de l'email en HTML",rows:10,className:"font-mono text-sm"})]}),e.jsxs("div",{className:"bg-muted p-4 rounded-lg",children:[e.jsx("h4",{className:"font-medium mb-2",children:"Variables disponibles :"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[e.jsxs("div",{children:[e.jsx("code",{children:"{{nom_client}}"})," - Nom complet"]}),e.jsxs("div",{children:[e.jsx("code",{children:"{{prenom}}"})," - Prénom"]}),e.jsxs("div",{children:[e.jsx("code",{children:"{{nom}}"})," - Nom de famille"]}),e.jsxs("div",{children:[e.jsx("code",{children:"{{nom_commercial}}"})," - Commercial assigné"]}),e.jsxs("div",{children:[e.jsx("code",{children:"{{lien_rdv}}"})," - Lien RDV (si créé)"]}),e.jsxs("div",{children:[e.jsx("code",{children:"{{infos_premunia}}"})," - Infos de contact Premunia"]})]})]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx(Ma,{variant:"outline",onClick:()=>M(!1),children:"Annuler"}),e.jsxs(Ma,{onClick:async()=>{var e;const t=Ie();let r=t.filter(e=>e.hasEmail);const s=t.filter(e=>!e.hasEmail);if(0===r.length)return void n({title:"Aucun destinataire avec email",description:`Vous avez sélectionné ${t.length} projet(s), mais aucun n'a d'adresse email valide.`,variant:"destructive"});s.length>0&&n({title:"Information",description:`${s.length} projet(s) sélectionné(s) sans email valide seront ignorés.`,variant:"default"}),r.length,s.length;const a=[];for(const n of r){const e=Le(n);a.push(...e)}if(a.length>0)n({title:"Erreurs de validation",description:`Problèmes détectés: ${a.join(", ")}`,variant:"destructive"});else{L(!0);try{const t=r.map(e=>e.projectId),{data:s,error:a}=await yn.from("projets").select("projet_id, contact_id").in("projet_id",t);if(a)throw console.error("Erreur vérification projets:",a),new Error("Impossible de vérifier l'intégrité des projets");const c=(null==s?void 0:s.map(e=>e.projet_id))||[],d=r.filter(e=>!c.includes(e.projectId));if(d.length>0&&(n({title:"Attention",description:`${d.length} destinataires ont des projets invalides et seront ignorés`,variant:"destructive"}),r=r.filter(e=>c.includes(e.projectId))),0===r.length)throw new Error("Aucun destinataire valide après validation");const{data:h,error:f}=await yn.from("envois_groupes").insert({nom_campagne:`Envoi groupé - ${(new Date).toLocaleDateString()}`,nombre_destinataires:r.length,template_id:ie.templateId?parseInt(ie.templateId):null,statut_cible:"all"!==u?u:null,commercial:"all"!==m?m:null}).select().single();if(f)throw f;let p=0,v=0;const g=[];for(const u of r)try{const e=o.find(e=>e.id===parseInt(ie.templateId)),t=ie.useCustomContent?ie.subject:(null==e?void 0:e.sujet)||"Email Premun IA",r=ie.useCustomContent?ie.content:(null==e?void 0:e.contenu_html)||"",s=(null==e?void 0:e.contenu_texte)||"",a=$e(r,u),l=$e(s,u),c=$e(t,u),{data:d,error:m}=await yn.functions.invoke("send-email",{body:{to:u.email,subject:c,html:a,text:l}});if(m)throw console.error("Erreur envoi email:",m),new Error(m.message||"Erreur lors de l'envoi");if(!(null==d?void 0:d.success))throw new Error((null==d?void 0:d.error)||"Échec de l'envoi de l'email");u.email,p++;try{h.id,u.contactId,u.projectId,u.email,c.length;const{data:e,error:t}=await yn.from("envois_email").insert({campagne_id:h.id,contact_id:u.contactId,projet_id:u.projectId,destinataire:u.email,sujet:c,contenu_html:a,contenu_texte:l,statut:"envoye",date_envoi:(new Date).toISOString(),date_ouverture:null,date_clic:null,erreur_message:null}).select().single();t?(console.error("❌ Erreur lors du logging email:",t),console.error("🔍 DEBUG: Details erreur:",{code:t.code,message:t.message,details:t.details,hint:t.hint}),(t.message.includes("foreign key")||t.message.includes("trigger"))&&console.error("🔍 DEBUG: Violation FK ou trigger détectée:",{contact_id:u.contactId,projet_id:u.projectId,error_details:t.message}),n({title:"Erreur de tracking",description:`L'email a été envoyé mais n'a pas pu être tracké: ${t.message}`,variant:"destructive"})):e.id}catch(i){console.error("💥 Erreur inattendue lors de la sauvegarde email:",i),n({title:"Erreur système",description:"Erreur inattendue lors de la sauvegarde",variant:"destructive"})}}catch(l){console.error(`Erreur envoi email à ${u.email}:`,l),v++,g.push(`${u.email}: ${l.message}`);try{h.id,u.contactId,u.projectId,u.email,null==(e=l.message)||e.length;const{data:t,error:r}=await yn.from("envois_email").insert({campagne_id:h.id,contact_id:u.contactId,projet_id:u.projectId,destinataire:u.email,sujet:ie.subject||"Échec envoi",contenu_html:"",contenu_texte:"",statut:"echec",date_envoi:(new Date).toISOString(),erreur_message:l.message||"Erreur inconnue",date_ouverture:null,date_clic:null}).select().single();r?(console.error("❌ Erreur lors du logging échec:",r),console.error("🔍 DEBUG: Details erreur échec:",{code:r.code,message:r.message,details:r.details})):t.id}catch(i){console.error("💥 Erreur inattendue lors de la sauvegarde échec email:",i)}}await yn.from("envois_groupes").update({nombre_envoyes:p,nombre_echecs:v}).eq("id",h.id),p>0&&n({title:"Emails envoyés avec succès",description:`${p} emails envoyés et trackés correctement ${v>0?`(${v} échecs)`:""}`}),v>0&&0===p&&n({title:"Échec d'envoi",description:"Tous les emails ont échoué. Vérifiez la configuration email.",variant:"destructive"}),await ye(),await he(),M(!1),b(new Set),oe({templateId:"",subject:"",content:"",useCustomContent:!1})}catch(l){console.error("Erreur envoi groupé:",l),n({title:"Erreur d'envoi",description:l.message||"Impossible d'envoyer les emails",variant:"destructive"})}finally{L(!1)}}},disabled:$,children:[$&&e.jsx(we,{className:"h-4 w-4 mr-2 animate-spin"}),"Envoyer les Emails"]})]})]})]})}),e.jsx(Hd,{open:A,onOpenChange:I,children:e.jsxs(Jd,{children:[e.jsxs(Yd,{children:[e.jsxs(Gd,{children:["Proposer un RDV - ",y.size," projets"]}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Créer des propositions de rendez-vous pour les projets sélectionnés"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(eu,{children:"Date proposée"}),e.jsx(zd,{type:"datetime-local",value:le.dateProposee,onChange:e=>de({...le,dateProposee:e.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(eu,{children:"Message personnalisé"}),e.jsx(tu,{value:le.message,onChange:e=>de({...le,message:e.target.value}),placeholder:"Message à joindre à la proposition de RDV",rows:4})]}),e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg",children:[e.jsx("h4",{className:"font-medium text-blue-900 mb-2",children:"Liens générés automatiquement :"}),e.jsxs("p",{className:"text-sm text-blue-700",children:["Un lien unique sera créé pour chaque RDV : ",e.jsx("br",{}),e.jsx("code",{className:"bg-white px-2 py-1 rounded",children:"https://moncrm.netlify.app/rdv/[id]"})]})]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx(Ma,{variant:"outline",onClick:()=>I(!1),children:"Annuler"}),e.jsxs(Ma,{onClick:async()=>{const e=Ae.filter(e=>y.has(e.projet_id));if(0!==e.length){B(!0);try{const t=e.map(async e=>{const{data:t,error:r}=await yn.from("rdv").insert({projet_id:e.projet_id,commercial_id:e.commercial,date_proposee:le.dateProposee,message:le.message,statut:"propose"}).select().single();if(r)throw r;const s=`${window.location.origin}/rdv/${t.id}`;return await yn.from("rdv").update({lien:s}).eq("id",t.id),{...t,lien:s}}),r=await Promise.all(t);n({title:"RDV créés",description:`${r.length} rendez-vous proposés avec succès`}),I(!1),b(new Set),de({dateProposee:"",message:""})}catch(t){console.error("Erreur création RDV:",t),n({title:"Erreur",description:"Impossible de créer les rendez-vous",variant:"destructive"})}finally{B(!1)}}else n({title:"Aucun projet sélectionné",description:"Sélectionnez au moins un projet",variant:"destructive"})},disabled:F,children:[F&&e.jsx(we,{className:"h-4 w-4 mr-2 animate-spin"}),"Créer les RDV"]})]})]})]})}),e.jsx(Hd,{open:q,onOpenChange:U,children:e.jsxs(Jd,{className:"max-w-6xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(Yd,{children:[e.jsxs(Gd,{className:"flex items-center gap-2",children:[e.jsx(ce,{className:"h-5 w-5"}),"Historique Email - ",null==(t=null==Y?void 0:Y.contact)?void 0:t.prenom," ",null==(r=null==Y?void 0:Y.contact)?void 0:r.nom]}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Consulter l'historique des emails et campagnes pour ce projet"})]}),V.length>0?e.jsx("div",{className:"space-y-6 mt-6",children:V.map((t,r)=>{var s;return e.jsxs(oc,{className:"border-l-4 border-l-blue-500",children:[e.jsx(lc,{children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"font-medium text-lg",children:t.campaign.nom_campagne}),e.jsxs(qd,{variant:"outline",children:["Campagne #",t.campaign.id]}),e.jsx(qd,{className:Fe(t.campaign.commercial),children:t.campaign.commercial})]}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Créée le ",new Date(t.campaign.created_at).toLocaleDateString("fr-FR")]})]}),e.jsxs(Ma,{variant:"outline",size:"sm",onClick:()=>{var e;(null==(e=null==Y?void 0:Y.contact)?void 0:e.email)&&(async e=>{try{const{data:t,error:r}=await yn.from("envois_email").select("date_envoi, date_ouverture, date_clic, sujet, statut").eq("destinataire",e).order("date_envoi",{ascending:!1});if(r)throw r;const s=(null==t?void 0:t.map(e=>({date:e.date_envoi,event:"envoye"===e.statut?"delivered":e.date_ouverture?"opened":e.date_clic?"clicked":"sent",subject:e.sujet,campaign:"Email Tracking"})))||[];return s.length,s}catch(t){throw console.error("🔍 DEBUG: Error loading email history:",t),t}})(Y.contact.email).then(e=>{n({title:"Historique Email chargé",description:`${e.length} événements trouvés`})}).catch(e=>{console.error("Error loading Brevo history:",e),n({title:"Erreur",description:"Impossible de charger l'historique Email",variant:"destructive"})})},disabled:!(null==(s=null==Y?void 0:Y.contact)?void 0:s.email),children:[e.jsx(ce,{className:"h-4 w-4 mr-2"}),"Historique Email"]})]})}),e.jsxs(uc,{children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4 mb-4",children:[e.jsxs("div",{className:"text-center p-3 bg-gray-50 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-gray-700",children:t.emailCount}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Total emails"})]}),e.jsxs("div",{className:"text-center p-3 bg-green-50 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:t.sentCount}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Envoyés"})]}),e.jsxs("div",{className:"text-center p-3 bg-blue-50 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:t.openedCount}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Ouverts"})]}),e.jsxs("div",{className:"text-center p-3 bg-purple-50 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-purple-600",children:t.clickedCount}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Clics"})]}),e.jsxs("div",{className:"text-center p-3 bg-red-50 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-red-600",children:t.errorCount}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Erreurs"})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"font-medium",children:"Détails des emails :"}),e.jsx("div",{className:"max-h-96 overflow-y-auto space-y-3",children:t.emails.map((t,r)=>e.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg border",children:[e.jsxs("div",{className:"flex justify-between items-start mb-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(qd,{className:Fe(t.statut),children:t.statut}),e.jsx("span",{className:"text-sm font-medium",children:t.sujet})]}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:["Destinataire: ",t.destinataire]})]}),e.jsx("div",{className:"text-xs text-muted-foreground text-right",children:t.date_envoi&&new Date(t.date_envoi).toLocaleString("fr-FR")})]}),(t.contenu_html||t.contenu_texte)&&e.jsxs("div",{className:"mb-3",children:[e.jsx("div",{className:"text-xs font-medium text-muted-foreground mb-2",children:"Contenu de l'email:"}),e.jsx("div",{className:"max-h-32 overflow-y-auto bg-white p-3 rounded border text-sm",children:t.contenu_html?e.jsx("div",{dangerouslySetInnerHTML:{__html:t.contenu_html}}):e.jsx("div",{className:"whitespace-pre-wrap",children:t.contenu_texte})})]}),(t.date_ouverture||t.date_clic)&&e.jsxs("div",{className:"flex gap-4 mt-2 text-xs text-muted-foreground",children:[t.date_ouverture&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Te,{className:"h-3 w-3"}),"Ouvert: ",new Date(t.date_ouverture).toLocaleString("fr-FR")]}),t.date_clic&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ce,{className:"h-3 w-3"}),"Clic: ",new Date(t.date_clic).toLocaleString("fr-FR")]})]})]},r))})]})]})]},r)})}):e.jsx(oc,{children:e.jsxs(uc,{className:"p-8 text-center",children:[e.jsx(De,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium mb-2",children:"Aucun historique trouvé"}),e.jsx("p",{className:"text-muted-foreground",children:"Ce projet n'a pas d'historique d'emails."})]})})]})})]})}function ku(){const{user:t,loading:r}=jn(),s=H(),[n,a]=W.useState([]),[i,o]=W.useState([]);W.useEffect(()=>{r||t||s("/login"),t&&l()},[t,r,s]);const l=async()=>{try{const[{data:e},{data:t}]=await Promise.all([yn.from("contact").select("*, projets(*)").order("created_at",{ascending:!1}),yn.from("projets").select("*").order("created_at",{ascending:!1})]);a(e||[]),o(t||[])}catch(e){console.error("Error loading projects data:",e)}};return e.jsx(Ia,{title:"Gestion des Projets",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-6 py-8",children:[e.jsxs("div",{className:"mb-12",children:[e.jsx("h1",{className:"text-3xl font-light text-slate-900 mb-2",children:"Projets"}),e.jsx("p",{className:"text-slate-600 text-base",children:"Gestion de vos projets commerciaux"})]}),e.jsx(Nu,{})]})})}const Su=_a("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),Cu=W.forwardRef(({className:t,variant:r,...s},n)=>e.jsx("div",{ref:n,role:"alert",className:Na(Su({variant:r}),t),...s}));Cu.displayName="Alert";W.forwardRef(({className:t,...r},s)=>e.jsx("h5",{ref:s,className:Na("mb-1 font-medium leading-none tracking-tight",t),...r})).displayName="AlertTitle";const Eu=W.forwardRef(({className:t,...r},s)=>e.jsx("div",{ref:s,className:Na("text-sm [&_p]:leading-relaxed",t),...r}));function Tu(){const[t,r]=W.useState(""),[s,n]=W.useState(""),[a,i]=W.useState(!1),[o,l]=W.useState(""),c=H();return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-50 to-indigo-100 p-4",children:e.jsxs(oc,{className:"w-full max-w-md",children:[e.jsxs(lc,{className:"text-center",children:[e.jsx(cc,{className:"text-2xl font-bold",children:"Connexion"}),e.jsx(dc,{children:"Connectez-vous à votre compte CRM"})]}),e.jsxs(uc,{children:[e.jsxs("form",{onSubmit:async e=>{e.preventDefault(),i(!0),l("");try{const{data:e,error:r}=await yn.auth.signInWithPassword({email:t,password:s});r?l(r.message):e.user&&c("/")}catch(r){l("Une erreur est survenue lors de la connexion")}finally{i(!1)}},className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(eu,{htmlFor:"email",children:"Email"}),e.jsx(zd,{id:"email",type:"email",placeholder:"votre.email@exemple.com",value:t,onChange:e=>r(e.target.value),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(eu,{htmlFor:"password",children:"Mot de passe"}),e.jsx(zd,{id:"password",type:"password",value:s,onChange:e=>n(e.target.value),required:!0})]}),o&&e.jsx(Cu,{variant:"destructive",children:e.jsx(Eu,{children:o})}),e.jsx(Ma,{type:"submit",className:"w-full",disabled:a,children:a?"Connexion...":"Se connecter"})]}),e.jsxs("div",{className:"mt-4 text-center text-sm",children:["Pas encore de compte ?"," ",e.jsx(V,{to:"/signup",className:"text-primary hover:underline",children:"S'inscrire"})]})]})]})})}Eu.displayName="AlertDescription";const Pu=W.lazy(()=>Ze(()=>import("./B6lia_0w-campaigns.js"),__vite__mapDeps([2,3,1,4,5,6,7,8]))),Ou=W.lazy(()=>Ze(()=>import("./C3MfnUwI-analytics.js"),__vite__mapDeps([9,3,1,5,8,7,4,6]))),Du=W.lazy(()=>Ze(()=>import("./CtVW0-ZH-emailtemplates.js"),__vite__mapDeps([10,3,1,5,6,7,8]))),Ru=W.lazy(()=>Ze(()=>import("./Dt90ku4i-settings.js"),__vite__mapDeps([11,3,1,5,6,7,8]))),Mu=W.lazy(()=>Ze(()=>import("./C0Z_Xc0O-signup.js"),__vite__mapDeps([12,3,1,6,7,5,8]))),Au=W.lazy(()=>Ze(()=>import("./B11uBJdN-projectdetails.js"),__vite__mapDeps([13,3,1,4,5,6,7,8]))),Iu=W.lazy(()=>Ze(()=>import("./-42c7cZK-leadgeneration.js"),__vite__mapDeps([14,3,1,5,4,6,7,8]))),$u=W.lazy(()=>Ze(()=>import("./DZfoNYzg-commissions.js"),__vite__mapDeps([15,3,1,4,5,6,7,8])));function Lu(){return function(){const e=H(),t=K(),r=W.useRef(!1),s=W.useRef("/"),n=W.useRef(0),a=W.useCallback(()=>{try{const e={path:t.pathname,timestamp:Date.now(),userAgent:navigator.userAgent};localStorage.setItem("crm-app-state",JSON.stringify(e))}catch(e){}},[t.pathname]),i=W.useCallback(()=>{if(!(n.current>=3)){try{const r=localStorage.getItem("crm-app-state");if(r){const s=JSON.parse(r);if(Date.now()-s.timestamp<864e5&&s.path&&s.path!==t.pathname)return n.current++,e(s.path,{replace:!0}),!0}}catch(r){}return!1}},[e,t.pathname]);W.useEffect(()=>{if(r.current)return;r.current=!0;const n=()=>{"visible"===document.visibilityState?(t.pathname,i()||"/"!==t.pathname&&""!==t.pathname||setTimeout(()=>{"/"!==window.location.pathname&&""!==window.location.pathname||e("/",{replace:!0})},100)):a()},o=()=>{a()},l=e=>{window.location.pathname,s.current=window.location.pathname},c=()=>{setTimeout(()=>{"/"!==t.pathname&&""!==t.pathname||e("/",{replace:!0})},200)};return setTimeout(()=>{i()},500),document.addEventListener("visibilitychange",n),window.addEventListener("beforeunload",o),window.addEventListener("popstate",l),window.addEventListener("focus",c),()=>{document.removeEventListener("visibilitychange",n),window.removeEventListener("beforeunload",o),window.removeEventListener("popstate",l),window.removeEventListener("focus",c)}},[e,t.pathname,a,i]),W.useEffect(()=>{r.current&&t.pathname!==s.current&&(s.current=t.pathname,a())},[t.pathname,a]),t.pathname,r.current,n.current}(),e.jsx(W.Suspense,{fallback:e.jsx("div",{className:"flex justify-center items-center min-h-screen",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}),children:e.jsxs(Y,{children:[e.jsx(G,{path:"/",element:e.jsx(Wd,{})}),e.jsx(G,{path:"/campaigns",element:e.jsx(Pu,{})}),e.jsx(G,{path:"/projects",element:e.jsx(ku,{})}),e.jsx(G,{path:"/projects/:id",element:e.jsx(Au,{})}),e.jsx(G,{path:"/analytics",element:e.jsx(Ou,{})}),e.jsx(G,{path:"/email-templates",element:e.jsx(Du,{})}),e.jsx(G,{path:"/lead-generation",element:e.jsx(Iu,{})}),e.jsx(G,{path:"/settings",element:e.jsx(Ru,{})}),e.jsx(G,{path:"/commissions",element:e.jsx($u,{})}),e.jsx(G,{path:"/login",element:e.jsx(Tu,{})}),e.jsx(G,{path:"/signup",element:e.jsx(Mu,{})}),e.jsx(G,{path:"*",element:e.jsx(X,{to:"/",replace:!0})})]})})}function Fu(){return e.jsx(J,{children:e.jsxs(_n,{children:[e.jsx(Lu,{}),e.jsx(Da,{})]})})}Ge(),Xe(),Je.createRoot(document.getElementById("root")).render(e.jsx(z.StrictMode,{children:e.jsx(Fu,{})}));export{Cu as A,Ma as B,oc as C,Hd as D,zd as I,Ia as L,Td as S,sc as T,uc as a,Od as b,Pd as c,Md as d,Ad as e,qd as f,Jd as g,Yd as h,Gd as i,nc as j,ac as k,ic as l,lc as m,cc as n,jn as o,Eu as p,Fd as q,eu as r,yn as s,tu as t,Dn as u,dc as v,Na as w,xu as x,xn as y};
